import{a as st,p as ot,u as nt}from"../chunks/Cx5lmlld.js";import{g as it,$ as lt}from"../chunks/DdY9CyNE.js";import"../chunks/DsnmJJEf.js";import{p as ct,i as X,h as T,P as we,g as t,u as A,Q as mt,j as f,f as P,a as ut,s as o,c as d,W as dt,r as u,t as O}from"../chunks/BOqQhZBJ.js";import{s as D}from"../chunks/BufZg4h2.js";import{f as p,a as l,t as H,c as $e}from"../chunks/CnteGC4G.js";import{a as Ie}from"../chunks/yWuLE-qO.js";import{i as x}from"../chunks/QS5y7wlf.js";import{h as vt,e as ft}from"../chunks/D4fmOnVC.js";import{u as pt,a as _t,ai as gt,w as ht,I as At,a6 as yt,ae as bt,af as xt,ah as wt}from"../chunks/LrV5ZTyj.js";import{b as Se}from"../chunks/9i_j0jQI.js";import{a as z,c as $t,s as It}from"../chunks/B227BkWK.js";import{b as St}from"../chunks/Cv1syPnL.js";import{a as kt,g as Pt}from"../chunks/C4XZXykC.js";import{p as ke}from"../chunks/DbKlvrsB.js";import{A as oe}from"../chunks/CT-ELVN-.js";import{B as Pe}from"../chunks/Ydc33-3A.js";import{C as Dt}from"../chunks/C9fqHGV9.js";import{G as Rt}from"../chunks/BO7gIFhw.js";import{a as Ct}from"../chunks/0U8rfwJB.js";import{C as Nt,A as De}from"../chunks/D3TI8oak.js";import{F as Tt,A as Ot}from"../chunks/CJ8Y9ewd.js";import{C as Ft,a as jt}from"../chunks/Td-V8-DQ.js";import{C as Mt,T as Bt}from"../chunks/BgebDwf7.js";import{D as Et}from"../chunks/DbL3L5r_.js";import{D as Re}from"../chunks/CAJBNUk5.js";import{S as Qt}from"../chunks/P5k8Owjv.js";import{A as Ut}from"../chunks/DYbeYGSx.js";import{Q as qt}from"../chunks/BNLYq5HQ.js";import{f as Lt}from"../chunks/D5h9ps2j.js";import{R as ne}from"../chunks/BeWG-__C.js";import{g as Vt}from"../chunks/Bc5ULZvy.js";import{A as Ht}from"../chunks/DeL_lkPB.js";import{h as zt,k as Jt,a as Ce,l as Gt}from"../chunks/Jagi0WJL.js";import{g as Wt}from"../chunks/Dw326QmB.js";import{p as Yt}from"../chunks/De1sTUmb.js";import{i as Xt,c as Zt}from"../chunks/C2I_EQjW.js";import{t as Kt}from"../chunks/BIB7ntQe.js";import{E as er,F as tr,G as rr,H as ar}from"../chunks/DeYUhNiz.js";const sr=(async({url:Z})=>(await st(Z),{meta:{title:(await it())("search")}})),aa=Object.freeze(Object.defineProperty({__proto__:null,load:sr},Symbol.toStringTag,{value:"Module"}));var or=p('<div class="bg-gray-300 py-2 px-4 dark:bg-gray-800 dark:text-white rounded-e-full"><!></div>'),nr=p('<div class="flex place-content-center place-items-center items-stretch text-xs"><div> </div> <!></div>'),ir=p('<section id="search-chips" class="mt-24 text-center w-full flex gap-5 place-content-center place-items-center flex-wrap px-24"></section>'),lr=p('<div class="flex min-h-[calc(66vh-11rem)] w-full place-content-center items-center dark:text-white"><div class="flex flex-col content-center items-center text-center"><!> <p class="mt-5 text-3xl font-medium"> </p> <p class="text-base font-normal"> </p></div></div>'),cr=p('<div class="flex justify-center py-16 items-center"><!></div>'),mr=p("<!> <!>",1),ur=p("<!> <!> <!> <!> <!> <!> <!> <!> <hr/> <!> <!> <!>",1),dr=p("<!> <!>",1),vr=p("<!> <!> <!> <!>",1),fr=p('<div class="fixed top-0 start-0 w-full"><!></div>'),pr=p('<div class="absolute bg-light"></div> <div class="w-full flex-1 ps-4"><!></div>',1),_r=p('<div class="fixed top-0 start-0 w-full"><!></div>'),gr=p('<!> <section class="mb-12 bg-immich-bg dark:bg-immich-dark-bg m-4 max-h-screen"><section id="search-content"><!> <!></section> <section><!></section></section>',1);function sa(Z,ie){ct(ie,!0);const le=()=>z(nt,"$user",Q),Ne=()=>z(Jt,"$lang",Q),a=()=>z(lt,"$t",Q),Te=()=>z(Gt,"$locale",Q),Oe=()=>z(ot,"$preferences",Q),[Q,Fe]=It(),K=X({width:0,height:0});let ee=T(void 0),J=T(X(ne.explore())),G=T(1),ce=T(X([])),y=T(X([])),U=T(!0),W=T(0),me=0;const _=new Ht;let ue=A(()=>ke.url.searchParams.get(qt.QUERY)),je=A(()=>Lt.value.smartSearch),w=A(()=>t(ue)?JSON.parse(t(ue)):{});const Me=A(()=>le()&&_.selectedAssets.every(e=>e.ownerId===le().id));we(()=>{t(w),mt(()=>zt(te()))}),we(()=>{t(W)&&(me=t(W))}),kt(({from:e})=>{e?.url&&e.route.id!==ke.route.id&&f(J,e.url.href,!0);const r=e?.route?.id;Xt(r)&&f(J,ne.photos(),!0),Zt(r)&&f(J,ne.explore(),!0),dt().then(()=>{window.scrollTo(0,me)}).catch(()=>{})});const de=e=>{const r=new Set(e);f(y,t(y).filter(s=>!r.has(s.id)),!0)},Be=e=>{_.clearMultiselect(),de(e)},Ee=()=>{_.selectAssets(t(y).map(e=>Kt(e)))};async function te(){f(G,1),f(y,[],!0),f(ce,[],!0),await re(!0)}const re=async e=>{if(!t(G)||t(U)&&!e)return;f(U,!0);const r={page:t(G),withExif:!0,isVisible:!0,language:Ne(),...t(w)};try{const{albums:s,assets:i}=("query"in r||"queryAssetId"in r)&&t(je)?await er({smartSearchDto:r}):await tr({metadataSearchDto:r});t(ce).push(...s.items),t(y).push(...i.items),f(G,Number(i.nextPage)||0,!0)}catch(s){vt(s,a()("loading_search_results_failed"))}finally{f(U,!1)}};function Qe(e){return Yt(e).startOf("day").toLocaleString({year:"numeric",month:"long",day:"numeric"},{locale:Te()})}function Ue(e){return{takenAfter:a()("start_date"),takenBefore:a()("end_date"),visibility:a()("in_archive"),isFavorite:a()("favorite"),isNotInAlbum:a()("not_in_any_album"),type:a()("media_type"),query:a()("context"),city:a()("city"),country:a()("country"),state:a()("state"),make:a()("camera_brand"),model:a()("camera_model"),lensModel:a()("lens_model"),personIds:a()("people"),tagIds:a()("tags"),originalFileName:a()("file_name_text"),description:a()("description"),queryAssetId:a()("query_asset_id"),ocr:a()("ocr")}[e]||e}async function qe(e){return(await Promise.all(e.map(async s=>{const i=await rr({id:s});return i.name==""?a()("no_name"):i.name}))).join(", ")}async function Le(e){return e===null?a()("untagged"):(await Promise.all(e.map(async s=>(await ar({id:s})).value))).join(", ")}const ve=e=>{if(Ce(_),t(w).isNotInAlbum.toString()=="true"){const r=new Set(e);f(y,t(y).filter(s=>!r.has(s.id)),!0)}};function Ve(e){return Object.keys(e)}var He={loadNextPage:re},fe=gr(),pe=P(fe);{var ze=e=>{var r=ir();ft(r,20,()=>Ve(t(w)),s=>s,(s,i)=>{const m=A(()=>t(w)[i]);var g=nr(),v=d(g),$=d(v,!0);u(v);var I=o(v,2);{var F=R=>{var L=or(),se=d(L);{var h=n=>{var c=H();O(b=>D(c,b),[()=>Qe(t(m))]),l(n,c)},j=n=>{var c=$e(),b=P(c);Ie(b,()=>qe(t(m)),null,(B,E)=>{var k=H();O(()=>D(k,t(E))),l(B,k)}),l(n,c)},V=A(()=>i==="personIds"&&Array.isArray(t(m))),M=n=>{var c=$e(),b=P(c);Ie(b,()=>Le(t(m)),null,(B,E)=>{var k=H();O(()=>D(k,t(E))),l(B,k)}),l(n,c)},S=A(()=>i==="tagIds"&&(Array.isArray(t(m))||t(m)===null)),C=n=>{var c=H();O(b=>D(c,b),[()=>a()("unknown")]),l(n,c)},Y=n=>{var c=H();O(()=>D(c,t(m))),l(n,c)};x(se,n=>{(i==="takenAfter"||i==="takenBefore")&&typeof t(m)=="string"?n(h):t(V)?n(j,1):t(S)?n(M,2):t(m)===null||t(m)===""?n(C,3):n(Y,!1)})}u(L),l(R,L)};x(I,R=>{t(m)!==!0&&R(F)})}u(g),O(R=>{pt(v,1,`flex items-center justify-center bg-immich-primary py-2 px-4 text-white dark:text-black dark:bg-immich-dark-primary
          ${t(m)===!0?"rounded-full":"rounded-s-full"}`),D($,R)},[()=>Ue(i)]),l(s,g)}),u(r),l(e,r)};x(pe,e=>{t(w)&&e(ze)})}var q=o(pe,2),ae=d(q),_e=d(ae);{var Je=e=>{Rt(e,{get assets(){return t(y)},get assetInteraction(){return _},onIntersected:re,showArchiveIcon:!0,get viewport(){return K},onReload:te,get slidingWindowOffset(){return t(ee).offsetTop}})},Ge=e=>{var r=lr(),s=d(r),i=d(s);_t(i,{get icon(){return gt},size:"3.5em"});var m=o(i,2),g=d(m,!0);u(m);var v=o(m,2),$=d(v,!0);u(v),u(s),u(r),O((I,F)=>{D(g,I),D($,F)},[()=>a()("no_results"),()=>a()("no_results_description")]),l(e,r)};x(_e,e=>{t(y).length>0?e(Je):t(U)||e(Ge,1)})}var We=o(_e,2);{var Ye=e=>{var r=cr(),s=d(r);ht(s,{size:"giant"}),u(r),l(e,r)};x(We,e=>{t(U)&&e(Ye)})}u(ae);var ge=o(ae,2),Xe=d(ge);{var Ze=e=>{var r=fr(),s=d(r);Ut(s,{get assets(){return _.selectedAssets},clearSelect:()=>Ce(_),children:(i,m)=>{const g=A(()=>Vt(a(),Wt()));var v=vr(),$=P(v);Nt($,{});var I=o($,2);{let h=A(()=>a()("select_all"));At(I,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return t(h)},get icon(){return yt},onclick:Ee})}var F=o(I,2);{let h=A(()=>a()("add_to"));Pe(F,{get icon(){return bt},get title(){return t(h)},children:(j,V)=>{var M=mr(),S=P(M);De(S,{onAddToAlbum:ve});var C=o(S,2);De(C,{shared:!0,onAddToAlbum:ve}),l(j,M)},$$slots:{default:!0}})}var R=o(F,2);{var L=h=>{var j=dr(),V=P(j);Tt(V,{get removeFavorite(){return _.isAllFavorite},onFavorite:(S,C)=>{for(const Y of S){const n=t(y).find(c=>c.id===Y);n&&(n.isFavorite=C)}}});var M=o(V,2);{let S=A(()=>a()("menu"));Pe(M,{get icon(){return xt},get title(){return t(S)},children:(C,Y)=>{var n=ur(),c=P(n);Re(c,{menuItem:!0});var b=o(c,2);Ft(b,{menuItem:!0});var B=o(b,2);Mt(B,{menuItem:!0});var E=o(B,2);jt(E,{menuItem:!0});var k=o(E,2);Ot(k,{menuItem:!0,get unarchive(){return _.isAllArchived}});var he=o(k,2);{var tt=N=>{Qt(N,{menuItem:!0,onVisibilitySet:Be})};x(he,N=>{_.isAllUserOwned&&N(tt)})}var Ae=o(he,2);{var rt=N=>{Bt(N,{menuItem:!0})};x(Ae,N=>{Oe().tags.enabled&&_.isAllUserOwned&&N(rt)})}var ye=o(Ae,2);Et(ye,{menuItem:!0,onAssetDelete:de,onUndoDelete:te});var be=o(ye,4);oe(be,{get action(){return t(g).RegenerateThumbnailJob}});var xe=o(be,2);oe(xe,{get action(){return t(g).RefreshMetadataJob}});var at=o(xe,2);oe(at,{get action(){return t(g).TranscodeVideoJob}}),l(C,n)},$$slots:{default:!0}})}l(h,j)},se=h=>{Re(h,{})};x(R,h=>{t(Me)?h(L):h(se,!1)})}l(i,v)},$$slots:{default:!0}}),u(r),l(e,r)},Ke=e=>{var r=_r(),s=d(r);Dt(s,{onClose:()=>Pt(t(J)),get backIcon(){return wt},children:(i,m)=>{var g=pr(),v=o(P(g),2),$=d(v);{let I=A(()=>t(w)?.query??"");Ct($,{grayTheme:!1,get value(){return t(I)},get searchQuery(){return t(w)}})}u(v),l(i,g)},$$slots:{default:!0}}),u(r),l(e,r)};x(Xe,e=>{_.selectionActive?e(Ze):e(Ke,!1)})}u(ge),u(q),$t(q,e=>f(ee,e),()=>t(ee)),St("y",()=>t(W),e=>f(W,e,!0)),Se(q,"clientHeight",e=>K.height=e),Se(q,"clientWidth",e=>K.width=e),l(Z,fe);var et=ut(He);return Fe(),et}export{sa as component,aa as universal};

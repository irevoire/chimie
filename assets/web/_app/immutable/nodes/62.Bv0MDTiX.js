import{s as Z}from"../chunks/FIvvbHQR.js";import{r as gt,R as P}from"../chunks/BeWG-__C.js";import{g as mt,$ as ft}from"../chunks/DdY9CyNE.js";import"../chunks/DsnmJJEf.js";import{a as pt,s as j,e as ht}from"../chunks/BufZg4h2.js";import{p as vt,a as _t,f as I,g as t,u as f,s as c,h as $,c as B,j as o,t as D,n as K,r as R}from"../chunks/BOqQhZBJ.js";import{i as p}from"../chunks/QS5y7wlf.js";import{h as $t}from"../chunks/pe4SF8AL.js";import{f as O,a as h,c as bt,t as N}from"../chunks/CnteGC4G.js";import{s as wt,a as yt}from"../chunks/B227BkWK.js";import{g as k}from"../chunks/C4XZXykC.js";import{A as xt}from"../chunks/auPRkcHw.js";import{e as Pt}from"../chunks/ytu5q_IM.js";import{f as g}from"../chunks/D5h9ps2j.js";import{H as b}from"../chunks/Jagi0WJL.js";import{g as V,h as Lt}from"../chunks/D4fmOnVC.js";import{Q as At}from"../chunks/DeYUhNiz.js";import{S as Mt}from"../chunks/Ze2c3aZz.js";import{A as T}from"../chunks/BEiKRg21.js";import{F as X}from"../chunks/DzmAA-7p.js";import{I as kt}from"../chunks/BJT5MMCK.js";import{P as Tt}from"../chunks/DHEjuV7w.js";import{B as Y}from"../chunks/LrV5ZTyj.js";const Ot=(async({parent:S,url:w})=>(await S(),Z.value.isInitialized||gt(307,P.register()),{meta:{title:(await mt())("login")},continueUrl:w.searchParams.get("continue")||P.photos()})),lr=Object.freeze(Object.defineProperty({__proto__:null,load:Ot},Symbol.toStringTag,{value:"Module"}));var St=O('<form class="flex flex-col gap-4"><!> <!> <!> <!></form>'),zt=O('<div class="inline-flex w-full items-center justify-center my-4"><hr class="my-4 h-px w-3/4 border-0 bg-gray-200 dark:bg-gray-600"/> <span class="absolute start-1/2 -translate-x-1/2 bg-gray-50 px-3 font-medium text-gray-900 dark:bg-neutral-900 dark:text-white uppercase"> </span></div>'),Ct=O("<!> <!> <!>",1),Et=O("<!> <!> <!> <!>",1);function nr(S,w){vt(w,!0);const l=()=>yt(ft,"$t",tt),[tt,rt]=wt();let L=$(""),z=$(""),C=$(""),y=$(""),x=$(!1),d=$(!0);const A=f(()=>Z.value),U=async r=>{await k(w.data.continueUrl,{invalidateAll:!0}),Pt.emit("AuthLogin",r)},at=()=>k(P.changePassword()),E=()=>k(P.onboarding());pt(async()=>{if(!g.value.oauth){o(d,!1);return}if(b.isCallback(globalThis.location))try{const r=await b.login(globalThis.location);if(!r.isOnboarded){await E();return}await U(r);return}catch(r){console.error("Error [login-form] [oauth.callback]",r),o(y,V(r)||l()("errors.unable_to_complete_oauth_login"),!0),o(d,!1);return}try{if(g.value.oauthAutoLaunch&&!b.isAutoLaunchDisabled(globalThis.location)||b.isAutoLaunchEnabled(globalThis.location)){await k(P.login({autoLaunch:0}),{replaceState:!0}),await b.authorize(globalThis.location);return}}catch(r){Lt(r,l()("errors.unable_to_connect"))}o(d,!1)});const et=async()=>{try{o(L,""),o(x,!0);const r=await At({loginCredentialDto:{email:t(z),password:t(C)}});if(r.isAdmin&&!t(A).isOnboarded){await E();return}if(!r.isAdmin&&r.shouldChangePassword){await at();return}if(!r.isOnboarded){await E();return}await U(r);return}catch(r){o(L,V(r)||l()("errors.incorrect_email_or_password"),!0),o(x,!1);return}},ot=async()=>{o(d,!0),o(y,""),await b.authorize(globalThis.location)||(o(d,!1),o(y,l()("errors.unable_to_login_with_oauth"),!0))},st=async r=>{r.preventDefault(),await et()};xt(S,{get title(){return w.data.meta.title},children:(r,Ft)=>{Mt(r,{gap:4,children:(lt,jt)=>{var W=Et(),H=I(W);{var nt=e=>{T(e,{color:"primary",class:"mb-6",children:(s,v)=>{var _=bt(),m=I(_);$t(m,()=>t(A).loginPageMessage),h(s,_)},$$slots:{default:!0}})};p(H,e=>{t(A).loginPageMessage&&e(nt)})}var Q=c(H,2);{var it=e=>{var s=St(),v=B(s);{var _=a=>{T(a,{color:"danger",get title(){return t(L)},closable:!0})};p(v,a=>{t(L)&&a(_)})}var m=c(v,2);{let a=f(()=>l()("email"));X(m,{get label(){return t(a)},children:(n,i)=>{kt(n,{id:"email",name:"email",type:"email",autocomplete:"email",get value(){return t(z)},set value(u){o(z,u,!0)}})},$$slots:{default:!0}})}var M=c(m,2);{let a=f(()=>l()("password"));X(M,{get label(){return t(a)},children:(n,i)=>{Tt(n,{id:"password",autocomplete:"current-password",get value(){return t(C)},set value(u){o(C,u,!0)}})},$$slots:{default:!0}})}var F=c(M,2);Y(F,{type:"submit",size:"large",shape:"round",fullWidth:!0,get loading(){return t(x)},class:"mt-6",children:(a,n)=>{K();var i=N();D(u=>j(i,u),[()=>l()("to_login")]),h(a,i)},$$slots:{default:!0}}),R(s),ht("submit",s,st),h(e,s)};p(Q,e=>{!t(d)&&g.value.passwordLogin&&e(it)})}var q=c(Q,2);{var ut=e=>{var s=Ct(),v=I(s);{var _=a=>{var n=zt(),i=c(B(n),2),u=B(i,!0);R(i),R(n),D(G=>j(u,G),[()=>l()("or")]),h(a,n)};p(v,a=>{g.value.passwordLogin&&a(_)})}var m=c(v,2);{var M=a=>{T(a,{color:"danger",get title(){return t(y)},closable:!0})};p(m,a=>{t(y)&&a(M)})}var F=c(m,2);{let a=f(()=>t(x)||t(d)),n=f(()=>t(x)||t(d)),i=f(()=>g.value.passwordLogin?"secondary":"primary");Y(F,{shape:"round",get loading(){return t(a)},get disabled(){return t(n)},size:"large",fullWidth:!0,get color(){return t(i)},onclick:ot,children:(u,G)=>{K();var J=N();D(()=>j(J,t(A).oauthButtonText)),h(u,J)},$$slots:{default:!0}})}h(e,s)};p(q,e=>{g.value.oauth&&e(ut)})}var ct=c(q,2);{var dt=e=>{{let s=f(()=>l()("login_has_been_disabled"));T(e,{color:"warning",get title(){return t(s)}})}};p(ct,e=>{!g.value.passwordLogin&&!g.value.oauth&&e(dt)})}h(lt,W)},$$slots:{default:!0}})},$$slots:{default:!0}}),_t(),rt()}export{nr as component,lr as universal};

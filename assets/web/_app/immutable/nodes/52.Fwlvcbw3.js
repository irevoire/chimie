import{a as Ve}from"../chunks/Cx5lmlld.js";import{g as We,$ as ie}from"../chunks/DdY9CyNE.js";import{aF as Xe,aK as E,aI as Q,aJ as Ye}from"../chunks/DeYUhNiz.js";import"../chunks/DsnmJJEf.js";import{d as Ze,s as h,a as ea}from"../chunks/BufZg4h2.js";import{c as o,b as fe,r as s,t as b,p as le,g as a,u,s as l,f as j,a as de,n as Te,ae as aa,at as ta,j as ra}from"../chunks/BOqQhZBJ.js";import{f,s as _e,a as c,t as Pe,c as ze}from"../chunks/CnteGC4G.js";import{i as q}from"../chunks/QS5y7wlf.js";import{p as ne,a as Z,s as ce,e as sa,b as oa}from"../chunks/B227BkWK.js";import{A as na}from"../chunks/4in-FAdc.js";import{O as ia}from"../chunks/Di6OVBka.js";import{e as la,t as da,h as ca}from"../chunks/D4fmOnVC.js";import{u as ee,a as B,I as qe,dG as ma,x as Se,cx as ua,dH as va,bq as ga,dI as fa,bp as _a,dJ as pa,b7 as xa,s as ha}from"../chunks/LrV5ZTyj.js";import{R as ge}from"../chunks/BeWG-__C.js";import{a as Me,q as oe,b as ba}from"../chunks/BHa1I7G5.js";import{ag as ya,l as Ca}from"../chunks/Jagi0WJL.js";import{L as ka}from"../chunks/Dj0AsE1j.js";import"../chunks/69_IOA4Y.js";import{i as wa}from"../chunks/CMtyP6CA.js";import{O as $a}from"../chunks/BNLYq5HQ.js";import{F as Ta}from"../chunks/BbGcRfD-.js";import{f as Pa}from"../chunks/D5h9ps2j.js";import{m as qa}from"../chunks/C20f7eOz.js";import{C as Sa}from"../chunks/BCL4P6ef.js";import{C as Qa}from"../chunks/WscBzvwE.js";const ja=(async({url:$})=>{await Ve($,{admin:!0});const t=await Xe(),e=await We();return{queues:t,meta:{title:e("admin.queues")}}}),qt=Object.freeze(Object.defineProperty({__proto__:null,load:ja},Symbol.toStringTag,{value:"Module"}));var za=f("<div><!></div>");function Qe($,t){const e={success:"bg-green-500/70 text-gray-900 dark:bg-green-700/90 dark:text-gray-100",warning:"bg-orange-400/70 text-gray-900 dark:bg-orange-900 dark:text-gray-100"};var g=za(),T=o(g);_e(T,()=>t.children??fe),s(g),b(()=>ee(g,1,`w-full p-2 text-center text-sm ${e[t.color]??""}`)),c($,g)}var Ma=f('<button type="button"><!></button>');function H($,t){let e=ne(t,"disabled",3,!1),g=ne(t,"onClick",3,()=>{});const T={"light-gray":"bg-gray-300/80 dark:bg-gray-700",gray:"bg-gray-300/90 dark:bg-gray-700/90","dark-gray":"bg-gray-300 dark:bg-gray-700/80"},p=e()?"cursor-not-allowed":"hover:bg-immich-primary hover:text-white dark:hover:bg-immich-dark-primary dark:hover:text-black";var x=Ma();x.__click=function(...O){g()?.apply(this,O)};var F=o(x);_e(F,()=>t.children??fe),s(x),b(()=>{x.disabled=e(),ee(x,1,`flex h-full w-full flex-col place-content-center place-items-center gap-2 px-8 py-2 text-xs text-gray-600 transition-colors dark:text-gray-200 ${T[t.color]??""} ${p}`)}),c($,x)}Ze(["click"]);var Fa=f("<span><!></span>");function je($,t){let e=ne(t,"rounded",3,!0);var g=Fa();let T;var p=o(g);_e(p,()=>t.children??fe),s(g),b(()=>T=ee(g,1,"bg-primary text-subtle inline-block h-min whitespace-nowrap px-3 py-1 text-center align-baseline text-xs leading-none",null,T,{"rounded-md":e()===!0,"rounded-full":e()==="full"})),c($,g)}var La=f("<!> <span> </span>",1),Oa=f('<div class="flex flex-row gap-1"><span class="text-sm"> </span> <!></div>'),Ra=f('<span class="text-sm"> </span>'),Da=f('<div class="whitespace-pre-line text-sm dark:text-white"> </div>'),Ia=f('<div class="text-sm dark:text-white"><!></div>'),Ea=f("<!> <span> </span>",1),Aa=f("<!> <span> </span>",1),Ba=f("<!> <span> </span>",1),Ja=f("<!> <span> </span>",1),Ga=f("<!> <!>",1),Na=f("<!> <span> </span>",1),Ha=f("<!> <span> </span>",1),Ka=f("<!> <span> </span>",1),Ua=f("<!> <!> <!>",1),Va=f("<!> <span> </span>",1),Wa=f('<div class="flex flex-col overflow-hidden rounded-2xl bg-gray-100 dark:bg-immich-dark-gray sm:flex-row sm:rounded-9"><div class="flex w-full flex-col"><!> <div class="flex flex-col gap-2 p-5 sm:p-7 md:p-9"><div class="flex items-center gap-2 text-xl font-semibold text-primary"><!> <!> <div class="flex gap-2"><!> <!></div></div> <!> <!> <div class="mt-2 flex w-full max-w-md flex-col sm:flex-row"><div><p> </p> <p class="text-2xl"> </p></div> <div><p class="text-2xl"> </p> <p> </p></div></div></div></div> <div class="flex w-full flex-row overflow-hidden sm:w-32 sm:flex-col"><!> <!> <!> <!></div></div>');function Xa($,t){le(t,!0);const e=()=>Z(ie,"$t",T),g=()=>Z(Ca,"$locale",T),[T,p]=ce();let x=ne(t,"disabled",3,!1);const F=u(()=>Me(e(),t.queue)),O=u(()=>a(F).icon),R=u(()=>a(F).title),C=u(()=>a(F).subtitle),v=u(()=>t.queue.statistics);let S=u(()=>a(v).waiting+a(v).paused+a(v).delayed),M=u(()=>a(v).active+a(v).waiting===0&&!t.queue.isPaused),K=u(()=>t.allText||t.refreshText);var J=Wa(),z=o(J),A=o(z);{var W=r=>{Qe(r,{color:"warning",children:(i,_)=>{Te();var n=Pe();b(m=>h(n,m),[()=>e()("paused")]),c(i,n)}})},G=r=>{Qe(r,{color:"success",children:(i,_)=>{Te();var n=Pe();b(m=>h(n,m),[()=>e()("active")]),c(i,n)}})};q(A,r=>{t.queue.isPaused?r(W):a(v).active>0&&r(G,1)})}var U=l(A,2),ae=o(U),X=o(ae);{let r=u(()=>ge.viewQueue(t.queue));ka(X,{class:"flex items-center gap-2 hover:underline",get href(){return a(r)},underline:!1,children:(i,_)=>{var n=La(),m=j(n);B(m,{get icon(){return a(O)},size:"1.25em",class:"hidden shrink-0 sm:block"});var y=l(m,2),L=o(y,!0);s(y),b(d=>h(L,d),[()=>ya(a(R))]),c(i,n)},$$slots:{default:!0}})}var te=l(X,2);{let r=u(()=>e()("view_details")),i=u(()=>ge.viewQueue(t.queue));qe(te,{color:"primary",get icon(){return ma},get"aria-label"(){return a(r)},size:"small",variant:"ghost",get href(){return a(i)}})}var re=l(te,2),V=o(re);{var Fe=r=>{je(r,{children:(i,_)=>{var n=Oa(),m=o(n),y=o(m,!0);s(m);var L=l(m,2);{let d=u(()=>e()("clear_message"));qe(L,{color:"primary",get icon(){return Se},get"aria-label"(){return a(d)},size:"tiny",shape:"round",onclick:()=>t.onCommand({command:E.ClearFailed,force:!1})})}s(n),b(d=>h(y,d),[()=>e()("admin.jobs_failed",{values:{jobCount:a(v).failed.toLocaleString(g())}})]),c(i,n)},$$slots:{default:!0}})};q(V,r=>{a(v).failed>0&&r(Fe)})}var Le=l(V,2);{var Oe=r=>{je(r,{children:(i,_)=>{var n=Ra(),m=o(n,!0);s(n),b(y=>h(m,y),[()=>e()("admin.jobs_delayed",{values:{jobCount:a(v).delayed.toLocaleString(g())}})]),c(i,n)},$$slots:{default:!0}})};q(Le,r=>{a(v).delayed>0&&r(Oe)})}s(re),s(ae);var pe=l(ae,2);{var Re=r=>{var i=Da(),_=o(i,!0);s(i),b(()=>h(_,a(C))),c(r,i)};q(pe,r=>{a(C)&&r(Re)})}var xe=l(pe,2);{var De=r=>{const i=u(()=>t.description);var _=Ia(),n=o(_);sa(n,()=>a(i),(m,y)=>{y(m,{})}),s(_),c(r,_)};q(xe,r=>{t.description&&r(De)})}var he=l(xe,2),se=o(he);ee(se,1,"flex place-items-center justify-between w-full py-2 sm:py-4 pe-4 ps-6 rounded-t-lg bg-immich-primary text-white dark:bg-immich-dark-primary dark:text-immich-dark-gray sm:rounded-s-lg sm:rounded-e-none");var me=o(se),Ie=o(me,!0);s(me);var be=l(me,2),Ee=o(be,!0);s(be),s(se);var ue=l(se,2);ee(ue,1,"flex place-items-center justify-between w-full py-2 sm:py-4 pe-4 ps-6 flex-row-reverse rounded-b-lg bg-gray-200 text-immich-dark-bg dark:bg-gray-700 dark:text-immich-gray sm:rounded-s-none sm:rounded-e-lg");var ve=o(ue),Ae=o(ve,!0);s(ve);var ye=l(ve,2),Be=o(ye,!0);s(ye),s(ue),s(he),s(U),s(z);var Ce=l(z,2),ke=o(Ce);{var Je=r=>{H(r,{disabled:!0,color:"light-gray",onClick:()=>t.onCommand({command:E.Start,force:!1}),children:(i,_)=>{var n=Ea(),m=j(n);B(m,{get icon(){return ua},size:"36"});var y=l(m,2),L=o(y,!0);s(y),b(d=>h(L,d),[()=>e()("disabled")]),c(i,n)},$$slots:{default:!0}})};q(ke,r=>{x()&&r(Je)})}var we=l(ke,2);{var Ge=r=>{var i=Ga(),_=j(i);{var n=d=>{H(d,{color:"gray",onClick:()=>t.onCommand({command:E.Empty,force:!1}),children:(D,N)=>{var P=Aa(),k=j(P);B(k,{get icon(){return Se},size:"24"});var w=l(k,2),I=o(w,!0);s(w),b(Y=>h(I,Y),[()=>e()("clear")]),c(D,P)},$$slots:{default:!0}})};q(_,d=>{a(S)>0&&d(n)})}var m=l(_,2);{var y=d=>{const D=u(()=>a(S)>0?"24":"48");H(d,{color:"light-gray",onClick:()=>t.onCommand({command:E.Resume,force:!1}),children:(N,P)=>{var k=Ba(),w=j(k);B(w,{get icon(){return fa},get size(){return a(D)}});var I=l(w,2),Y=o(I,!0);s(I),b(Ue=>h(Y,Ue),[()=>e()("resume")]),c(N,k)},$$slots:{default:!0}})},L=d=>{H(d,{color:"light-gray",onClick:()=>t.onCommand({command:E.Pause,force:!1}),children:(D,N)=>{var P=Ja(),k=j(P);B(k,{get icon(){return _a},size:"24"});var w=l(k,2),I=o(w,!0);s(w),b(Y=>h(I,Y),[()=>e()("pause")]),c(D,P)},$$slots:{default:!0}})};q(m,d=>{t.queue.isPaused?d(y):d(L,!1)})}c(r,i)};q(we,r=>{!x()&&!a(M)&&r(Ge)})}var $e=l(we,2);{var Ne=r=>{var i=Ua(),_=j(i);{var n=d=>{H(d,{color:"dark-gray",onClick:()=>t.onCommand({command:E.Start,force:!0}),children:(D,N)=>{var P=Na(),k=j(P);B(k,{get icon(){return pa},size:"24"});var w=l(k,2),I=o(w,!0);s(w),b(()=>h(I,t.allText)),c(D,P)},$$slots:{default:!0}})};q(_,d=>{t.allText&&d(n)})}var m=l(_,2);{var y=d=>{H(d,{color:"gray",onClick:()=>t.onCommand({command:E.Start,force:void 0}),children:(D,N)=>{var P=Ha(),k=j(P);B(k,{get icon(){return xa},size:"24"});var w=l(k,2),I=o(w,!0);s(w),b(()=>h(I,t.refreshText)),c(D,P)},$$slots:{default:!0}})};q(m,d=>{t.refreshText&&d(y)})}var L=l(m,2);H(L,{color:"light-gray",onClick:()=>t.onCommand({command:E.Start,force:!1}),children:(d,D)=>{var N=Ka(),P=j(N);B(P,{get icon(){return va},size:"24"});var k=l(P,2),w=o(k,!0);s(k),b(()=>h(w,t.missingText)),c(d,N)},$$slots:{default:!0}}),c(r,i)};q($e,r=>{!x()&&a(K)&&a(M)&&r(Ne)})}var He=l($e,2);{var Ke=r=>{H(r,{color:"light-gray",onClick:()=>t.onCommand({command:E.Start,force:!1}),children:(i,_)=>{var n=Va(),m=j(n);B(m,{get icon(){return ga},size:"48"});var y=l(m,2),L=o(y,!0);s(y),b(()=>h(L,t.missingText)),c(i,n)},$$slots:{default:!0}})};q(He,r=>{!x()&&!a(K)&&a(M)&&r(Ke)})}s(Ce),s(J),b((r,i,_,n)=>{h(Ie,r),h(Ee,i),h(Ae,_),h(Be,n)},[()=>e()("active"),()=>a(v).active.toLocaleString(g()),()=>a(S).toLocaleString(g()),()=>e()("waiting")]),c($,J),de(),p()}var Ya=f('<a class="text-primary"> </a>');function Za($,t){le(t,!1);const e=()=>Z(ie,"$t",g),[g,T]=ce();wa();{const p=(F,O)=>{let R=()=>O?.().message;var C=Ya(),v=o(C,!0);s(C),b(S=>{ha(C,"href",S),h(v,R())},[()=>ge.systemSettings({isOpen:$a.STORAGE_TEMPLATE})]),c(F,C)};let x=aa(()=>({template:e()("admin.storage_template_settings")}));Ta($,{key:"admin.storage_template_migration_description",get values(){return a(x)},children:p,$$slots:{default:!0}})}de(),T()}var et=f('<div class="flex flex-col gap-7 mt-10"></div>');function at($,t){le(t,!0);const e=()=>Z(ie,"$t",g),[g,T]=ce(),p=Pa.value,x={[Q.ThumbnailGeneration]:{allText:e()("all"),missingText:e()("missing")},[Q.MetadataExtraction]:{allText:e()("all"),missingText:e()("missing")},[Q.Library]:{missingText:e()("rescan")},[Q.Sidecar]:{allText:e()("sync"),missingText:e()("discover"),disabled:!p.sidecar},[Q.SmartSearch]:{allText:e()("all"),missingText:e()("missing"),disabled:!p.smartSearch},[Q.DuplicateDetection]:{allText:e()("all"),missingText:e()("missing"),disabled:!p.duplicateDetection},[Q.FaceDetection]:{allText:e()("reset"),refreshText:e()("refresh"),missingText:e()("missing"),disabled:!p.facialRecognition},[Q.FacialRecognition]:{allText:e()("reset"),missingText:e()("missing"),disabled:!p.facialRecognition},[Q.Ocr]:{allText:e()("all"),missingText:e()("missing"),disabled:!p.ocr},[Q.VideoConversion]:{allText:e()("all"),missingText:e()("missing")},[Q.StorageTemplateMigration]:{missingText:e()("start"),description:Za},[Q.Migration]:{missingText:e()("start")}};let F=Object.entries(x);const O=async(C,v)=>{const S=Me(e(),{name:C});switch(C){case Q.FaceDetection:case Q.FacialRecognition:if(v.force){if(!await qa.showDialog({prompt:e()("admin.confirm_reprocess_all_faces")}))return;break}}try{await Ye({name:C,queueCommandDto:v}),await oe.refresh(),v.command===E.Empty&&da.success(e()("admin.cleared_jobs",{values:{job:S.title}}))}catch(M){ca(M,e()("admin.failed_job_command",{values:{command:v.command,job:S.title}}))}};var R=et();la(R,21,()=>F,([C,v])=>C,(C,v)=>{var S=u(()=>ta(a(v),2));let M=()=>a(S)[0],K=()=>a(S)[1];const J=u(()=>t.queues.find(({name:G})=>G===M()));var z=ze(),A=j(z);{var W=G=>{Xa(G,oa({get queue(){return a(J)},onCommand:U=>O(M(),U)},K))};q(A,G=>{a(J)&&G(W)})}c(C,z)}),s(R),c($,R),de(),T()}var tt=f("<!> <!> <!>",1);function St($,t){le(t,!0);const e=()=>Z(ie,"$t",g),[g,T]=ce();ea(()=>oe.listen());let p=u(()=>oe.queues);const x=u(()=>ba(e(),oe.queues)),F=u(()=>a(x).ResumePaused),O=u(()=>a(x).CreateJob),R=u(()=>a(x).ManageConcurrency),C=u(()=>[a(O),a(R)]),v=z=>{ra(p,a(p).map(A=>A.name===z.name?z:A))};var S=tt(),M=j(S);{let z=u(()=>e()("admin.queues"));Sa(M,{get name(){return a(z)},get actions(){return a(C)}})}var K=l(M,2);ia(K,{onQueueUpdate:v});var J=l(K,2);{let z=u(()=>[{title:t.data.meta.title}]),A=u(()=>[a(F),a(O),a(R)]);na(J,{get breadcrumbs(){return a(z)},get actions(){return a(A)},children:(W,G)=>{Qa(W,{size:"medium",center:!0,children:(U,ae)=>{var X=ze(),te=j(X);{var re=V=>{at(V,{get queues(){return a(p)}})};q(te,V=>{a(p)&&V(re)})}c(U,X)},$$slots:{default:!0}})},$$slots:{default:!0}})}c($,S),de(),T()}export{St as component,qt as universal};

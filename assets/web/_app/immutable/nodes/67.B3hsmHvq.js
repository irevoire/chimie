import{l as He,a as Ce}from"../chunks/BoJ7Vqag.js";import{O as De,b8 as Oe,M as se}from"../chunks/DeYUhNiz.js";import"../chunks/DsnmJJEf.js";import{p as Pe,f,t as o,s as l,g as p,h as Be,c as ne,a as ke,j as Te,n as d,r as le,u as W,aS as Me}from"../chunks/BOqQhZBJ.js";import{a as Ee,s}from"../chunks/BufZg4h2.js";import{f as g,t as i,a as e,c as fe}from"../chunks/CnteGC4G.js";import{i as k}from"../chunks/QS5y7wlf.js";import{a as $e,s as ye}from"../chunks/B227BkWK.js";import{A as Ue}from"../chunks/auPRkcHw.js";import{e as Ve}from"../chunks/D4fmOnVC.js";import{T as z,B as te,aA as Ae,a as be,cC as Xe,X as Re,x as Ie,cD as qe,ah as Ge}from"../chunks/LrV5ZTyj.js";import{$ as we}from"../chunks/DdY9CyNE.js";import{H as pe,S as Le}from"../chunks/Ze2c3aZz.js";import{H as ue}from"../chunks/C20f7eOz.js";import{M as Je,h as Ke,P as Ne}from"../chunks/DSVcT16j.js";import{S as Fe}from"../chunks/CWrj8NSO.js";import{F as Qe}from"../chunks/BbGcRfD-.js";import{m as We}from"../chunks/Jagi0WJL.js";import{L as Ye}from"../chunks/Dj0AsE1j.js";const Ze=(async()=>{await Promise.allSettled([He(),Ce()]);try{const{major:U,minor:m,patch:t}=await De();return{expectedVersion:`${U}.${m}.${t}`}}catch{return{expectedVersion:"0.0.0"}}}),Dt=Object.freeze(Object.defineProperty({__proto__:null,load:Ze},Symbol.toStringTag,{value:"Module"}));var et=g("<!> <!>",1),tt=g("<!> <!> <!>",1),rt=g("<!> <!>",1),at=g("<!> <!>",1),ot=g("<!> <!> <!>",1),st=g("<!> <!>",1),nt=g("<!> <!>",1),lt=g('<!> <!> <div class="bg-white dark:bg-black w-full m-4 p-6 rounded-xl border border-light-300"><!></div> <!> <!>',1);function it(U,m){Pe(m,!0);const t=()=>$e(we,"$t",h),[h,X]=ye();let I=Be(void 0);const q=async()=>{Te(I,await Oe(),!0)},L=(V,x)=>V?t()("maintenance_restore_library_folder_pass"):x?t()("maintenance_restore_library_folder_write_fail"):t()("maintenance_restore_library_folder_read_fail");Ee(()=>q());var re=lt(),F=f(re);pe(F,{size:"large",color:"primary",tag:"h1",children:(V,x)=>{d();var u=i();o(j=>s(u,j),[()=>t()("maintenance_restore_library")]),e(V,u)},$$slots:{default:!0}});var G=l(F,2);z(G,{children:(V,x)=>{d();var u=i();o(j=>s(u,j),[()=>t()("maintenance_restore_library_description")]),e(V,u)},$$slots:{default:!0}});var H=l(G,2),T=ne(H);Le(T,{children:(V,x)=>{var u=fe(),j=f(u);{var ie=$=>{var b=ot(),B=f(b);Ve(B,17,()=>p(I).storage,({folder:y,readable:_,writable:r})=>y,(y,_)=>{let r=()=>p(_).folder,a=()=>p(_).readable,n=()=>p(_).writable;ue(y,{children:(w,D)=>{var v=et(),S=f(v);{let A=W(()=>n()?Re:Ie),J=W(()=>n()?"text-success":"text-danger");be(S,{get icon(){return p(A)},get class(){return p(J)}})}var O=l(S,2);z(O,{children:(A,J)=>{d();var c=i();o(P=>s(c,`${r()??""} (${P??""})`),[()=>L(n(),a())]),e(A,c)},$$slots:{default:!0}}),e(w,v)},$$slots:{default:!0}})});var C=l(B,2);Ve(C,17,()=>p(I).storage,({folder:y,files:_})=>y,(y,_)=>{let r=()=>p(_).folder,a=()=>p(_).files;var n=fe(),w=f(n);{var D=v=>{ue(v,{class:"items-start",children:(S,O)=>{var A=at(),J=f(A);{let P=W(()=>`mt-1  ${a()?"text-success":r()==="profile"||r()==="upload"?"text-danger":"text-warning"}`),oe=W(()=>a()?Re:r()==="profile"||r()==="upload"?Ie:qe);be(J,{get class(){return p(P)},get icon(){return p(oe)}})}var c=l(J,2);Le(c,{gap:0,class:"items-start",children:(P,oe)=>{var R=rt(),E=f(R);z(E,{children:(ce,ge)=>{var de=fe(),he=f(de);{var me=N=>{var ee=i();o(M=>s(ee,M),[()=>t()("maintenance_restore_library_folder_has_files",{values:{folder:r(),count:a()}})]),e(N,ee)},xe=N=>{var ee=i();o(M=>s(ee,M),[()=>t()("maintenance_restore_library_folder_no_files",{values:{folder:r()}})]),e(N,ee)};k(he,N=>{a()?N(me):N(xe,!1)})}e(ce,de)},$$slots:{default:!0}});var je=l(E,2);{var ze=ce=>{var ge=tt(),de=f(ge);{var he=M=>{z(M,{variant:"italic",children:(_e,Se)=>{d();var Q=i();o(ve=>s(Q,ve),[()=>t()("maintenance_restore_library_hint_missing_files")]),e(_e,Q)},$$slots:{default:!0}})};k(de,M=>{(r()==="profile"||r()==="upload")&&M(he)})}var me=l(de,2);{var xe=M=>{z(M,{variant:"italic",children:(_e,Se)=>{d();var Q=i();o(ve=>s(Q,ve),[()=>t()("maintenance_restore_library_hint_regenerate_later")]),e(_e,Q)},$$slots:{default:!0}})};k(me,M=>{(r()==="encoded-video"||r()==="thumbs")&&M(xe)})}var N=l(me,2);{var ee=M=>{z(M,{variant:"italic",children:(_e,Se)=>{d();var Q=i();o(ve=>s(Q,ve),[()=>t()("maintenance_restore_library_hint_storage_template_missing_files")]),e(_e,Q)},$$slots:{default:!0}})};k(N,M=>{r()==="library"&&M(ee)})}e(ce,ge)};k(je,ce=>{a()||ce(ze)})}e(P,R)},$$slots:{default:!0}}),e(S,A)},$$slots:{default:!0}})};k(w,v=>{r()!=="backups"&&v(D)})}e(y,n)});var K=l(C,2);te(K,{get leadingIcon(){return Ae},variant:"ghost",onclick:q,children:(y,_)=>{d();var r=i();o(a=>s(r,a),[()=>t()("refresh")]),e(y,r)},$$slots:{default:!0}}),e($,b)},Z=$=>{ue($,{children:(b,B)=>{var C=st(),K=f(C);be(K,{get icon(){return Ae},color:"rgb(var(--immich-ui-primary))"});var y=l(K,2);z(y,{children:(_,r)=>{d();var a=i();o(n=>s(a,n),[()=>t()("maintenance_restore_library_loading")]),e(_,a)},$$slots:{default:!0}}),e(b,C)},$$slots:{default:!0}})};k(j,$=>{p(I)?$(ie):$(Z,!1)})}e(V,u)},$$slots:{default:!0}}),le(H);var ae=l(H,2);z(ae,{children:(V,x)=>{d();var u=i();o(j=>s(u,j),[()=>t()("maintenance_restore_library_confirm")]),e(V,u)},$$slots:{default:!0}});var Y=l(ae,2);ue(Y,{children:(V,x)=>{var u=nt(),j=f(u);te(j,{get onclick(){return m.end},variant:"ghost",children:(Z,$)=>{d();var b=i();o(B=>s(b,B),[()=>t()("cancel")]),e(Z,b)},$$slots:{default:!0}});var ie=l(j,2);te(ie,{get onclick(){return m.next},get trailingIcon(){return Xe},children:(Z,$)=>{d();var b=i();o(B=>s(b,B),[()=>t()("next")]),e(Z,b)},$$slots:{default:!0}}),e(V,u)},$$slots:{default:!0}}),e(U,re),ke(),X()}var ct=g("<!> <!>",1),dt=g("<!> <!> <!>",1);function _t(U,m){Pe(m,!0);const t=()=>$e(we,"$t",h),[h,X]=ye();var I=dt(),q=f(I);pe(q,{size:"large",color:"primary",tag:"h1",children:(F,G)=>{d();var H=i();o(T=>s(H,T),[()=>t()("maintenance_restore_from_backup")]),e(F,H)},$$slots:{default:!0}});var L=l(q,2);Fe(L,{class:"max-h-120 bg-white dark:bg-black p-4 rounded-2xl border border-light-300 w-full",children:(F,G)=>{Je(F,{get expectedVersion(){return m.expectedVersion}})},$$slots:{default:!0}});var re=l(L,2);ue(re,{children:(F,G)=>{var H=ct(),T=f(H);te(T,{get onclick(){return m.end},variant:"ghost",children:(Y,V)=>{d();var x=i();o(u=>s(x,u),[()=>t()("cancel")]),e(Y,x)},$$slots:{default:!0}});var ae=l(T,2);te(ae,{get onclick(){return m.previous},variant:"ghost",get leadingIcon(){return Ge},children:(Y,V)=>{d();var x=i();o(u=>s(x,u),[()=>t()("back")]),e(Y,x)},$$slots:{default:!0}}),e(F,H)},$$slots:{default:!0}}),e(U,I),ke(),X()}function vt(U,m){let t=Be(0);var h=fe(),X=f(h);{var I=L=>{it(L,{next:()=>Me(t),get end(){return m.end}})},q=L=>{_t(L,{previous:()=>Me(t,-1),get end(){return m.end},get expectedVersion(){return m.expectedVersion}})};k(X,L=>{p(t)===0?L(I):L(q,!1)})}e(U,h)}var ut=g('<pre class="text-left text-sm"><code> </code></pre>'),ft=g("<!> <!>",1),$t=g("<!> <!> <!> <!> <!>",1),mt=g("<!> <!>",1),pt=g("<p> </p> <!>",1),gt=g("<!> <p><!></p> <!>",1),ht=g('<div class="flex flex-col place-items-center text-center gap-8"><!></div>');function Ot(U,m){Pe(m,!0);const t=()=>$e(re,"$status",I),h=()=>$e(we,"$t",I),X=()=>$e(L,"$auth",I),[I,q]=ye(),{auth:L,status:re}=We,F=new URL(location.href);F.searchParams.get("token")&&(F.searchParams.delete("token"),history.replaceState({},document.title,F));const G=()=>Ke({action:se.End}),H=W(()=>t()?.error?.split(`
`).filter(T=>!T.includes("drop cascades")).join(`
`));{let T=W(()=>t()?.action===se.Start||t()?.action===se.End),ae=W(()=>t()?.action===se.Start);Ue(U,{get withHeader(){return p(T)},get withBackdrop(){return p(ae)},children:(Y,V)=>{var x=ht(),u=ne(x);{var j=$=>{var b=mt(),B=f(b);pe(B,{size:"large",color:"primary",tag:"h1",children:(_,r)=>{d();var a=i();o(n=>s(a,n),[()=>h()("maintenance_action_restore")]),e(_,a)},$$slots:{default:!0}});var C=l(B,2);{var K=_=>{var r=ft(),a=f(r);Fe(a,{class:"max-h-80",children:(w,D)=>{var v=ut(),S=ne(v),O=ne(S,!0);le(S),le(v),o(()=>s(O,p(H))),e(w,v)},$$slots:{default:!0}});var n=l(a,2);te(n,{onclick:G,children:(w,D)=>{d();var v=i();o(S=>s(v,S),[()=>h()("maintenance_end")]),e(w,v)},$$slots:{default:!0}}),e(_,r)},y=_=>{var r=$t(),a=f(r);{let c=W(()=>t().progress||0);Ne(a,{get progress(){return p(c)}})}var n=l(a,2);{var w=c=>{z(c,{children:(P,oe)=>{d();var R=i();o(E=>s(R,E),[()=>h()("maintenance_task_backup")]),e(P,R)},$$slots:{default:!0}})};k(n,c=>{t().task==="backup"&&c(w)})}var D=l(n,2);{var v=c=>{z(c,{children:(P,oe)=>{d();var R=i();o(E=>s(R,E),[()=>h()("maintenance_task_restore")]),e(P,R)},$$slots:{default:!0}})};k(D,c=>{t().task==="restore"&&c(v)})}var S=l(D,2);{var O=c=>{z(c,{children:(P,oe)=>{d();var R=i();o(E=>s(R,E),[()=>h()("maintenance_task_migrations")]),e(P,R)},$$slots:{default:!0}})};k(S,c=>{t().task==="migrations"&&c(O)})}var A=l(S,2);{var J=c=>{z(c,{children:(P,oe)=>{d();var R=i();o(E=>s(R,E),[()=>h()("maintenance_task_rollback")]),e(P,R)},$$slots:{default:!0}})};k(A,c=>{t().task==="rollback"&&c(J)})}e(_,r)};k(C,_=>{t().error?_(K):_(y,!1)})}e($,b)},ie=$=>{vt($,{end:G,get expectedVersion(){return m.data.expectedVersion}})},Z=$=>{var b=gt(),B=f(b);pe(B,{size:"large",color:"primary",tag:"h1",children:(r,a)=>{d();var n=i();o(w=>s(n,w),[()=>h()("maintenance_title")]),e(r,n)},$$slots:{default:!0}});var C=l(B,2),K=ne(C);Qe(K,{key:"maintenance_description",children:(a,n)=>{let w=()=>n?.().tag,D=()=>n?.().message;var v=fe(),S=f(v);{var O=A=>{Ye(A,{href:"https://docs.immich.app/administration/maintenance-mode",children:(J,c)=>{d();var P=i();o(()=>s(P,D())),e(J,P)},$$slots:{default:!0}})};k(S,A=>{w()==="link"&&A(O)})}e(a,v)},$$slots:{default:!0}}),le(C);var y=l(C,2);{var _=r=>{var a=pt(),n=f(a),w=ne(n,!0);le(n);var D=l(n,2);te(D,{onclick:G,children:(v,S)=>{d();var O=i();o(A=>s(O,A),[()=>h()("maintenance_end")]),e(v,O)},$$slots:{default:!0}}),o(v=>s(w,v),[()=>h()("maintenance_logged_in_as",{values:{user:X().username}})]),e(r,a)};k(y,r=>{X()&&r(_)})}e($,b)};k(u,$=>{t()?.action===se.RestoreDatabase?$(j):t()?.action===se.SelectDatabaseRestore&&X()?$(ie,1):$(Z,!1)})}le(x),e(Y,x)},$$slots:{default:!0}})}ke(),q()}export{Ot as component,Dt as universal};

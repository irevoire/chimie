import{Q as ue}from"../chunks/BNLYq5HQ.js";import{h as W,g as n,j as X,i as re,p as fe,f as P,u as f,c as $,a as he,s as t,t as ve,n as ge,r as F}from"../chunks/BOqQhZBJ.js";import{e as _e}from"../chunks/ytu5q_IM.js";import{T as Ae,j as pe}from"../chunks/DxfhPdFw.js";import{Y as be,Z}from"../chunks/DeYUhNiz.js";import{a as we,p as Pe}from"../chunks/Cx5lmlld.js";import{g as Te,$ as ye}from"../chunks/DdY9CyNE.js";import"../chunks/DsnmJJEf.js";import{s as Ce}from"../chunks/BufZg4h2.js";import{f as h,a as c,t as Se}from"../chunks/CnteGC4G.js";import{i as j}from"../chunks/QS5y7wlf.js";import{b as E}from"../chunks/9i_j0jQI.js";import{s as $e,a as K}from"../chunks/B227BkWK.js";import{a as Fe,g as Ie,i as ke}from"../chunks/C4XZXykC.js";import{A as M}from"../chunks/CT-ELVN-.js";import{U as xe,S as Be,h as De}from"../chunks/CwTmTzRk.js";import{B as ee}from"../chunks/Ydc33-3A.js";import{G as ze}from"../chunks/BO7gIFhw.js";import{B as Le,T as Oe,a as Ue}from"../chunks/C5SRuG4g.js";import{C as je,A as te}from"../chunks/D3TI8oak.js";import{F as Me,A as Re}from"../chunks/CJ8Y9ewd.js";import{C as He,a as Ne}from"../chunks/Td-V8-DQ.js";import{C as Ge,T as Je}from"../chunks/BgebDwf7.js";import{D as Ve}from"../chunks/DbL3L5r_.js";import{D as Qe}from"../chunks/CAJBNUk5.js";import{A as Ye}from"../chunks/DYbeYGSx.js";import{S as qe}from"../chunks/CWUfCk5h.js";import{R as We}from"../chunks/BeWG-__C.js";import{g as Xe}from"../chunks/Bc5ULZvy.js";import{A as Ze}from"../chunks/DeL_lkPB.js";import{a as I}from"../chunks/Jagi0WJL.js";import{g as Ee}from"../chunks/Dw326QmB.js";import{t as Ke}from"../chunks/BIB7ntQe.js";import{aX as et,aY as ae,T as tt,aG as at,I as rt,a6 as st,ae as ot,af as it}from"../chunks/LrV5ZTyj.js";class nt{#e=W(null);get folders(){return n(this.#e)}set folders(e){X(this.#e,e)}initialized=!1;#t=W(re({}));get assets(){return n(this.#t)}set assets(e){X(this.#t,e,!0)}constructor(){_e.on({AuthLogout:()=>this.clearCache()})}async fetchTree(){return this.initialized?this.folders:(this.initialized=!0,this.folders=Ae.fromPaths(await be()),this.folders.collapse(),this.folders)}bustAssetCache(){this.assets={}}async refreshAssetsByPath(e){return this.assets[e]=await Z({path:e})}async fetchAssetsByPath(e){return this.assets[e]??=await Z({path:e})}clearCache(){this.initialized=!1,this.assets={},this.folders=null}}const T=new nt,lt=(async({url:y})=>{await we(y);const[,e]=await Promise.all([T.fetchTree(),Te()]);let s=T.folders;const C=y.searchParams.get(ue.PATH);C?s=s.traverse(C):C===null&&T.bustAssetCache();const k=s.hasAssets?await T.fetchAssetsByPath(s.path):null;return{tree:s,pathAssets:k,meta:{title:e("folders")}}}),Zt=Object.freeze(Object.defineProperty({__proto__:null,load:lt},Symbol.toStringTag,{value:"Module"}));var dt=h('<!> <section><!> <div class="h-full"><!></div></section>',1),ct=h('<div class="mt-2"><!></div>'),mt=h('<!> <section class="mt-2 h-[calc(100%-(--spacing(25)))] overflow-auto immich-scrollbar"><!> <!></section>',1),ut=h("<!> <!>",1),ft=h("<!> <!> <!> <!> <!> <!> <!> <hr/> <!> <!> <!>",1),ht=h("<!> <!> <!> <!> <!>",1),vt=h('<div class="fixed top-0 start-0 w-full"><!></div>'),gt=h("<!> <!>",1);function Et(y,e){fe(e,!0);const s=()=>K(ye,"$t",k),C=()=>K(Pe,"$preferences",k),[k,se]=$e(),z=re({width:0,height:0}),i=new Ze,oe=o=>ie(pe(e.data.tree.path,o)),L=o=>We.folders({path:o});Fe(function(){I(i)});function ie(o){return Ie(L(o),{keepFocus:!0,noScroll:!0})}async function x(){I(i),e.data.tree.path&&await T.refreshAssetsByPath(e.data.tree.path),await ke()}function ne(){e.data.pathAssets&&i.selectAssets(e.data.pathAssets.map(o=>Ke(o)))}var R=gt(),H=P(R);xe(H,{get title(){return e.data.meta.title},sidebar:v=>{Be(v,{children:(B,S)=>{var b=dt(),d=P(b);{let a=f(()=>`#${De}`),w=f(()=>s()("skip_to_folders"));qe(d,{get target(){return n(a)},get text(){return n(w)},breakpoint:"md"})}var m=t(d,2),g=$(m);tt(g,{class:"ps-4 mb-4",size:"small",children:(a,w)=>{ge();var r=Se();ve(A=>Ce(r,A),[()=>s()("explorer")]),c(a,r)},$$slots:{default:!0}});var _=t(g,2),l=$(_);{let a=f(()=>({default:at,active:ae}));Ue(l,{get icons(){return n(a)},get tree(){return T.folders},get active(){return e.data.tree.path},getLink:L})}F(_),F(m),c(B,b)},$$slots:{default:!0}})},children:(v,B)=>{var S=mt(),b=P(S);{let l=f(()=>s()("folders"));Le(b,{get node(){return e.data.tree},get icon(){return et},get title(){return n(l)},getLink:L})}var d=t(b,2),m=$(d);Oe(m,{get items(){return e.data.tree.children},get icon(){return ae},onClick:oe});var g=t(m,2);{var _=l=>{var a=ct(),w=$(a);ze(w,{get assets(){return e.data.pathAssets},get assetInteraction(){return i},get viewport(){return z},showAssetName:!0,pageHeaderOffset:54,onReload:x}),F(a),E(a,"clientHeight",r=>z.height=r),E(a,"clientWidth",r=>z.width=r),c(l,a)};j(g,l=>{e.data.pathAssets&&e.data.pathAssets.length>0&&l(_)})}F(d),c(v,S)},$$slots:{sidebar:!0,default:!0}});var le=t(H,2);{var de=o=>{var v=vt(),B=$(v);Ye(B,{get assets(){return i.selectedAssets},clearSelect:()=>I(i),children:(S,b)=>{const d=f(()=>Xe(s(),Ee()));var m=ht(),g=P(m);je(g,{});var _=t(g,2);{let r=f(()=>s()("select_all"));rt(_,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return n(r)},get icon(){return st},onclick:ne})}var l=t(_,2);{let r=f(()=>s()("add_to"));ee(l,{get icon(){return ot},get title(){return n(r)},children:(A,O)=>{var u=ut(),p=P(u);te(p,{onAddToAlbum:()=>I(i)});var D=t(p,2);te(D,{onAddToAlbum:()=>I(i),shared:!0}),c(A,u)},$$slots:{default:!0}})}var a=t(l,2);Me(a,{get removeFavorite(){return i.isAllFavorite},onFavorite(r,A){if(e.data.pathAssets&&e.data.pathAssets.length>0)for(const O of r){const u=e.data.pathAssets.find(p=>p.id===O);u&&(u.isFavorite=A)}}});var w=t(a,2);{let r=f(()=>s()("menu"));ee(w,{get icon(){return it},get title(){return n(r)},children:(A,O)=>{var u=ft(),p=P(u);Qe(p,{menuItem:!0});var D=t(p,2);He(D,{menuItem:!0});var N=t(D,2);Ge(N,{menuItem:!0});var G=t(N,2);Ne(G,{menuItem:!0});var J=t(G,2);Re(J,{menuItem:!0,get unarchive(){return i.isAllArchived},onArchive:x});var V=t(J,2);{var ce=U=>{Je(U,{menuItem:!0})};j(V,U=>{C().tags.enabled&&i.isAllUserOwned&&U(ce)})}var Q=t(V,2);Ve(Q,{menuItem:!0,onAssetDelete:x,onUndoDelete:x});var Y=t(Q,4);M(Y,{get action(){return n(d).RegenerateThumbnailJob}});var q=t(Y,2);M(q,{get action(){return n(d).RefreshMetadataJob}});var me=t(q,2);M(me,{get action(){return n(d).TranscodeVideoJob}}),c(A,u)},$$slots:{default:!0}})}c(S,m)},$$slots:{default:!0}}),F(v),c(o,v)};j(le,o=>{i.selectionActive&&o(de)})}c(y,R),he(),se()}export{Et as component,Zt as universal};

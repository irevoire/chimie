import{a as ot}from"../chunks/Cx5lmlld.js";import{g as it,$ as Re}from"../chunks/DdY9CyNE.js";import{z as Fe,aP as nt,_ as Se,K as st,G as lt}from"../chunks/DeYUhNiz.js";import"../chunks/DsnmJJEf.js";import{d as je,s as de,e as Ae,a as dt}from"../chunks/BufZg4h2.js";import{p as He,g as e,h as L,P as ct,a as ke,f as ce,c as p,b as ze,r as v,j as o,i as Ie,$ as ut,u as f,s as x,n as Ge,t as G}from"../chunks/BOqQhZBJ.js";import{i as re}from"../chunks/QS5y7wlf.js";import{f as O,a as h,c as Le,s as We,t as Qe}from"../chunks/CnteGC4G.js";import{bz as vt,I as De,x as mt,bV as pt,B as qe,s as _e,bW as gt,bX as ft,bY as _t,a as Ke,ag as ht,$ as bt,bZ as yt,af as Pt,aw as wt,ax as xt,b_ as St,a0 as Et,f as Nt,r as It,b$ as Lt,G as Ht,H as kt}from"../chunks/LrV5ZTyj.js";import{a as Ue}from"../chunks/4T_x9N89.js";import{p as Ye,c as Xe,a as ue,s as Be}from"../chunks/B227BkWK.js";import{a as Ot}from"../chunks/Cv1syPnL.js";import{g as $e}from"../chunks/C4XZXykC.js";import{f as Ct,p as Mt}from"../chunks/C2I_EQjW.js";import{s as At}from"../chunks/_KdZ2AIy.js";import{I as Ze}from"../chunks/izWpGtDw.js";import{e as Dt,t as he,h as le}from"../chunks/D4fmOnVC.js";import{f as D,Q as Ee,S as Ne}from"../chunks/BNLYq5HQ.js";import{l as Je,r as et,h as Ve,Y as Tt}from"../chunks/Jagi0WJL.js";import{a as tt}from"../chunks/_U16pX41.js";import{f as Ft}from"../chunks/Bz1BELIr.js";import{A as Rt}from"../chunks/CT-ELVN-.js";import{B as Ut}from"../chunks/Ydc33-3A.js";import{R as be}from"../chunks/BeWG-__C.js";import{g as Bt,P as zt}from"../chunks/emnE70Qc.js";import{M as Te}from"../chunks/ClWsMFS7.js";import{P as Wt}from"../chunks/CaTmVaxL.js";import{U as $t}from"../chunks/CwTmTzRk.js";import{O as Vt}from"../chunks/Di6OVBka.js";import{q as jt}from"../chunks/Ze2c3aZz.js";import{m as Gt}from"../chunks/C20f7eOz.js";const Qt=(async({url:U})=>{await ot(U);const r=await Fe({withHidden:!0}),s=await it();return{people:r,meta:{title:s("people")}}}),zr=Object.freeze(Object.defineProperty({__proto__:null,load:Qt},Symbol.toStringTag,{value:"Module"}));var qt=O("<div><!></div>"),Kt=O('<div class="w-full grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 xl:grid-cols-7 2xl:grid-cols-10 gap-1"></div>');function rt(U,r){He(r,!0);let s=Ye(r,"hasNextPage",3,void 0),g=L(void 0);const B=new IntersectionObserver(T=>{T.find(i=>i.target===e(g))?.isIntersecting&&r.loadNextPage()});ct(()=>{e(g)&&(B.disconnect(),B.observe(e(g)))});var H=Kt();Dt(H,23,()=>r.people,T=>T.id,(T,y,i)=>{var c=Le(),C=ce(c);{var b=P=>{var k=qt(),M=p(k);We(M,()=>r.children??ze,()=>({person:e(y),index:e(i)})),v(k),Xe(k,m=>o(g,m),()=>e(g)),h(P,k)},F=P=>{var k=Le(),M=ce(k);We(M,()=>r.children??ze,()=>({person:e(y),index:e(i)})),h(P,k)};re(C,P=>{s()&&e(i)===r.people.length-1?P(b):P(F,!1)})}h(T,c)}),v(H),h(U,H),ke()}var Yt=O('<span class="absolute bottom-2 start-0 w-full select-text px-1 text-center font-medium text-white"> </span>'),Xt=O('<button type="button" class="group relative w-full h-full"><!> <!></button>'),Zt=O('<div class="h-full overflow-y-auto"><div class="sticky top-0 z-1 flex h-16 w-full items-center justify-between border-b bg-white p-1 dark:border-immich-dark-gray dark:bg-black dark:text-immich-dark-fg md:p-8"><div class="flex items-center"><!> <div class="flex gap-2 items-center"><p class="ms-2"> </p> <p class="text-sm text-gray-400 dark:text-gray-600"> </p></div></div> <div class="flex items-center justify-end"><div class="flex items-center md:me-4"><!> <!></div> <!></div></div> <div class="flex flex-wrap gap-1 p-2 pb-8 md:px-8"><!></div></div>');function Jt(U,r){He(r,!0);const s=()=>ue(Re,"$t",B),g=()=>ue(Je,"$locale",B),[B,H]=Be();let T=Ye(r,"titleId",3,void 0),y=L(Ie(D.SHOW_ALL)),i=L(!1);const c=new vt,C=d=>d===D.SHOW_ALL?D.HIDE_UNNANEMD:d===D.HIDE_UNNANEMD?D.HIDE_ALL:D.SHOW_ALL,b=()=>{o(y,C(e(y)),!0);for(const d of r.people){let u=c.get(d.id)??d.isHidden;e(y)===D.HIDE_ALL?u=!0:e(y)===D.SHOW_ALL?u=!1:e(y)===D.HIDE_UNNANEMD&&!d.name&&(u=!0),P(d,u)}},F=async()=>{o(i,!0);const d=Array.from(c,([u,E])=>({id:u,isHidden:E}));try{if(d.length>0){const u=await nt({peopleUpdateDto:{people:d}}),E=u.filter(({success:Z})=>Z).length,N=u.length-E;N>0&&he.warning(s()("errors.unable_to_change_visibility",{values:{count:N}})),he.success(s()("visibility_changed",{values:{count:E}}))}for(const u of r.people){const E=c.get(u.id);E!==void 0&&(u.isHidden=E)}c.clear(),r.onUpdate(r.people),r.onClose()}catch(u){le(u,s()("errors.unable_to_change_visibility",{values:{count:d.length}}))}finally{o(i,!1)}},P=(d,u)=>{if(u===d.isHidden){c.delete(d.id);return}c.set(d.id,u)};let k=f(()=>({[D.HIDE_ALL]:{icon:_t,label:s()("hide_all_people")},[D.HIDE_UNNANEMD]:{icon:ft,label:s()("hide_unnamed_people")},[D.SHOW_ALL]:{icon:gt,label:s()("show_all_people")}})),M=f(()=>e(k)[C(e(y))]);var m=Zt();Ue(ut,(d,u)=>tt?.(d,u),()=>({shortcut:{key:"Escape"},onShortcut:r.onClose}));var S=p(m),A=p(S),ae=p(A);{let d=f(()=>s()("close"));De(ae,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return e(d)},get icon(){return mt},get onclick(){return r.onClose}})}var Q=x(ae,2),q=p(Q),oe=p(q,!0);v(q);var K=x(q,2),ie=p(K);v(K),v(Q),v(A);var Y=x(A,2),X=p(Y),n=p(X);{let d=f(()=>s()("reset_people_visibility"));De(n,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return e(d)},get icon(){return pt},onclick:()=>c.clear()})}var ve=x(n,2);De(ve,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return e(M).label},get icon(){return e(M).icon},onclick:b}),v(X);var me=x(X,2);qe(me,{get loading(){return e(i)},onclick:F,size:"small",children:(d,u)=>{Ge();var E=Qe();G(N=>de(E,N),[()=>s()("done")]),h(d,E)},$$slots:{default:!0}}),v(Y),v(S);var ye=x(S,2),Oe=p(ye);rt(Oe,{get people(){return r.people},hasNextPage:!0,get loadNextPage(){return r.loadNextPage},children:(u,E)=>{let N=()=>E?.().person;const Z=f(()=>c.get(N().id)??N().isHidden);var z=Xt();z.__click=()=>P(N(),!e(Z));var pe=p(z);{let W=f(()=>et(N()));Ze(pe,{get hidden(){return e(Z)},shadow:!0,get url(){return e(W)},get altText(){return N().name},widthStyle:"100%",hiddenIconClass:"text-white group-hover:text-black transition-colors",preload:!1})}var Pe=x(pe,2);{var Ce=W=>{var t=Yt(),a=p(t,!0);v(t),G(()=>de(a,N().name)),h(W,t)};re(Pe,W=>{N().name&&W(Ce)})}v(z),G(W=>{_e(z,"aria-pressed",e(Z)),_e(z,"aria-label",W)},[()=>N().name?s()("hide_named_person",{values:{name:N().name}}):s()("hide_person")]),h(u,z)},$$slots:{default:!0}}),v(ye),v(m),G((d,u)=>{_e(q,"id",T()),de(oe,d),de(ie,`(${u??""})`)},[()=>s()("show_and_hide_people"),()=>r.totalPeopleCount.toLocaleString(g())]),h(U,m),ke(),H()}je(["click"]);var er=O('<div class="absolute top-4 start-4"><!></div>'),tr=O("<!> <!> <!> <!>",1),rr=O('<div class="absolute top-2 end-2 z-1"><!></div>'),ar=O('<div id="people-card" class="relative" role="group"><a draggable="false"><div class="w-full h-full rounded-xl brightness-95 filter"><!> <!></div></a> <!></div>');function or(U,r){He(r,!0);const s=()=>ue(Re,"$t",g),[g,B]=Be();let H=L(!1);const T=f(()=>Bt(s(),r.person)),y=f(()=>e(T).SetDateOfBirth);var i=ar(),c=p(i),C=p(c),b=p(C);{let m=f(()=>et(r.person));Ze(b,{shadow:!0,get url(){return e(m)},get altText(){return r.person.name},get title(){return r.person.name},widthStyle:"100%",circle:!0,preload:!1})}var F=x(b,2);{var P=m=>{var S=er(),A=p(S);Ke(A,{get icon(){return ht},size:"24",class:"text-white"}),v(S),h(m,S)};re(F,m=>{r.person.isFavorite&&m(P)})}v(C),v(c);var k=x(c,2);{var M=m=>{var S=rr(),A=p(S);{let ae=f(()=>s()("show_person_options"));Ut(A,{buttonClass:"icon-white-drop-shadow",color:"secondary",size:"medium",variant:"filled",get icon(){return Pt},get title(){return e(ae)},children:(Q,q)=>{var oe=tr(),K=ce(oe);{let n=f(()=>s()("hide_person"));Te(K,{get onClick(){return r.onHidePerson},get icon(){return bt},get text(){return e(n)}})}var ie=x(K,2);Rt(ie,{get action(){return e(y)}});var Y=x(ie,2);{let n=f(()=>s()("merge_people"));Te(Y,{get onClick(){return r.onMergePeople},get icon(){return yt},get text(){return e(n)}})}var X=x(Y,2);{let n=f(()=>r.person.isFavorite?wt:xt),ve=f(()=>r.person.isFavorite?s()("unfavorite"):s()("to_favorite"));Te(X,{get onClick(){return r.onToggleFavorite},get icon(){return e(n)},get text(){return e(ve)}})}h(Q,oe)},$$slots:{default:!0}})}v(S),h(m,S)};re(k,m=>{e(H)&&m(M)})}v(i),Ue(i,(m,S)=>Ft?.(m,S),()=>({onFocusOut:()=>o(H,!1)})),G(m=>_e(c,"href",m),[()=>be.viewPerson(r.person,{previousRoute:be.people()})]),Ae("mouseenter",i,()=>o(H,!0)),Ae("mouseleave",i,()=>o(H,!1)),Ae("focus",c,()=>o(H,!0)),h(U,i),ke(),B()}var ir=O('<div class="flex gap-2 items-center justify-center"><div class="hidden sm:block"><div class="w-40 lg:w-80 h-10"><!></div></div> <!></div>'),nr=O('<div class="p-2 rounded-xl hover:bg-gray-200 border-2 hover:border-immich-primary/50 hover:shadow-sm dark:hover:bg-immich-dark-primary/20 hover:dark:border-immich-dark-primary/25 border-transparent transition-all"><!> <input type="text" class=" bg-white dark:bg-immich-dark-gray border-gray-100 placeholder-gray-400 text-center dark:border-gray-900 w-full rounded-2xl mt-2 py-2 text-sm text-primary"/></div>'),sr=O('<div class="flex min-h-[calc(66vh-11rem)] w-full place-content-center items-center dark:text-white"><div class="flex flex-col content-center items-center text-center"><!> <p class="mt-5 text-3xl font-medium max-w-lg line-clamp-2 overflow-hidden"> </p></div></div>'),lr=O('<dialog class="fixed inset-0 h-full w-full max-w-none max-h-none bg-light" aria-labelledby="manage-visibility-title"><!></dialog>'),dr=O("<!> <!> <!>",1);function Wr(U,r){He(r,!0);const s=()=>ue(Mt,"$page",H),g=()=>ue(Re,"$t",H),B=()=>ue(Je,"$locale",H),[H,T]=Be();let y=L(!1),i=L(""),c=L(""),C=L(1),b=L(Ie(r.data.people.hasNextPage?2:null)),F=L(void 0),P=L(void 0),k=L(Ie([])),M=L(null),m=L(Ie([])),S=L(0),A=L(void 0);dt(()=>{const t=s().url.searchParams.get(Ee.SEARCHED_PEOPLE);return t&&(o(i,t,!0),e(A)&&Ve(e(A).searchPeople(!0,e(i)))),Tt.on("on_person_thumbnail",a=>{for(const l of e(n))l.id===a&&(l.updatedAt=new Date().toISOString())})});const ae=()=>new Promise(t=>{let a=sessionStorage.getItem(Ne.INFINITE_SCROLL_PAGE);if(a&&e(b)){let l=e(b),_=Number.parseInt(a)-e(b);_?Ve(Promise.all(Array.from({length:_}).map((w,J)=>Fe({withHidden:!0,page:l+J}))).then(w=>{for(const J of w)o(n,e(n).concat(J.people));o(C,l+_-1),o(b,w.at(-1)?.hasNextPage?l+_:null,!0),t()})):t(),sessionStorage.removeItem(Ne.INFINITE_SCROLL_PAGE)}}),Q=async()=>{if(e(b))try{const{people:t,hasNextPage:a}=await Fe({withHidden:!0,page:e(b)});o(n,e(n).concat(t)),e(b)!==null&&o(C,e(b),!0),o(b,a?e(b)+1:null,!0)}catch(t){le(t,g()("errors.failed_to_load_people"))}},q=async()=>{s().url.searchParams.get(Ee.SEARCHED_PEOPLE)!==e(i)&&(s().url.searchParams.set(Ee.SEARCHED_PEOPLE,e(i)),await $e(s().url,{keepFocus:!0}))},oe=async()=>{if(!e(M)||!e(F)||!e(P))return;const t=await Gt.show(zt,{personToMerge:e(F),personToBeMergedInto:e(P),potentialMergePeople:e(k)});if(!t){await E(e(F).id,e(c));return}const[a,l]=t,_=await lt({id:l.id});if(o(n,e(n).filter(w=>w.id!==a.id)),o(n,e(n).map(w=>w.id===l.id?_:w)),l.name!==e(c)&&e(M).id===l.id)try{await Se({id:l.id,personUpdateDto:{name:e(c)}});for(const w of e(n))if(w.id===l.id){w.name=e(c);break}he.success(g()("change_name_successfully"))}catch(w){le(w,g()("errors.unable_to_save_name"))}},K=async t=>{try{const a=await Se({id:t.id,personUpdateDto:{isHidden:!0}});o(n,e(n).map(l=>l.id===a.id?a:l)),he.success(g()("changed_visibility_successfully"))}catch(a){le(a,g()("errors.unable_to_hide_person"))}},ie=async t=>{try{const a=await Se({id:t.id,personUpdateDto:{isFavorite:!t.isFavorite}});o(n,e(n).map(l=>l.id===a.id?a:l)),he.success(a.isFavorite?g()("added_to_favorites"):g()("removed_from_favorites"))}catch(a){le(a,g()("errors.unable_to_add_remove_favorites",{values:{favorite:t.isFavorite}}))}},Y=async t=>{await $e(be.viewPerson(t,{previousRoute:be.people(),action:"merge"}))},X=async()=>{await Ct(Ee.SEARCHED_PEOPLE,s().url)};let n=f(()=>r.data.people.people),ve=f(()=>e(n).filter(t=>!t.isHidden)),me=f(()=>e(i)?e(m).length:r.data.people.total-r.data.people.hidden),ye=f(()=>e(i)?e(m):e(ve));const Oe=t=>{o(M,t,!0),o(c,t.name,!0)},d=async(t,a)=>{try{if(t==a.name)return;if(t===""){await E(a.id,"");return}const l=await N(t,a.id);if(l){o(F,a,!0),o(P,l,!0),o(k,e(n).filter(_=>e(P)?.name.toLowerCase()===_.name.toLowerCase()&&_.id!==e(P).id&&_.id!==e(F)?.id&&!_.isHidden).slice(0,3),!0),await oe();return}await E(a.id,t)}catch(l){le(l,g()("errors.unable_to_save_name"))}},u=t=>{t.target&&o(c,t.target.value,!0)},E=async(t,a)=>{await Se({id:t,personUpdateDto:{name:a}}),o(c,"")},N=async(t,a)=>(await st({name:t,withHidden:!0})).find(_=>_.name.toLowerCase()===t.toLowerCase()&&_.id!==a&&_.name),Z=t=>{o(n,e(n).map(a=>a.id===t.id?t:a))};var z=dr(),pe=ce(z);Vt(pe,{onPersonUpdate:Z});var Pe=x(pe,2);{const t=w=>{var J=Le(),we=ce(J);{var Me=ge=>{var fe=ir(),R=p(fe),$=p(R),ne=p($);{let V=f(()=>g()("search_people"));Xe(Wt(ne,{type:"searchBar",get placeholder(){return e(V)},onReset:X,onSearch:q,get searchName(){return e(i)},set searchName(I){o(i,I,!0)},get searchedPeopleLocal(){return e(m)},set searchedPeopleLocal(I){o(m,I,!0)}}),I=>o(A,I,!0),()=>e(A))}v($),v(R);var se=x(R,2);qe(se,{get leadingIcon(){return Et},onclick:()=>o(y,!e(y)),size:"small",variant:"ghost",color:"secondary",children:(V,I)=>{Ge();var j=Qe();G(xe=>de(j,xe),[()=>g()("show_and_hide_people")]),h(V,j)},$$slots:{default:!0}}),v(fe),h(ge,fe)};re(we,ge=>{e(n).length>0&&ge(Me)})}h(w,J)};let a=f(()=>g()("people")),l=f(()=>e(me)===0&&!e(i)?void 0:`(${e(me).toLocaleString(B())})`),_=f(()=>[[At,{routeStartsWith:be.people(),beforeSave:()=>{e(C)&&sessionStorage.setItem(Ne.INFINITE_SCROLL_PAGE,e(C).toString())},beforeClear:()=>{sessionStorage.removeItem(Ne.INFINITE_SCROLL_PAGE)},beforeLoad:ae}]]);$t(Pe,{get title(){return e(a)},get description(){return e(l)},get use(){return e(_)},buttons:t,children:(w,J)=>{var we=Le(),Me=ce(we);{var ge=R=>{{const $=(se,V)=>{let I=()=>V?.().person;var j=nr(),xe=p(j);or(xe,{get person(){return I()},onMergePeople:()=>Y(I()),onHidePerson:()=>K(I()),onToggleFavorite:()=>ie(I())});var ee=x(xe,2);It(ee),ee.__focusin=()=>Oe(I()),ee.__focusout=()=>d(e(c),I()),ee.__input=te=>u(te),Ue(ee,(te,at)=>tt?.(te,at),()=>({shortcut:{key:"Enter"},onShortcut:te=>te.currentTarget.blur()})),v(j),G(te=>{Nt(ee,I().name),_e(ee,"placeholder",te)},[()=>g()("add_a_name")]),h(se,j)};let ne=f(()=>!!e(b)&&!e(i));rt(R,{get people(){return e(ye)},get hasNextPage(){return e(ne)},loadNextPage:Q,children:$,$$slots:{default:!0}})}},fe=R=>{var $=sr(),ne=p($),se=p(ne);Ke(se,{get icon(){return St},size:"3.5em"});var V=x(se,2),I=p(V,!0);v(V),v(ne),v($),G(j=>de(I,j),[()=>g()(e(i)?"search_no_people_named":"search_no_people",{values:{name:e(i)}})]),h(R,$)};re(Me,R=>{e(me)>0&&(!e(i)||e(m).length>0)?R(ge):R(fe,!1)})}h(w,we)},$$slots:{buttons:!0,default:!0}})}var Ce=x(Pe,2);{var W=t=>{var a=lr(),l=p(a);Jt(l,{get people(){return e(n)},get totalPeopleCount(){return r.data.people.total},titleId:"manage-visibility-title",onClose:()=>o(y,!1),onUpdate:_=>o(n,_.slice()),loadNextPage:Q}),v(a),Lt(a,()=>_=>_.showModal()),Ht(3,a,()=>kt,()=>({y:e(S),duration:150,easing:jt,opacity:0})),h(t,a)};re(Ce,t=>{e(y)&&t(W)})}Ot("innerHeight",t=>o(S,t,!0)),h(U,z),ke(),T()}je(["focusin","focusout","input"]);export{Wr as component,zr as universal};

import{a as Gt,D as qt,p as Kt}from"../chunks/Cx5lmlld.js";import{g as Qt,$ as ze}from"../chunks/DdY9CyNE.js";import{G as pt,bf as Yt,z as ft,$ as Zt,bg as Jt,bh as it,_ as lt,K as Xt,A as er}from"../chunks/DeYUhNiz.js";import"../chunks/DsnmJJEf.js";import{s as ee,e as tr,d as _t,a as tt}from"../chunks/BufZg4h2.js";import{p as Me,c as n,s as o,t as j,a as De,n as Pe,r as s,g as e,u as c,h as E,i as _e,f as pe,j as t,at as rr,b as ct}from"../chunks/BOqQhZBJ.js";import{i as R}from"../chunks/QS5y7wlf.js";import{B as Ge,u as Be,aa as ht,I as bt,d3 as ar,d4 as sr,G as St,H as wt,d5 as yt,a as or,a$ as nr,b0 as ir,ae as Pt,d6 as lr,s as cr,w as dr,bZ as dt,af as ur,ah as gr,d7 as mr}from"../chunks/LrV5ZTyj.js";import{e as rt,t as $e,h as Ue}from"../chunks/D4fmOnVC.js";import{f as x,t as xe,a as l,s as ut,c as vr}from"../chunks/CnteGC4G.js";import{a as Xe}from"../chunks/4T_x9N89.js";import{p as ce,a as he,s as Fe,c as pr}from"../chunks/B227BkWK.js";import{g as Te,a as fr,i as _r}from"../chunks/C4XZXykC.js";import{j as hr,p as br}from"../chunks/C2I_EQjW.js";import{c as Sr}from"../chunks/BmZTbFl5.js";import{l as wr}from"../chunks/ghntbn61.js";import{a as yr}from"../chunks/_KdZ2AIy.js";import{I as qe}from"../chunks/izWpGtDw.js";import{P as xt}from"../chunks/CaTmVaxL.js";import{a as At}from"../chunks/Cv1syPnL.js";import{R as Re}from"../chunks/BeWG-__C.js";import{f as Pr}from"../chunks/DtjhqBtS.js";import{q as et}from"../chunks/Ze2c3aZz.js";import{C as Ke}from"../chunks/C9fqHGV9.js";import{r as je,l as xr,Y as Ar}from"../chunks/Jagi0WJL.js";import{m as Et}from"../chunks/C20f7eOz.js";import{a as gt,g as D,Q as We,S as Er}from"../chunks/BNLYq5HQ.js";import{O as Cr}from"../chunks/Di6OVBka.js";import{B as mt}from"../chunks/Ydc33-3A.js";import{M as kr}from"../chunks/ClWsMFS7.js";import{C as Ir,A as vt}from"../chunks/D3TI8oak.js";import{F as Tr,A as $r}from"../chunks/CJ8Y9ewd.js";import{C as Mr,a as Dr}from"../chunks/Td-V8-DQ.js";import{C as Nr,T as Lr}from"../chunks/BgebDwf7.js";import{D as Or}from"../chunks/DbL3L5r_.js";import{D as Br}from"../chunks/CAJBNUk5.js";import{S as Rr}from"../chunks/KeI0xpXW.js";import{S as Ur}from"../chunks/P5k8Owjv.js";import{A as zr}from"../chunks/DYbeYGSx.js";import{T as Fr}from"../chunks/-MdfcuX_.js";import{P as Vr,g as Hr}from"../chunks/emnE70Qc.js";import{A as Wr}from"../chunks/DeL_lkPB.js";import{C as jr}from"../chunks/BPix1jPq.js";const Gr=(async({params:q,url:a})=>{await Gt(a);const[i,b]=await Promise.all([pt({id:q.personId}),Yt({id:q.personId})]),H=await Qt();return{person:i,statistics:b,meta:{title:i.name||H("person")}}}),us=Object.freeze(Object.defineProperty({__proto__:null,load:Gr},Symbol.toStringTag,{value:"Module"}));var qr=x('<div><!> <form class="ms-4 flex w-full justify-between gap-16" autocomplete="off"><!> <!></form></div>');function Kr(q,a){Me(a,!0);const i=()=>he(ze,"$t",b),[b,H]=Fe();let f=ce(a,"name",15),d=ce(a,"suggestedPeople",15),m=ce(a,"isSearchingPeople",15);const C=w=>{w.preventDefault(),a.onChange(f())};var M=qr(),_=n(M);qe(_,{circle:!0,shadow:!0,get url(){return a.thumbnailData},get altText(){return a.person.name},widthStyle:"2rem",heightStyle:"2rem"});var N=o(_,2),S=n(N);xt(S,{type:"input",numberPeopleToSearch:5,inputClass:"w-full gap-2 bg-gray-100 dark:bg-gray-700 dark:text-white",get searchName(){return f()},set searchName(w){f(w)},get searchedPeopleLocal(){return d()},set searchedPeopleLocal(w){d(w)},get showLoadingSpinner(){return m()},set showLoadingSpinner(w){m(w)}});var u=o(S,2);Ge(u,{size:"small",shape:"round",type:"submit",children:(w,I)=>{Pe();var L=xe();j(O=>ee(L,O),[()=>i()("done")]),l(w,L)},$$slots:{default:!0}}),s(N),s(M),j(()=>Be(M,1,`flex w-full h-14 place-items-center ${d().length>0?"rounded-t-lg dark:border-immich-dark-gray":"rounded-lg"}  bg-gray-100 p-2 dark:bg-gray-700 border border-gray-200 dark:border-immich-dark-gray`)),tr("submit",N,C),l(q,M),De(),H()}var Qr=x("<div></div>"),Yr=x('<span class="w-100 text-white-shadow absolute bottom-2 start-0 w-full text-ellipsis px-1 text-center font-medium text-white hover:cursor-pointer"> </span>'),Zr=x('<button type="button" class="relative rounded-lg transition-all"><div><!></div> <div></div> <!> <!></button>');function Qe(q,a){Me(a,!0);let i=ce(a,"selectable",3,!1),b=ce(a,"selected",3,!1),H=ce(a,"thumbnailSize",3,null),f=ce(a,"circle",3,!1),d=ce(a,"border",3,!1),m=ce(a,"onClick",3,()=>{});var C=Zr();C.__click=()=>m()(a.person);let M;var _=n(C);let N;var S=n(_);{let v=c(()=>je(a.person));qe(S,{get circle(){return f()},get url(){return e(v)},get altText(){return a.person.name},widthStyle:"100%",shadow:!0})}s(_);var u=o(_,2);let w;var I=o(u,2);{var L=v=>{var k=Qr();let K;j(()=>K=Be(k,1,"absolute start-0 top-0 h-full w-full bg-blue-500/80",null,K,{"rounded-full":f(),"rounded-lg":!f()})),l(v,k)};R(I,v=>{b()&&v(L)})}var O=o(I,2);{var y=v=>{var k=Yr(),K=n(k,!0);s(k),j(()=>ee(K,a.person.name)),l(v,k)};R(O,v=>{a.person.name&&v(y)})}s(C),j(()=>{C.disabled=!i(),M=ht(C,"",M,{width:H()?H()+"px":"100%",height:H()?H()+"px":"100%"}),N=Be(_,1,"h-full w-full border-2 brightness-90 filter",null,N,{"rounded-full":f(),"rounded-lg":!f(),"border-transparent":!d(),"dark:border-immich-dark-primary":d(),"border-immich-primary":d()}),w=Be(u,1,"absolute start-0 top-0 h-full w-full bg-immich-primary/30 opacity-0",null,w,{"hover:opacity-100":i(),"rounded-full":f(),"rounded-lg":!f()})}),l(q,C),De()}_t(["click"]);var Jr=x('<div class="w-40 sm:w-48 md:w-full h-14 flex gap-4 place-items-center"><div class="md:w-96"><!></div> <!></div> <div class="immich-scrollbar overflow-y-auto rounded-3xl bg-gray-200 p-10 dark:bg-immich-dark-gray mt-6"><div class="grid-col-2 grid gap-8 md:grid-cols-3 lg:grid-cols-6 xl:grid-cols-8 2xl:grid-cols-10"></div></div>',1);function Ct(q,a){Me(a,!0);const i=()=>he(ze,"$t",b),[b,H]=Fe();let f=E(_e([])),d=E(!1),m=E("");const C=c(()=>(e(m)?e(f):a.people).filter(y=>!a.peopleToNotShow.some(v=>v.id===y.id)));var M=Jr(),_=pe(M),N=n(_),S=n(N);{let y=c(()=>i()("search_people"));xt(S,{type:"searchBar",get placeholder(){return e(y)},get searchName(){return e(m)},set searchName(v){t(m,v,!0)},get searchedPeopleLocal(){return e(f)},set searchedPeopleLocal(v){t(f,v,!0)}})}s(N);var u=o(N,2);{var w=y=>{{let v=c(()=>i()("sort_people_by_similarity"));bt(y,{shape:"round",color:"secondary",variant:"ghost",get icon(){return ar},onclick:()=>{t(d,!e(d)),a.handleSearch(e(d))},get"aria-label"(){return e(v)}})}};R(u,y=>{a.handleSearch&&y(w)})}s(_);var I=o(_,2);let L;var O=n(I);rt(O,21,()=>e(C),y=>y.id,(y,v)=>{Qe(y,{get person(){return e(v)},onClick:()=>a.onSelect(e(v)),circle:!0,border:!0,selectable:!0})}),s(O),s(I),j(()=>L=ht(I,"",L,{"max-height":a.screenHeight-400+"px"})),l(q,M),De(),H()}var Xr=x("<!> <div></div>",1),ea=x("<div><!></div>"),ta=x('<div class="absolute bottom-2"><!></div>'),ra=x('<div class="relative h-full"><div class="flex flex-col h-full justify-between"><div class="flex h-full items-center justify-center"><!></div> <!></div></div>'),aa=x('<section class="absolute start-0 top-0 h-full w-full bg-light"><!> <section class="px-17.5 pt-25"><section id="merge-face-selector"><div class="mb-10 h-50 place-content-center place-items-center"><p class="mb-4 text-center uppercase dark:text-white"> </p> <div class="grid grid-flow-col-dense place-content-center place-items-center gap-4"><!> <!> <!></div></div> <!></section></section></section>');function sa(q,a){Me(a,!0);const i=()=>he(ze,"$t",b),[b,H]=Fe();let f=ce(a,"person",15),d=E(_e([])),m=E(_e([])),C=E(0),M=c(()=>e(m).length>0),_=c(()=>[...e(m),f()]);const N=async(p=!1)=>{const h=await ft({withHidden:!1,closestPersonId:p?f().id:void 0});t(d,h.people,!0)};tt(N);const S=async()=>{(p=>{var h=rr(p,2);f(h[0]),e(m)[0]=h[1]})([e(m)[0],f()]),await Te(Re.viewPerson(f(),{previousRoute:Re.people(),action:"merge"}))},u=async p=>{if(e(m).includes(p)){t(m,e(m).filter(h=>h.id!==p.id),!0);return}if(e(m).length>=5){$e.warning(i()("merge_people_limit"));return}t(m,[p,...e(m)],!0),e(m).length===1&&!f().name&&p.name&&await S()},w=async()=>{if(await Et.showDialog({prompt:i()("merge_people_prompt")}))try{let h=await Zt({id:f().id,mergePersonDto:{ids:e(m).map(({id:$})=>$)}});const U=await pt({id:f().id}),G=h.filter(({success:$})=>$).length;$e.success(i()("merged_people_count",{values:{count:G}})),a.onMerge(U)}catch(h){Ue(h,i()("cannot_merge_people"))}};var I=aa(),L=n(I);Ke(L,{get onClose(){return a.onBack},leading:U=>{var G=Xr(),$=pe(G);{var Y=z=>{var F=xe();j(ie=>ee(F,ie),[()=>i()("selected_count",{values:{count:e(m).length}})]),l(z,F)},te=z=>{var F=xe();j(ie=>ee(F,ie),[()=>i()("merge_people")]),l(z,F)};R($,z=>{e(M)?z(Y):z(te,!1)})}Pe(2),l(U,G)},trailing:U=>{{let G=c(()=>!e(M));Ge(U,{get leadingIcon(){return yt},size:"small",shape:"round",get disabled(){return e(G)},onclick:w,children:($,Y)=>{Pe();var te=xe();j(z=>ee(te,z),[()=>i()("merge")]),l($,te)},$$slots:{default:!0}})}},$$slots:{leading:!0,trailing:!0}});var O=o(L,2),y=n(O),v=n(y),k=n(v),K=n(k,!0);s(k);var de=o(k,2),ge=n(de);rt(ge,25,()=>e(m),p=>p.id,(p,h,U,G)=>{var $=ea(),Y=n($);Qe(Y,{border:!0,circle:!0,get person(){return e(h)},selectable:!0,thumbnailSize:120,onClick:()=>u(e(h))}),s($),sr($,()=>Pr,()=>({duration:250,easing:et})),l(p,$)});var Ae=o(ge,2);{var ne=p=>{var h=ra(),U=n(h),G=n(U),$=n(G);or($,{get icon(){return nr},size:"48",class:"rotate-90 dark:text-white"}),s(G);var Y=o(G,2);{var te=z=>{var F=ta(),ie=n(F);{let g=c(()=>i()("swap_merge_direction"));bt(ie,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return e(g)},get icon(){return ir},size:"large",onclick:S})}s(F),l(z,F)};R(Y,z=>{e(m).length===1&&z(te)})}s(U),s(h),l(p,h)};R(Ae,p=>{e(M)&&p(ne)})}var T=o(Ae,2);Qe(T,{get person(){return f()},border:!0,circle:!0,selectable:!1,thumbnailSize:180}),s(de),s(v);var Q=o(v,2);Ct(Q,{get people(){return e(d)},get peopleToNotShow(){return e(_)},get screenHeight(){return e(C)},onSelect:u,handleSearch:N}),s(y),s(O),s(I),j(p=>ee(K,p),[()=>i()("choose_matching_people_to_merge")]),At("innerHeight",p=>t(C,p,!0)),St(3,I,()=>wt,()=>({y:500,duration:100,easing:et})),l(q,I),De(),H()}var oa=x("<!> <div></div>",1),na=x('<div class="flex gap-4"><!> <!></div>'),ia=x('<div class="mb-10 h-50 place-content-center place-items-center"><p class="mb-4 text-center uppercase dark:text-white">Choose matching faces to re assign</p> <div class="grid grid-flow-col-dense place-content-center place-items-center gap-4"><!></div></div>'),la=x('<section class="absolute start-0 top-0 h-full w-full bg-light"><!> <!> <section class="px-17.5 pt-25"><section id="merge-face-selector relative"><!> <!></section></section></section>');function ca(q,a){Me(a,!0);const i=()=>he(ze,"$t",b),[b,H]=Fe();let f=E(_e([])),d=E(null),m=E(!1),C=E(!1),M=E(!1),_=E(!1),N=E(0),S=c(()=>e(d)?[a.personAssets,e(d)]:[a.personAssets]);const u=[];for(const T of a.assetIds)u.push({assetId:T,personId:a.personAssets.id});tt(async()=>{const T=await ft({withHidden:!1});t(f,T.people,!0)});const w=T=>{if(e(d)&&e(d).id===T.id){I();return}t(d,T,!0),t(_,!0)},I=()=>{t(d,null),t(_,!1)},L=async()=>{const T=setTimeout(()=>t(C,!0),gt);try{t(m,!0);const Q=await Jt({personCreateDto:{}});await it({id:Q.id,assetFaceUpdateDto:{data:u}}),$e.success(i()("reassigned_assets_to_new_person",{values:{count:a.assetIds.length}}))}catch(Q){Ue(Q,i()("errors.unable_to_reassign_assets_new_person"))}finally{clearTimeout(T)}t(C,!1),a.onConfirm()},O=async()=>{const T=setTimeout(()=>t(M,!0),gt);try{t(m,!0),e(d)&&(await it({id:e(d).id,assetFaceUpdateDto:{data:u}}),$e.success(i()("reassigned_assets_to_existing_person",{values:{count:a.assetIds.length,name:e(d).name||null}})))}catch(Q){Ue(Q,i()("errors.unable_to_reassign_assets_existing_person",{values:{name:e(d)?.name||null}}))}finally{clearTimeout(T)}t(M,!1),a.onConfirm()};var y=la(),v=n(y);Ke(v,{get onClose(){return a.onClose},leading:p=>{var h=oa(),U=pe(h);ut(U,()=>a.header??ct),Pe(2),l(p,h)},trailing:p=>{var h=na(),U=n(h);{let $=c(()=>i()("create_new_person_hint")),Y=c(()=>e(m)||e(_));Ge(U,{shape:"round",get title(){return e($)},get leadingIcon(){return Pt},get loading(){return e(C)},size:"small",get disabled(){return e(Y)},onclick:L,children:(te,z)=>{Pe();var F=xe();j(ie=>ee(F,ie),[()=>i()("create_new_person")]),l(te,F)},$$slots:{default:!0}})}var G=o(U,2);{let $=c(()=>i()("reassing_hint")),Y=c(()=>e(m)||!e(_));Ge(G,{size:"small",shape:"round",get title(){return e($)},get leadingIcon(){return yt},get loading(){return e(M)},get disabled(){return e(Y)},onclick:O,children:(te,z)=>{Pe();var F=xe();j(ie=>ee(F,ie),[()=>i()("reassign")]),l(te,F)},$$slots:{default:!0}})}s(h),l(p,h)},$$slots:{leading:!0,trailing:!0}});var k=o(v,2);ut(k,()=>a.merge??ct);var K=o(k,2),de=n(K),ge=n(de);{var Ae=T=>{var Q=ia(),p=o(n(Q),2),h=n(p);Qe(h,{get person(){return e(d)},border:!0,circle:!0,selectable:!0,thumbnailSize:180,onClick:I}),s(p),s(Q),l(T,Q)};R(ge,T=>{e(d)!==null&&T(Ae)})}var ne=o(ge,2);Ct(ne,{get people(){return e(f)},get peopleToNotShow(){return e(S)},get screenHeight(){return e(N)},onSelect:w}),s(de),s(K),s(y),At("innerHeight",T=>t(N,T,!0)),St(3,y,()=>wt,()=>({y:500,duration:100,easing:et})),l(q,y),De(),H()}var da=x('<p class="text-sm text-gray-500 dark:text-gray-400"> </p>'),ua=x('<div class="relative"><button type="button" class="flex items-center justify-center"><!> <div class="flex flex-col justify-center text-start px-4 text-primary"><p class="w-40 sm:w-72 font-medium truncate"> </p> <p class="text-sm text-gray-500 dark:text-gray-400"> </p> <!></div></button></div>'),ga=x('<div class="flex border h-14 rounded-b-lg border-gray-400 dark:border-immich-dark-gray place-items-center bg-gray-200 p-2 dark:bg-gray-700"><div class="flex w-full place-items-center"><!></div></div>'),ma=x('<button type="button"><!> <p class="ms-4 text-gray-700 dark:text-gray-100"> </p></button>'),va=x("<div></div>"),pa=x('<div class="absolute w-64 sm:w-96 z-1"><!></div>'),fa=x('<div class="relative w-fit p-4 sm:px-6 pt-12"><section class="flex w-64 sm:w-96 place-items-center border-black"><!></section> <!></div>'),_a=x("<!> <!>",1),ha=x("<!> <!> <!> <!> <!> <!> <!> <!> <!>",1),ba=x("<!> <!> <!> <!> <!>",1),Sa=x("<!> <!>",1),wa=x('<!> <main class="relative z-0 h-dvh overflow-hidden px-2 md:px-6 md:pt-(--navbar-height-md) pt-(--navbar-height)"><!></main> <header><!></header> <!> <!>',1);function gs(q,a){Me(a,!0);const i=()=>he(br,"$page",d),b=()=>he(ze,"$t",d),H=()=>he(xr,"$locale",d),f=()=>he(Kt,"$preferences",d),[d,m]=Fe();let C=ce(a,"data",7),M=c(()=>C().statistics.assets),_=E(void 0);const N=c(()=>({visibility:er.Timeline,personId:C().person.id})),S=new Wr;let u=E(_e(D.VIEW_ASSETS)),w=E(!1),I=E(_e(Re.explore())),L=E(void 0),O=E(void 0),y=E(_e([])),v=E(!1),k="",K=E(_e([])),de=E(!1),ge=E(void 0);tt(()=>{const r=i().url.searchParams.get(We.ACTION),A=i().url.searchParams.get(We.PREVIOUS_ROUTE);return A&&!hr(A)&&t(I,A,!0),r=="merge"&&t(u,D.MERGE_PEOPLE,!0),Ar.on("on_person_thumbnail",re=>{e(g).id===re&&t(Ye,je(e(g),Date.now().toString()))})});const Ae=async()=>{if(S.selectionActive){S.clearMultiselect();return}await Te(e(I))},ne=async()=>{await _r()};fr(({from:r})=>{r?.url&&r.route.id!==i().route.id&&t(I,r.url.href,!0)});const T=()=>{e(_).removeAssets(S.selectedAssets.map(r=>r.id)),S.clearMultiselect(),t(u,D.VIEW_ASSETS,!0)},Q=()=>{t(u,D.UNASSIGN_ASSETS,!0)},p=async r=>{await ne(),await z(),C({...C(),person:r})},h=async r=>{if(e(u)===D.SELECT_PERSON){try{t(g,await lt({id:e(g).id,personUpdateDto:{featureFaceAssetId:r.id}})),$e.success(b()("feature_photo_updated"))}catch(A){Ue(A,b()("errors.unable_to_set_feature_photo"))}S.clearMultiselect(),t(u,D.VIEW_ASSETS,!0)}},U=async()=>{if(!e(L)||!e(O))return{merged:!1};const r=await Et.show(Vr,{personToMerge:e(L),personToBeMergedInto:e(O),potentialMergePeople:e(y)});if(!r)return{merged:!1};const[,A]=r;return A.name!=k&&e(g).id===A.id?(await ne(),{merged:!0}):(await Te(Re.viewPerson(A),{replaceState:!0}),{merged:!0})},G=async r=>{t(w,!1),e(g).id!==r.id&&(t(y,[],!0),k=e(g).name,t(L,e(g),!0),t(O,r,!0),t(v,!0),await U())},$=async()=>{if(t(u,D.VIEW_ASSETS,!0),e(g).name=k,t(w,!1),e(v)){t(v,!1);return}try{t(g,await lt({id:e(g).id,personUpdateDto:{name:k}})),$e.success(b()("change_name_successfully"))}catch(r){Ue(r,b()("errors.unable_to_save_name"))}},Y=()=>{t(de,!1),t(w,!1)},te=async r=>{if(t(w,!1),t(y,[],!0),k=r,e(g).name===k)return;if(r===""){await $();return}const A=await Xt({name:k,withHidden:!0}),re=A.find(({name:Z,id:ae})=>Z.toLowerCase()===k.toLowerCase()&&ae!==e(g).id&&Z);if(re){t(O,re,!0),t(L,e(g),!0),t(y,A.filter(ae=>e(O)?.name.toLowerCase()===ae.name.toLowerCase()&&ae.id!==e(O).id&&ae.id!==e(L)?.id&&!ae.isHidden).slice(0,3),!0);const{merged:Z}=await U();if(Z)return}await $()},z=async()=>{t(u,D.VIEW_ASSETS,!0),i().url.searchParams.has(We.ACTION)&&(i().url.searchParams.delete(We.ACTION),await Te(i().url))},F=async r=>{e(_).removeAssets(r),await ne()},ie=async r=>{e(_).upsertAssets(r),await ne()};let g=c(()=>C().person),Ye=c(()=>je(e(g)));const kt=r=>{e(_).removeAssets(r),S.clearMultiselect()},It=async r=>{if(r.id===e(g).id){if(r.isHidden){await Te(e(I));return}t(g,r)}},Tt=async({id:r,assetId:A})=>{r===e(g).id&&(e(_).removeAssets([A]),await ne())},Ne=c(()=>Hr(b(),e(g))),$t=c(()=>e(Ne).SetDateOfBirth),Mt=c(()=>e(Ne).Favorite),Dt=c(()=>e(Ne).Unfavorite),Nt=c(()=>e(Ne).HidePerson),Lt=c(()=>e(Ne).ShowPerson),Ot={title:b()("select_featured_photo"),icon:mr,onAction:()=>{t(u,D.SELECT_PERSON,!0)}},Bt={title:b()("merge_people"),icon:dt,onAction:()=>{t(u,D.MERGE_PEOPLE,!0)}};var at=wa(),st=pe(at);Cr(st,{onPersonUpdate:It,onPersonAssetDelete:Tt,onAssetsDelete:ne,onAssetsArchive:ne});var Ve=o(st,2),Rt=n(Ve);lr(Rt,()=>e(g).id,r=>{{let A=c(()=>e(u)===D.SELECT_PERSON),re=c(()=>e(u)===D.SELECT_PERSON);Fr(r,{enableRouting:!0,get person(){return e(g)},get options(){return e(N)},get assetInteraction(){return S},get isSelectionMode(){return e(A)},get singleSelect(){return e(re)},onSelect:h,onEscape:Ae,get timelineManager(){return e(_)},set timelineManager(Z){t(_,Z,!0)},children:(Z,ae)=>{var be=vr(),se=pe(be);{var Ee=me=>{var W=fa(),J=n(W),Le=n(J);{var Se=V=>{Kr(V,{get person(){return e(g)},get name(){return e(g).name},onChange:te,get thumbnailData(){return e(Ye)},get suggestedPeople(){return e(K)},set suggestedPeople(B){t(K,B,!0)},get isSearchingPeople(){return e(de)},set isSearchingPeople(B){t(de,B,!0)}})},we=V=>{var B=ua(),ve=n(B);ve.__click=()=>t(w,!0);var ye=n(ve);qe(ye,{circle:!0,shadow:!0,get url(){return e(Ye)},get altText(){return e(g).name},widthStyle:"3.375rem",heightStyle:"3.375rem"});var ke=o(ye,2),X=n(ke),oe=n(X,!0);s(X);var P=o(X,2),ue=n(P,!0);s(P);var Oe=o(P,2);{var nt=le=>{var fe=da(),Ie=n(fe,!0);s(fe),j(Je=>ee(Ie,Je),[()=>b()("person_birthdate",{values:{date:qt.fromISO(e(g).birthDate).toLocaleString({month:"numeric",day:"numeric",year:"numeric"},{locale:H()})}})]),l(le,fe)};R(Oe,le=>{e(g).birthDate&&le(nt)})}s(ke),s(ve),s(B),j((le,fe,Ie)=>{cr(ve,"title",le),ee(oe,fe),ee(ue,Ie)},[()=>b()("edit_name"),()=>e(g).name||b()("add_a_name"),()=>b()("assets_count",{values:{count:e(M)}})]),l(V,B)};R(Le,V=>{e(w)?V(Se):V(we,!1)})}s(J);var Ce=o(J,2);{var He=V=>{var B=pa(),ve=n(B);{var ye=X=>{var oe=ga(),P=n(oe),ue=n(P);dr(ue,{}),s(P),s(oe),l(X,oe)},ke=X=>{var oe=va();rt(oe,23,()=>e(K),P=>P.id,(P,ue,Oe,nt)=>{var le=ma();le.__click=()=>G(e(ue));var fe=n(le);{let jt=c(()=>je(e(ue)));qe(fe,{circle:!0,shadow:!0,get url(){return e(jt)},get altText(){return e(ue).name},widthStyle:"2rem",heightStyle:"2rem"})}var Ie=o(fe,2),Je=n(Ie,!0);s(Ie),s(le),j(()=>{Be(le,1,`flex w-full border border-gray-200 dark:border-immich-dark-gray h-14 place-items-center bg-gray-100 p-2 dark:bg-gray-700 hover:bg-gray-300 hover:dark:bg-[#232932] focus:bg-gray-300 focus:dark:bg-[#232932] ${e(Oe)===e(K).length-1?"rounded-b-lg border-b":""}`),ee(Je,e(ue).name)}),l(P,le)}),s(oe),pr(oe,P=>t(ge,P),()=>e(ge)),l(X,oe)};R(ve,X=>{e(de)?X(ye):X(ke,!1)})}s(B),l(V,B)};R(Ce,V=>{e(w)&&V(He)})}s(W),Xe(W,(V,B)=>Sr?.(V,B),()=>({onOutclick:Y,onEscape:Y})),Xe(W,(V,B)=>wr?.(V,B),()=>e(ge)),l(me,W)};R(se,me=>{e(u)===D.VIEW_ASSETS&&me(Ee)})}l(Z,be)},$$slots:{default:!0}})}}),s(Ve),Xe(Ve,(r,A)=>yr?.(r,A),()=>({routeStartsWith:Re.people(),beforeClear:()=>{sessionStorage.removeItem(Er.INFINITE_SCROLL_PAGE)}}));var Ze=o(Ve,2),Ut=n(Ze);{var zt=r=>{zr(r,{get assets(){return S.selectedAssets},clearSelect:()=>S.clearMultiselect(),children:(A,re)=>{var Z=ba(),ae=pe(Z);Ir(ae,{});var be=o(ae,2);Rr(be,{get timelineManager(){return e(_)},get assetInteraction(){return S}});var se=o(be,2);{let W=c(()=>b()("add_to"));mt(se,{get icon(){return Pt},get title(){return e(W)},children:(J,Le)=>{var Se=_a(),we=pe(Se);vt(we,{});var Ce=o(we,2);vt(Ce,{shared:!0}),l(J,Se)},$$slots:{default:!0}})}var Ee=o(se,2);Tr(Ee,{get removeFavorite(){return S.isAllFavorite},onFavorite:(W,J)=>e(_).update(W,Le=>Le.isFavorite=J)});var me=o(Ee,2);{let W=c(()=>b()("menu"));mt(me,{get icon(){return ur},get title(){return e(W)},children:(J,Le)=>{var Se=ha(),we=pe(Se);{let P=c(()=>e(g).name||"immich");Br(we,{menuItem:!0,get filename(){return`${e(P)??""}.zip`}})}var Ce=o(we,2);{let P=c(()=>b()("fix_incorrect_match"));kr(Ce,{get icon(){return dt},get text(){return e(P)},onClick:Q})}var He=o(Ce,2);Mr(He,{menuItem:!0});var V=o(He,2);Nr(V,{menuItem:!0});var B=o(V,2);Dr(B,{menuItem:!0});var ve=o(B,2);$r(ve,{menuItem:!0,get unarchive(){return S.isAllArchived},onArchive:(P,ue)=>e(_).update(P,Oe=>Oe.visibility=ue)});var ye=o(ve,2);{var ke=P=>{Lr(P,{menuItem:!0})};R(ye,P=>{f().tags.enabled&&S.isAllUserOwned&&P(ke)})}var X=o(ye,2);Ur(X,{menuItem:!0,onVisibilitySet:kt});var oe=o(X,2);Or(oe,{menuItem:!0,onAssetDelete:P=>F(P),onUndoDelete:P=>ie(P)}),l(J,Se)},$$slots:{default:!0}})}l(A,Z)},$$slots:{default:!0}})},Ft=r=>{var A=Sa(),re=pe(A);{var Z=se=>{Ke(se,{showBackButton:!0,get backIcon(){return gr},onClose:()=>Te(e(I)),trailing:me=>{{let W=c(()=>[Ot,e(Nt),e(Lt),e($t),Bt,e(Mt),e(Dt)]),J=c(()=>b()("open"));jr(me,{get items(){return e(W)},get"aria-label"(){return e(J)}})}},$$slots:{trailing:!0}})};R(re,se=>{e(u)===D.VIEW_ASSETS&&se(Z)})}var ae=o(re,2);{var be=se=>{Ke(se,{onClose:()=>t(u,D.VIEW_ASSETS,!0),leading:me=>{Pe();var W=xe();j(J=>ee(W,J),[()=>b()("select_featured_photo")]),l(me,W)},$$slots:{leading:!0}})};R(ae,se=>{e(u)===D.SELECT_PERSON&&se(be)})}l(r,A)};R(Ut,r=>{S.selectionActive?r(zt):r(Ft,!1)})}s(Ze);var ot=o(Ze,2);{var Vt=r=>{{let A=c(()=>S.selectedAssets.map(re=>re.id));ca(r,{get assetIds(){return e(A)},get personAssets(){return e(g)},onClose:()=>t(u,D.VIEW_ASSETS,!0),onConfirm:T})}};R(ot,r=>{e(u)===D.UNASSIGN_ASSETS&&r(Vt)})}var Ht=o(ot,2);{var Wt=r=>{sa(r,{get person(){return e(g)},onBack:z,onMerge:p})};R(Ht,r=>{e(u)===D.MERGE_PEOPLE&&r(Wt)})}l(q,at),De(),m()}_t(["click"]);export{gs as component,us as universal};

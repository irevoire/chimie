import{a as ue}from"../chunks/Cx5lmlld.js";import{g as pe,$ as L}from"../chunks/DdY9CyNE.js";import{ba as de,B as ge}from"../chunks/DeYUhNiz.js";import"../chunks/DsnmJJEf.js";import{d as ve,p as T,f as j,g as e,u as n,c as v,s as z,a as q,Q as ee,r as p,n as me,t as K,P as te,i as W,h as A,j as D}from"../chunks/BOqQhZBJ.js";import{f as Q,a as $,c as J}from"../chunks/CnteGC4G.js";import{a as fe}from"../chunks/Cv1syPnL.js";import{p as V,s as E,f as _e,a as I}from"../chunks/B227BkWK.js";import{U as he}from"../chunks/CwTmTzRk.js";import{i as U}from"../chunks/QS5y7wlf.js";import{I as re,aO as ye,aP as xe,G as be,aS as we,aU as $e,H as Ge,a as oe,bD as ke,s as H,cO as Se}from"../chunks/LrV5ZTyj.js";import{D as Ce}from"../chunks/8PJ7VpFA.js";import{S as Oe}from"../chunks/6ckOa7Ax.js";import{a8 as y,a9 as M,t as Be,l as Pe}from"../chunks/Jagi0WJL.js";import{d as Ne,s as F}from"../chunks/BufZg4h2.js";import{e as ne}from"../chunks/D4fmOnVC.js";import{n as ae}from"../chunks/CS-10t6W.js";import{R as ze}from"../chunks/BeWG-__C.js";import{g as Ie}from"../chunks/DPZFRR6n.js";const Qe=(async({url:o})=>{await ue(o);const t=await de(),s=await pe();return{items:t,meta:{title:s("places")}}}),gt=Object.freeze(Object.defineProperty({__proto__:null,load:Qe},Symbol.toStringTag,{value:"Module"})),X=[{id:y.None,isDisabled:()=>!1},{id:y.Country,isDisabled:()=>!1}],le=o=>{const t=X[0];return X.find(({id:s})=>o===s)??t},ie=o=>{const t=y.None,s=o.groupBy??t;return le(s).isDisabled()?t:s},Y=o=>{o.collapsedGroups??={};const{collapsedGroups:t,groupBy:s}=o;return t[s]??=[],t[s]},Re=(o,t)=>o.groupBy===y.None?!1:Y(o).includes(t),Me=o=>{const t=ve(M);if(t.groupBy===y.None)return;const s=Y(t),d=s.indexOf(o);d===-1?s.push(o):s.splice(d,1),M.set(t)},ce=o=>{M.update(t=>{const s=Y(t);return s.length=0,s.push(...o),t})},Ve=()=>{ce([])};var je=Q('<span><div class="hidden xl:flex gap-0"><div class="block"><!></div> <div class="block"><!></div></div></span>'),Ue=Q('<div class="hidden md:block h-10 xl:w-60 2xl:w-80"><!></div> <!> <!>',1);function Ae(o,t){T(t,!0);const s=()=>I(M,"$placesViewSettings",C),d=()=>I(L,"$t",C),[C,w]=E();let x=V(t,"searchQuery",15);const f=({id:r})=>{_e(M,ee(s).groupBy=r,ee(s))};let O=n(()=>e(b).id===y.None?we:$e),b=n(()=>le(s().groupBy)),G=n(()=>({[y.None]:d()("group_no"),[y.Country]:d()("group_country")}));var k=Ue(),S=j(k),_=v(S);{let r=n(()=>d()("search_places"));Oe(_,{get placeholder(){return e(r)},showLoadingSpinner:!1,get name(){return x()},set name(a){x(a)}})}p(S);var B=z(S,2);{let r=n(()=>d()("group_places_by")),a=n(()=>Object.values(X));Ce(B,{position:"bottom-right",get title(){return e(r)},get options(){return e(a)},get selectedOption(){return e(b)},onSelect:f,render:({id:c,isDisabled:u})=>({title:e(G)[c],icon:e(O),disabled:u()})})}var h=z(B,2);{var m=r=>{var a=je(),c=v(a),u=v(c),i=v(u);{let R=n(()=>d()("expand_all")),P=n(()=>d()("expand_all"));re(i,{get title(){return e(R)},onclick:()=>Ve(),variant:"ghost",color:"secondary",shape:"round",get icon(){return ye},get"aria-label"(){return e(P)}})}p(u);var l=z(u,2),N=v(l);{let R=n(()=>d()("collapse_all")),P=n(()=>d()("collapse_all"));re(N,{get title(){return e(R)},onclick:()=>ce(t.placesGroups),variant:"ghost",color:"secondary",shape:"round",get icon(){return xe},get"aria-label"(){return e(P)}})}p(l),p(c),p(a),be(1,a,()=>Ge,()=>({x:-50,duration:250})),$(r,a)},g=n(()=>ie(s())!==y.None);U(h,r=>{e(g)&&r(m)})}$(o,k),q(),w()}var De=Q('<div class="grid"><button type="button" class="w-fit mt-2 pt-2 pe-2 mb-2 dark:text-immich-dark-fg"><!> <span class="font-bold text-3xl text-black dark:text-white"> </span> <span class="ms-1.5"> </span></button> <hr class="dark:border-immich-dark-gray"/></div>'),He=Q('<a class="relative" draggable="false"><div class="flex w-[calc((100vw-(72px+5rem))/2)] max-w-39 justify-center overflow-hidden rounded-xl brightness-75 filter"><img class="object-cover w-39 h-39" loading="lazy"/></div> <span class="absolute bottom-2 w-full text-ellipsis px-1 text-center text-sm font-medium capitalize text-white backdrop-blur-[1px] hover:cursor-pointer"> </span></a>'),Fe=Q('<div class="flex flex-row flex-wrap gap-4"></div>'),Le=Q('<!> <div class="mt-4"><!></div>',1);function se(o,t){T(t,!0);const s=()=>I(M,"$placesViewSettings",C),d=()=>I(L,"$t",C),[C,w]=E();let x=V(t,"group",3,void 0),f=n(()=>!!x()&&Re(s(),x().id)),O=n(()=>e(f)?"rotate-0":"rotate-90");var b=Le(),G=j(b);{var k=h=>{var m=De(),g=v(m);g.__click=()=>Me(x().id);var r=v(g);oe(r,{get icon(){return ke},size:"24",get class(){return`inline-block -mt-2.5 transition-all duration-250 ${e(O)??""}`}});var a=z(r,2),c=v(a,!0);p(a);var u=z(a,2),i=v(u);p(u),p(g),me(2),p(m),K(l=>{H(g,"aria-expanded",!e(f)),F(c,x().name),F(i,`(${l??""})`)},[()=>d()("places_count",{values:{count:t.places.length}})]),$(h,m)};U(G,h=>{x()&&h(k)})}var S=z(G,2),_=v(S);{var B=h=>{var m=Fe();ne(m,21,()=>t.places,g=>g.id,(g,r)=>{const a=n(()=>e(r).exifInfo?.city);var c=He(),u=v(c),i=v(u);p(u);var l=z(u,2),N=v(l,!0);p(l),p(c),K((R,P)=>{H(c,"href",R),H(i,"src",P),H(i,"alt",e(a)),F(N,e(a))},[()=>ze.search({city:e(a)}),()=>Be({id:e(r).id,size:ge.Thumbnail})]),$(g,c)}),p(m),$(h,m)};U(_,h=>{e(f)||h(B)})}p(S),$(o,b),q(),w()}Ne(["click"]);var Te=Q('<div class="flex min-h-[calc(66vh-11rem)] w-full place-content-center items-center dark:text-white"><div class="flex flex-col content-center items-center text-center"><!> <p class="mt-5 text-3xl font-medium"> </p></div></div>');function qe(o,t){T(t,!0);const s=()=>I(L,"$t",d),[d,C]=E();let w=V(t,"places",27,()=>W([])),x=V(t,"searchQuery",3,""),f=V(t,"searchResultCount",15,0),O=V(t,"placesGroupIds",31,()=>W([]));const b={[y.None]:r=>[{id:s()("places"),name:s()("places"),places:r}],[y.Country]:r=>{const a=s()("unknown_country"),c=Ie(r,i=>i.exifInfo?.country??a);return Object.entries(c).sort(([i],[l])=>i===a?1:l===a?-1:i.localeCompare(l)).map(([i,l])=>({id:i,name:i,places:l}))}},G=n(()=>{const r=ae(x());return r?w().filter(a=>ae(a.exifInfo?.city??"").includes(r)):w()}),k=n(()=>ie(t.userSettings)),S=n(()=>b[e(k)]??b[y.None]),_=n(()=>e(S)(e(G)));te(()=>{f(e(G).length)}),te(()=>{O(e(_).map(({id:r})=>r))});var B=J(),h=j(B);{var m=r=>{var a=J(),c=j(a);{var u=l=>{se(l,{get places(){return e(_)[0].places}})},i=l=>{var N=J(),R=j(N);ne(R,17,()=>e(_),P=>P.id,(P,Z)=>{se(P,{get places(){return e(Z).places},get group(){return e(Z)}})}),$(l,N)};U(c,l=>{e(k)===y.None?l(u):l(i,!1)})}$(r,a)},g=r=>{var a=Te(),c=v(a),u=v(c);oe(u,{get icon(){return Se},size:"3.5em"});var i=z(u,2),l=v(i,!0);p(i),p(c),p(a),K(N=>F(l,N),[()=>s()("no_places")]),$(r,a)};U(h,r=>{w().length>0?r(m):r(g,!1)})}$(o,B),q(),C()}var Ee=Q('<div class="flex place-items-center gap-2"><!></div>');function vt(o,t){T(t,!0);const s=()=>I(L,"$t",w),d=()=>I(Pe,"$locale",w),C=()=>I(M,"$placesViewSettings",w),[w,x]=E();let f=A(""),O=A(0),b=A(W([])),G=n(()=>t.data.items.filter(_=>!!_.exifInfo?.city)),k=n(()=>e(f)?e(O):e(G).length),S=A(0);{const _=m=>{var g=Ee(),r=v(g);Ae(r,{get placesGroups(){return e(b)},get searchQuery(){return e(f)},set searchQuery(a){D(f,a,!0)}}),p(g),$(m,g)};let B=n(()=>s()("places")),h=n(()=>e(k)===0&&!e(f)?void 0:`(${e(k).toLocaleString(d())})`);he(o,{get title(){return e(B)},get description(){return e(h)},buttons:_,children:(m,g)=>{qe(m,{get places(){return e(G)},get userSettings(){return C()},get searchQuery(){return e(f)},get searchResultCount(){return e(O)},set searchResultCount(r){D(O,r,!0)},get placesGroupIds(){return e(b)},set placesGroupIds(r){D(b,r,!0)}})},$$slots:{buttons:!0,default:!0}})}fe("innerHeight",_=>D(S,_,!0)),q(),x()}export{vt as component,gt as universal};

import{Q as Ot,b as Rt,A as jt}from"../chunks/BNLYq5HQ.js";import{a as zt,p as Bt,u as Lt}from"../chunks/Cx5lmlld.js";import{g as G,$ as X}from"../chunks/DdY9CyNE.js";import{a1 as _t,b0 as Et,b1 as Nt,a2 as Ht}from"../chunks/DeYUhNiz.js";import"../chunks/DsnmJJEf.js";import{p as Y,h as Z,i as ht,f as S,n as $t,t as At,s,j as q,g as t,u as o,a as tt,c as j,r as z}from"../chunks/BOqQhZBJ.js";import{s as Tt}from"../chunks/BufZg4h2.js";import{f as A,t as bt,a as f}from"../chunks/CnteGC4G.js";import{i as K}from"../chunks/QS5y7wlf.js";import{a as B,s as et}from"../chunks/B227BkWK.js";import{g as Qt}from"../chunks/C4XZXykC.js";import{O as qt}from"../chunks/Di6OVBka.js";import{U as Gt,S as Jt,h as Kt}from"../chunks/CwTmTzRk.js";import{B as pt}from"../chunks/Ydc33-3A.js";import{B as Wt,a as Xt,T as ft}from"../chunks/C5SRuG4g.js";import{A as Yt}from"../chunks/DYbeYGSx.js";import{T as Zt}from"../chunks/-MdfcuX_.js";import{C as te,A as vt}from"../chunks/D3TI8oak.js";import{F as ee,A as re}from"../chunks/CJ8Y9ewd.js";import{C as ae,a as oe}from"../chunks/Td-V8-DQ.js";import{C as se,T as ne}from"../chunks/BgebDwf7.js";import{D as ie}from"../chunks/DbL3L5r_.js";import{D as le}from"../chunks/CAJBNUk5.js";import{S as ce}from"../chunks/KeI0xpXW.js";import{S as ue}from"../chunks/P5k8Owjv.js";import{S as me}from"../chunks/CWUfCk5h.js";import"../chunks/C2I_EQjW.js";import"../chunks/Jagi0WJL.js";import{R as de}from"../chunks/BeWG-__C.js";import{e as rt}from"../chunks/ytu5q_IM.js";import{T as wt,b5 as x,V as ge,bs as pe,ae as Ct,cv as fe,af as ve}from"../chunks/LrV5ZTyj.js";import{F as yt}from"../chunks/C0Ca_l_S.js";import{F as _e}from"../chunks/DzmAA-7p.js";import{I as he}from"../chunks/BJT5MMCK.js";import{S as $e}from"../chunks/Dm7jOiZu.js";import{t as at,h as ot}from"../chunks/D4fmOnVC.js";import{m as W}from"../chunks/C20f7eOz.js";import{A as Ae}from"../chunks/DeL_lkPB.js";import{j as Te,T as be}from"../chunks/DxfhPdFw.js";const we=(async({url:a})=>{await zt(a);const e=await G(),r=await _t();return{path:a.searchParams.get(Ot.PATH)??"",tags:r,meta:{title:e("tags")}}}),wr=Object.freeze(Object.defineProperty({__proto__:null,load:we},Symbol.toStringTag,{value:"Module"}));var Ce=A("<!> <!>",1);function ye(a,e){Y(e,!0);const r=()=>B(X,"$t",u),[u,v]=et();let p=Z(ht(e.baseTag?.path?`${e.baseTag.path}/`:""));const M=async()=>{await De(t(p))&&e.onClose()};{let l=o(()=>r()("create_tag")),D=o(()=>r()("create"));yt(a,{size:"small",get title(){return t(l)},get submitText(){return t(D)},get icon(){return x},get onClose(){return e.onClose},onSubmit:M,children:(F,i)=>{var c=Ce(),L=S(c);wt(L,{size:"small",children:(T,U)=>{$t();var k=bt();At(b=>Tt(k,b),[()=>r()("create_tag_description")]),f(T,k)},$$slots:{default:!0}});var E=s(L,2);{let T=o(()=>r()("tag"));_e(E,{get label(){return t(T)},required:!0,children:(U,k)=>{he(U,{autofocus:!0,get value(){return t(p)},set value(b){q(p,b,!0)}})},$$slots:{default:!0}})}f(F,c)},$$slots:{default:!0}})}tt(),v()}function Ie(a,e){Y(e,!0);const r=()=>B(X,"$t",u),[u,v]=et();let p=Z(ht(e.tag.color??""));const M=async()=>{await Pe(e.tag,{color:t(p)})&&e.onClose()};{let l=o(()=>r()("edit_tag"));yt(a,{get title(){return t(l)},size:"small",get icon(){return x},get onClose(){return e.onClose},onSubmit:M,children:(D,F)=>{{let i=o(()=>r()("color"));$e(D,{get inputType(){return Rt.COLOR},get label(){return t(i)},get value(){return t(p)},set value(c){q(p,c,!0)}})}},$$slots:{default:!0}})}tt(),v()}const Se=(a,e)=>{const r={title:a("create_tag"),icon:Ct,onAction:()=>W.show(ye,{baseTag:e})},u={title:a("edit_tag"),icon:pe,$if:()=>e.path.length>0,onAction:()=>W.show(Ie,{tag:e})},v={title:a("delete_tag"),icon:ge,$if:()=>e.path.length>0,onAction:()=>xe(e)};return{Create:r,Update:u,Delete:v}},De=async a=>{const e=await G();try{const[r]=await Ht({tagUpsertDto:{tags:[a]}});return r?(at.success(e("tag_created",{values:{tag:r.value}})),rt.emit("TagCreate",r),!0):void 0}catch(r){ot(r,e("errors.something_went_wrong"))}},Pe=async(a,e)=>{const r=await G();if(a.id)try{const u=await Nt({id:a.id,tagUpdateDto:e});return at.success(r("tag_updated",{values:{tag:a.value}})),rt.emit("TagUpdate",u),!0}catch(u){ot(u,r("errors.something_went_wrong"))}},xe=async a=>{const e=await G(),r=a.id;if(!(!r||!await W.showDialog({title:e("delete_tag"),prompt:e("delete_tag_confirmation_prompt",{values:{tagName:a.value}}),confirmText:e("delete")})))try{await Et({id:r}),rt.emit("TagDelete",a),at.success()}catch(v){ot(v,e("errors.something_went_wrong"))}};var Me=A('<!> <section><!> <div class="h-full"><!></div></section>',1),Fe=A('<!> <section class="mt-2 h-[calc(100%-(--spacing(20)))] overflow-auto immich-scrollbar"><!></section>',1),Ue=A("<!> <!>",1),ke=A("<!> <!> <!> <!> <!> <!> <!> <!>",1),Ve=A("<!> <!> <!> <!> <!>",1),Oe=A('<div class="fixed top-0 start-0 w-full"><!></div>'),Re=A("<!> <!> <section><!></section>",1);function Cr(a,e){Y(e,!0);const r=()=>B(X,"$t",p),u=()=>B(Lt,"$user",p),v=()=>B(Bt,"$preferences",p),[p,M]=et(),l=new Ae;let D=o(()=>e.data.tags);const F=o(()=>be.fromTags(t(D))),i=o(()=>t(F).traverse(e.data.path));let c=Z(void 0);const L=o(()=>({deferInit:!t(i),tagId:t(i)?.id})),E=n=>U(Te(e.data.path,n)),T=n=>de.tags({path:n}),U=n=>Qt(T(n)),k=n=>{t(c).removeAssets(n),l.clearMultiselect()},b=async()=>{q(D,await _t())},It=async n=>{n.path===t(i).path&&await U(t(i).parent?t(i).parent.path:""),await b()},J=o(()=>Se(r(),t(i))),St=o(()=>t(J).Create),Dt=o(()=>t(J).Update),Pt=o(()=>t(J).Delete);var st=Re(),nt=S(st);qt(nt,{onTagCreate:b,onTagUpdate:b,onTagDelete:It});var it=s(nt,2);{const n=O=>{Jt(O,{children:(N,H)=>{var h=Me(),$=S(h);{let d=o(()=>`#${Kt}`),g=o(()=>r()("skip_to_tags"));me($,{get target(){return t(d)},get text(){return t(g)},breakpoint:"md"})}var w=s($,2),C=j(w);wt(C,{class:"ps-4 mb-4",size:"small",children:(d,g)=>{$t();var P=bt();At(I=>Tt(P,I),[()=>r()("explorer")]),f(d,P)},$$slots:{default:!0}});var y=s(C,2),m=j(y);{let d=o(()=>({default:x,active:x}));Xt(m,{get icons(){return t(d)},get tree(){return t(F)},get active(){return t(i).path},getLink:T})}z(y),z(w),f(N,h)},$$slots:{default:!0}})};let V=o(()=>[t(St),t(Dt),t(Pt)]);Gt(it,{get title(){return e.data.meta.title},get actions(){return t(V)},sidebar:n,children:(O,N)=>{var H=Fe(),h=S(H);{let m=o(()=>r()("tags"));Wt(h,{get node(){return t(i)},get icon(){return fe},get title(){return t(m)},getLink:T})}var $=s(h,2),w=j($);{var C=m=>{Zt(m,{enableRouting:!0,get options(){return t(L)},get assetInteraction(){return l},get removeAction(){return jt.UNARCHIVE},get timelineManager(){return t(c)},set timelineManager(g){q(c,g,!0)},empty:g=>{ft(g,{get items(){return t(i).children},get icon(){return x},onClick:E})},$$slots:{empty:!0}})},y=m=>{ft(m,{get items(){return t(i).children},get icon(){return x},onClick:E})};K(w,m=>{t(i).hasAssets?m(C):m(y,!1)})}z($),f(O,H)},$$slots:{sidebar:!0,default:!0}})}var lt=s(it,2),xt=j(lt);{var Mt=n=>{var V=Oe(),O=j(V);Yt(O,{get ownerId(){return u().id},get assets(){return l.selectedAssets},clearSelect:()=>l.clearMultiselect(),children:(N,H)=>{var h=Ve(),$=S(h);te($,{});var w=s($,2);ce(w,{get timelineManager(){return t(c)},get assetInteraction(){return l}});var C=s(w,2);{let d=o(()=>r()("add_to"));pt(C,{get icon(){return Ct},get title(){return t(d)},children:(g,P)=>{var I=Ue(),R=S(I);vt(R,{});var Q=s(R,2);vt(Q,{shared:!0}),f(g,I)},$$slots:{default:!0}})}var y=s(C,2);ee(y,{get removeFavorite(){return l.isAllFavorite},onFavorite:(d,g)=>t(c).update(d,P=>P.isFavorite=g)});var m=s(y,2);{let d=o(()=>r()("menu"));pt(m,{get icon(){return ve},get title(){return t(d)},children:(g,P)=>{var I=ke(),R=S(I);le(R,{menuItem:!0});var Q=s(R,2);ae(Q,{menuItem:!0});var ct=s(Q,2);se(ct,{menuItem:!0});var ut=s(ct,2);oe(ut,{menuItem:!0});var mt=s(ut,2);re(mt,{menuItem:!0,onArchive:(_,kt)=>t(c).update(_,Vt=>Vt.visibility=kt)});var dt=s(mt,2);{var Ft=_=>{ne(_,{menuItem:!0})};K(dt,_=>{v().tags.enabled&&_(Ft)})}var gt=s(dt,2);ie(gt,{menuItem:!0,onAssetDelete:_=>t(c).removeAssets(_),onUndoDelete:_=>t(c).upsertAssets(_)});var Ut=s(gt,2);ue(Ut,{menuItem:!0,onVisibilitySet:k}),f(g,I)},$$slots:{default:!0}})}f(N,h)},$$slots:{default:!0}}),z(V),f(n,V)};K(xt,n=>{l.selectionActive&&n(Mt)})}z(lt),f(a,st),tt(),M()}export{Cr as component,wr as universal};

import{g as K}from"./C4XZXykC.js";import{e as T}from"./ytu5q_IM.js";import{s as ue}from"./FIvvbHQR.js";import"./DsnmJJEf.js";import{p as Z,c as h,n as j,t as x,s as U,g as o,u as l,r as w,a as ee,h as ae,f as ne,j as ie,d as le}from"./BOqQhZBJ.js";import{s as D}from"./BufZg4h2.js";import{f as P,t as z,a as d,c as ve}from"./CnteGC4G.js";import{a as te,s as se}from"./B227BkWK.js";import{c as ge}from"./Jagi0WJL.js";import{T as Q,I as he,b as we,X as ye,V as me,bx as _e,aC as Ae,by as be,bm as Ce,a9 as $e,aN as Ue}from"./LrV5ZTyj.js";import{$ as re,g as I}from"./DdY9CyNE.js";import{B as xe}from"./BZYF68wd.js";import{C as De}from"./CgxV3crx.js";import{i as ce}from"./QS5y7wlf.js";import{F as W}from"./BbGcRfD-.js";import{C as pe,m as L}from"./C20f7eOz.js";import{R as Y}from"./BeWG-__C.js";import{D as Pe,u as de}from"./Cx5lmlld.js";import{t as F,h as O}from"./D4fmOnVC.js";import{ap as ke,aq as oe,ar as Re,as as Me,at as Te}from"./DeYUhNiz.js";import{C as Ie}from"./BHgwLGQu.js";import{L as Fe}from"./eLOR7anR.js";import{A as Oe}from"./BEiKRg21.js";import{F as Se}from"./DzmAA-7p.js";import{I as Be}from"./BJT5MMCK.js";var Le=P('<div class="flex flex-col gap-4"><!> <div class="flex justify-center gap-2 items-center"><!> <!></div> <!></div>');function qe(s,e){Z(e,!0);const t=()=>te(re,"$t",a),[a,r]=se();{let n=l(()=>t()("password_reset_success")),u=l(()=>t()("done"));xe(s,{get title(){return o(n)},get icon(){return ye},get onClose(){return e.onClose},size:"small",get closeText(){return o(u)},children:(g,k)=>{var m=Le(),p=h(m);Q(p,{children:(c,f)=>{j();var i=z();x(b=>D(i,b),[()=>t()("admin.user_password_has_been_reset")]),d(c,i)},$$slots:{default:!0}});var y=U(p,2),R=h(y);De(R,{color:"primary",children:(c,f)=>{j();var i=z();x(()=>D(i,e.newPassword)),d(c,i)},$$slots:{default:!0}});var A=U(R,2);{let c=l(()=>t()("copy_password")),f=l(()=>t()("copy_password"));he(A,{get icon(){return we},shape:"round",color:"secondary",variant:"ghost",onclick:()=>ge(e.newPassword),get title(){return o(c)},get"aria-label"(){return o(f)}})}w(y);var M=U(y,2);Q(M,{children:(c,f)=>{j();var i=z();x(b=>D(i,b),[()=>t()("admin.user_password_reset_description")]),d(c,i)},$$slots:{default:!0}}),w(m),d(g,m)},$$slots:{default:!0}})}ee(),r()}var je=P("<b> </b>"),ze=P("<b> </b>"),Ne=P("<!> <!>",1),Ve=P('<div class="flex flex-col gap-4"><!> <div class="flex items-center gap-2"><!> <!></div> <!></div>');function Ee(s,e){Z(e,!0);const t=()=>te(re,"$t",a),[a,r]=se();let n=ae(!1),u=ae(""),g=l(()=>o(n)&&o(u)!==e.user.email);const k=async m=>{if(!m){e.onClose();return}await He(e.user,{force:o(n)})&&e.onClose()};{const m=R=>{var A=Ve(),M=h(A);Q(M,{children:(v,N)=>{var S=ve(),V=ne(S);{var B=_=>{{const C=(J,X)=>{let G=()=>X?.().message;var $=je(),H=h($,!0);w($),x(()=>D(H,G())),d(J,$)};let E=l(()=>({user:e.user.name}));W(_,{key:"admin.user_delete_immediately",get values(){return o(E)},children:C,$$slots:{default:!0}})}},q=_=>{{const C=(J,X)=>{let G=()=>X?.().message;var $=ze(),H=h($,!0);w($),x(()=>D(H,G())),d(J,$)};let E=l(()=>({user:e.user.name,delay:ue.value.userDeleteDelay}));W(_,{key:"admin.user_delete_delay",get values(){return o(E)},children:C,$$slots:{default:!0}})}};ce(V,_=>{o(n)?_(B):_(q,!1)})}d(v,S)},$$slots:{default:!0}});var c=U(M,2),f=h(c);Ie(f,{id:"queue-user-deletion-checkbox",color:"secondary",get checked(){return o(n)},set checked(v){ie(n,v,!0)}});var i=U(f,2);{let v=l(()=>t()("admin.user_delete_immediately_checkbox"));Fe(i,{get label(){return o(v)},for:"queue-user-deletion-checkbox"})}w(c);var b=U(c,2);{var fe=v=>{var N=Ne(),S=ne(N);Oe(S,{color:"danger",icon:!1,children:(B,q)=>{j();var _=z();x(C=>D(_,C),[()=>t()("admin.force_delete_user_warning")]),d(B,_)},$$slots:{default:!0}});var V=U(S,2);{let B=l(()=>t()("admin.confirm_email_below",{values:{email:e.user.email}}));Se(V,{get label(){return o(B)},children:(q,_)=>{Be(q,{get value(){return o(u)},set value(C){ie(u,C,!0)}})},$$slots:{default:!0}})}d(v,N)};ce(b,v=>{o(n)&&v(fe)})}w(A),d(R,A)};let p=l(()=>t()("delete_user")),y=l(()=>o(n)?t()("permanently_delete"):t()("delete"));pe(s,{get icon(){return me},get title(){return o(p)},get confirmText(){return o(y)},onClose:k,get disabled(){return o(g)},prompt:m,$$slots:{prompt:!0}})}ee(),r()}var Je=P("<b> </b>"),Xe=P("<p><!></p>");function Ge(s,e){Z(e,!0);const t=()=>te(re,"$t",a),[a,r]=se(),n=async u=>{if(!u)return;await Ke(e.user)&&e.onClose()};{const u=m=>{var p=Xe(),y=h(p);{const R=(M,c)=>{let f=()=>c?.().message;var i=Je(),b=h(i,!0);w(i),x(()=>D(b,f())),d(M,i)};let A=l(()=>({user:e.user.name}));W(y,{key:"admin.user_restore_description",get values(){return o(A)},children:R,$$slots:{default:!0}})}w(p),d(m,p)};let g=l(()=>t()("restore_user")),k=l(()=>t()("restore"));pe(s,{get icon(){return _e},get title(){return o(g)},get confirmText(){return o(k)},confirmColor:"primary",size:"small",onClose:n,prompt:u,$$slots:{prompt:!0}})}ee(),r()}const $t=s=>({Create:{title:s("create_user"),type:s("command"),icon:Ue,onAction:()=>K(Y.newUser()),shortcuts:{shift:!0,key:"n"}}}),Ut=(s,e)=>{const t={icon:$e,title:s("details"),onAction:()=>K(Y.viewUser(e))},a={icon:Ce,title:s("edit"),onAction:()=>K(Y.editUser(e))},r={icon:me,title:s("delete"),type:s("command"),color:"danger",$if:()=>le(de).id!==e.id&&!e.deletedAt,onAction:()=>L.show(Ee,{user:e}),shortcuts:{key:"Backspace"},shortcutOptions:{ignoreInputFields:!0}},n=m=>Pe.fromISO(m).plus({days:ue.value.userDeleteDelay}).toJSDate(),u={icon:_e,title:s("restore"),type:s("command"),color:"primary",data:{title:s("admin.user_restore_scheduled_removal",{values:{date:n(e.deletedAt)}})},$if:()=>!!e.deletedAt&&e.status===Re.Deleted,onAction:()=>L.show(Ge,{user:e})},g={icon:be,title:s("reset_password"),type:s("command"),$if:()=>le(de).id!==e.id,onAction:()=>We(e)},k={icon:Ae,type:s("command"),title:s("reset_pin_code"),onAction:()=>Ye(e)};return{Detail:t,Update:a,Delete:r,Restore:u,ResetPassword:g,ResetPinCode:k}},xt=async s=>{const e=await I();try{const t=await ke({userAdminCreateDto:s});return T.emit("UserAdminCreate",t),F.success(),t}catch(t){O(t,e("errors.unable_to_create_user"))}},Dt=async(s,e)=>{const t=await I();try{const a=await oe({id:s.id,userAdminUpdateDto:e});return T.emit("UserAdminUpdate",a),F.success(),!0}catch(a){return O(a,t("errors.unable_to_update_user")),!1}},He=async(s,e)=>{const t=await I();try{const a=await Te({id:s.id,userAdminDeleteDto:e});return T.emit("UserAdminDelete",a),F.success(),!0}catch(a){O(a,t("errors.unable_to_delete_user"))}},Ke=async s=>{const e=await I();try{const t=await Me({id:s.id});return T.emit("UserAdminRestore",t),F.success(),!0}catch(t){return O(t,e("errors.unable_to_restore_user")),!1}},Qe=(s=16)=>{let e="";const t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,.-{}+!#$%/()=?";for(let a=0;a<s;a++){let r=crypto.getRandomValues(new Uint32Array(1))[0];r=r/2**32,r=Math.floor(r*t.length),e+=t[r]}return e},We=async s=>{const e=await I(),t=e("admin.confirm_user_password_reset",{values:{user:s.name}});if(await L.showDialog({prompt:t}))try{const r={password:Qe(),shouldChangePassword:!0},n=await oe({id:s.id,userAdminUpdateDto:r});T.emit("UserAdminUpdate",n),F.success(),await L.show(qe,{newPassword:r.password})}catch(r){O(r,e("errors.unable_to_reset_password"))}},Ye=async s=>{const e=await I(),t=e("admin.confirm_user_pin_code_reset",{values:{user:s.name}});if(await L.showDialog({prompt:t}))try{const r=await oe({id:s.id,userAdminUpdateDto:{pinCode:null}});T.emit("UserAdminUpdate",r),F.success(e("pin_code_reset_successfully"))}catch(r){O(r,e("errors.unable_to_reset_pin_code"))}};export{$t as a,Dt as b,Ut as g,xt as h};

import{x as $,y as N,p as O,f as x,b as I,g as J,u as S,a as D}from"./BOqQhZBJ.js";import"./DsnmJJEf.js";import{c as P,s as W,a as F}from"./CnteGC4G.js";import{T,i as j,bo as E,ae as z,bp as M,bq as R,br as U,bs as B}from"./LrV5ZTyj.js";import{g as q}from"./C4XZXykC.js";import{e as h}from"./ytu5q_IM.js";import{R as v}from"./BeWG-__C.js";import{h as w,t as A}from"./D4fmOnVC.js";import{g as _}from"./DdY9CyNE.js";import{ab as k,ac as G,ad as H,ae as K,a0 as b,G as C}from"./DeYUhNiz.js";import{m as L}from"./C20f7eOz.js";function lt(t,e,r,o,n){$&&N();var s=e.$$slots?.[r],i=!1;s===!0&&(s=e[r==="default"?"children":r],i=!0),s===void 0?n!==null&&n(t):s(t,i?()=>o:o)}function ft(t){const e={};t.children&&(e.default=!0);for(const r in t.$$slots)e[r]=!0;return e}function dt(t,e){O(e,!0);{let r=S(()=>j("text-dark/75",e.class));T(t,{size:"small",get class(){return J(r)},children:(o,n)=>{var s=P(),i=x(s);W(i,()=>e.children??I),F(o,s)},$$slots:{default:!0}})}D()}const mt=(t,e)=>t.filter(r=>r.supportedContexts.includes(e)),ut=(t,e)=>t.filter(r=>r.supportedContexts.includes(e)),gt=(t,e,r,o,n)=>{const s={},i=[];for(let a=0;a<n;a++)i.push(t[`${e}_${a}`]??{});const[u]=i.splice(r,1);i.splice(o,0,u);for(let a=0;a<i.length;a++)s[`${e}_${a}`]=i[a];return s},pt=(t,e,r,o)=>{const n={};let s=0;for(let i=0;i<o;i++)i!==r&&(n[`${e}_${s}`]=t[`${e}_${i}`]??{},s++);return n},yt=(t,e)=>{const r={};if(e.filters&&t=="filter")for(const[o,n]of e.filters.entries())r[`filter_${o}`]=n.filterConfig??{};if(e.actions&&t=="action")for(const[o,n]of e.actions.entries())r[`action_${o}`]=n.actionConfig??{};return r},ht=(t,e,r,o,n,s,i,u)=>{const a=n.map((c,l)=>({[c.methodName]:i[`filter_${l}`]??{}})),g=s.map((c,l)=>({[c.methodName]:u[`action_${l}`]??{}}));return{name:t,description:e,enabled:r,triggerType:o,filters:a,actions:g}},wt=(t,e,r,o)=>{try{const n=JSON.parse(t),s=e.find(c=>c.type===n.triggerType),i=[],u={};if(Array.isArray(n.filters))for(const[c,l]of n.filters.entries()){const d=Object.keys(l)[0],f=r.find(p=>p.methodName===d);f&&(i.push(f),u[`filter_${c}`]=l[d])}const a=[],g={};if(Array.isArray(n.actions))for(const[c,l]of n.actions.entries()){const d=Object.keys(l)[0],f=o.find(p=>p.methodName===d);f&&(a.push(f),g[`action_${c}`]=l[d])}return{success:!0,data:{name:n.name??"",description:n.description??"",enabled:n.enabled??!1,trigger:s,filters:i,actions:a,filterConfigs:u,actionConfigs:g}}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Invalid JSON"}}},_t=(t,e,r,o,n,s,i,u,a)=>{if(e!==t.enabled||r!==(t.name??"")||o!==(t.description??"")||n!==t.triggerType)return!0;const g=t.filters?.map(m=>m.pluginFilterId)??[],c=s.map(m=>m.id);if(JSON.stringify(g)!==JSON.stringify(c))return!0;const l=t.actions?.map(m=>m.pluginActionId)??[],d=i.map(m=>m.id);if(JSON.stringify(l)!==JSON.stringify(d))return!0;const f={};for(const[m,y]of(t.filters??[]).entries())f[`filter_${m}`]=y.filterConfig??{};if(JSON.stringify(f)!==JSON.stringify(u))return!0;const p={};for(const[m,y]of(t.actions??[]).entries())p[`action_${m}`]=y.actionConfig??{};return JSON.stringify(p)!==JSON.stringify(a)},bt=async(t,e,r,o,n,s,i,u,a)=>{const g=s.map((d,f)=>({pluginFilterId:d.id,filterConfig:u[`filter_${f}`]??{}})),c=i.map((d,f)=>({pluginActionId:d.id,actionConfig:a[`action_${f}`]??{}}));return k({id:t,workflowUpdateDto:{name:e,description:r,enabled:o,filters:g,actions:c,triggerType:n}})},Ct=t=>({Create:{title:t("create_workflow"),icon:z,onAction:()=>Q({name:t("untitled_workflow"),triggerType:G.AssetCreate,filters:[],actions:[],enabled:!1})}}),At=(t,e)=>{const r={title:e.enabled?t("disable"):t("enable"),icon:e.enabled?M:R,color:e.enabled?"danger":"primary",onAction:async()=>{await V(e)}},o={title:t("edit"),icon:B,onAction:()=>q(v.viewWorkflow(e))},n={title:t("delete"),icon:U,color:"danger",onAction:async()=>{await X(e)}};return{ToggleEnabled:r,Edit:o,Delete:n}},kt=(t,e,r)=>({title:t(e?"hide_schema":"show_schema"),icon:E,onAction:r}),Q=async t=>{const e=await _();try{const r=await H({workflowCreateDto:t});h.emit("WorkflowCreate",r)}catch(r){w(r,e("errors.unable_to_create"))}},V=async t=>{const e=await _();try{const r=await k({id:t.id,workflowUpdateDto:{enabled:!t.enabled}});return h.emit("WorkflowUpdate",r),A.success(e("workflow_updated")),r}catch(r){w(r,e("errors.unable_to_update_workflow"))}},X=async t=>{const e=await _();if(!await L.showDialog({prompt:e("workflow_delete_prompt"),confirmColor:"danger"}))return!1;try{return await K({id:t.id}),h.emit("WorkflowDelete",t),A.success(e("workflow_deleted")),!0}catch(o){return w(o,e("errors.unable_to_delete_workflow")),!1}},$t=async(t,e)=>{if(!t)return;const r=e==="album-picker";try{if(Array.isArray(t)&&t.length>0)return r?await Promise.all(t.map(o=>b({id:o}))):await Promise.all(t.map(o=>C({id:o})));if(typeof t=="string"&&t)return r?await b({id:t}):await C({id:t})}catch(o){console.error("Failed to fetch picker metadata:",o)}};export{dt as C,At as a,kt as b,ft as c,mt as d,ut as e,$t as f,Ct as g,bt as h,yt as i,ht as j,_t as k,gt as l,wt as p,pt as r,lt as s};

import{g as K}from"./C4XZXykC.js";import{e as g}from"./ytu5q_IM.js";import"./DsnmJJEf.js";import{p as C,f as D,n as E,t as F,s as S,j as U,h as z,g as o,u as p,a as M,i as Y}from"./BOqQhZBJ.js";import{s as T}from"./BufZg4h2.js";import{f as k,t as I,a as L}from"./CnteGC4G.js";import{a as O,s as Q}from"./B227BkWK.js";import{T as R,ay as B,ci as Z,aN as G,V as W,bm as X,a9 as V}from"./LrV5ZTyj.js";import{$ as N,g as _}from"./DdY9CyNE.js";import{F as j}from"./C0Ca_l_S.js";import{F as q}from"./DzmAA-7p.js";import{I as J}from"./BJT5MMCK.js";import{R as H}from"./BeWG-__C.js";import{t as u,h as b}from"./D4fmOnVC.js";import{aR as tt,aS as P,aT as et,aU as rt,aJ as at,aK as st,aI as nt}from"./DeYUhNiz.js";import{m as $}from"./C20f7eOz.js";var ot=k("<!> <!>",1);function it(t,e){C(e,!0);const r=()=>O(N,"$t",a),[a,n]=Q();let s=z("");const f=async()=>{await Lt(e.library,o(s))&&e.onClose()};{let c=p(()=>r()("add_exclusion_pattern")),v=p(()=>r()("add"));j(t,{get title(){return o(c)},get icon(){return B},get onClose(){return e.onClose},onSubmit:f,get submitText(){return o(v)},size:"small",children:(A,w)=>{var m=ot(),h=D(m);R(h,{size:"small",class:"mb-4",children:(l,d)=>{E();var i=I();F(x=>T(i,x),[()=>r()("admin.exclusion_pattern_description")]),L(l,i)},$$slots:{default:!0}});var y=S(h,2);{let l=p(()=>r()("pattern"));q(y,{get label(){return o(l)},children:(d,i)=>{J(d,{get value(){return o(s)},set value(x){U(s,x,!0)}})},$$slots:{default:!0}})}L(A,m)},$$slots:{default:!0}})}M(),n()}var ct=k("<!> <!>",1);function lt(t,e){C(e,!0);const r=()=>O(N,"$t",a),[a,n]=Q();let s=z(Y(e.exclusionPattern));const f=async()=>{await $t(e.library,e.exclusionPattern,o(s))&&e.onClose()};{let c=p(()=>r()("edit_exclusion_pattern"));j(t,{get title(){return o(c)},get icon(){return B},get onClose(){return e.onClose},onSubmit:f,size:"small",children:(v,A)=>{var w=ct(),m=D(w);R(m,{size:"small",class:"mb-4",children:(y,l)=>{E();var d=I();F(i=>T(d,i),[()=>r()("admin.exclusion_pattern_description")]),L(y,d)},$$slots:{default:!0}});var h=S(m,2);{let y=p(()=>r()("pattern"));q(h,{get label(){return o(y)},children:(l,d)=>{J(l,{get value(){return o(s)},set value(i){U(s,i,!0)}})},$$slots:{default:!0}})}L(v,w)},$$slots:{default:!0}})}M(),n()}var dt=k("<!> <!>",1);function ut(t,e){C(e,!0);const r=()=>O(N,"$t",a),[a,n]=Q();let s=z("");const f=async()=>{await ft(e.library,o(s))&&e.onClose()};{let c=p(()=>r()("library_add_folder")),v=p(()=>r()("add"));j(t,{get title(){return o(c)},get icon(){return B},get onClose(){return e.onClose},onSubmit:f,size:"small",get submitText(){return o(v)},children:(A,w)=>{var m=dt(),h=D(m);R(h,{size:"small",class:"mb-4",children:(l,d)=>{E();var i=I();F(x=>T(i,x),[()=>r()("admin.library_folder_description")]),L(l,i)},$$slots:{default:!0}});var y=S(h,2);{let l=p(()=>r()("path"));q(y,{get label(){return o(l)},children:(d,i)=>{J(d,{get value(){return o(s)},set value(x){U(s,x,!0)}})},$$slots:{default:!0}})}L(A,m)},$$slots:{default:!0}})}M(),n()}var mt=k("<!> <!>",1);function yt(t,e){C(e,!0);const r=()=>O(N,"$t",a),[a,n]=Q();let s=z(Y(e.folder));const f=async()=>{await ht(e.library,e.folder,o(s))&&e.onClose()};{let c=p(()=>r()("library_edit_folder"));j(t,{get title(){return o(c)},get icon(){return B},get onClose(){return e.onClose},onSubmit:f,size:"small",children:(v,A)=>{var w=mt(),m=D(w);R(m,{size:"small",class:"mb-4",children:(y,l)=>{E();var d=I();F(i=>T(d,i),[()=>r()("admin.library_folder_description")]),L(y,d)},$$slots:{default:!0}});var h=S(m,2);{let y=p(()=>r()("path"));q(h,{get label(){return o(y)},children:(l,d)=>{J(l,{get value(){return o(s)},set value(i){U(s,i,!0)}})},$$slots:{default:!0}})}L(v,w)},$$slots:{default:!0}})}M(),n()}const Qt=(t,e)=>{const r={title:t("scan_all_libraries"),type:t("command"),icon:Z,onAction:()=>_t(),shortcuts:{shift:!0,key:"r"},$if:()=>e.length>0},a={title:t("create_library"),type:t("command"),icon:G,onAction:()=>K(H.newLibrary()),shortcuts:{shift:!0,key:"n"}};return{ScanAll:r,Create:a}},Rt=(t,e)=>{const r={icon:V,type:t("command"),title:t("details"),onAction:()=>K(H.viewLibrary(e))},a={icon:X,type:t("command"),title:t("edit"),onAction:()=>K(H.editLibrary(e)),shortcuts:{key:"r"}},n={icon:W,type:t("command"),title:t("delete"),color:"danger",onAction:()=>pt(e),shortcuts:{key:"Backspace"},shortcutOptions:{ignoreInputFields:!0}},s={icon:G,type:t("command"),title:t("add"),onAction:()=>$.show(ut,{library:e})},f={icon:G,type:t("command"),title:t("add"),onAction:()=>$.show(it,{library:e})},c={icon:Z,type:t("command"),title:t("scan_library"),onAction:()=>bt(e),shortcuts:{shift:!0,key:"r"}};return{Detail:r,Edit:a,Delete:n,AddFolder:s,AddExclusionPattern:f,Scan:c}},Bt=(t,e,r)=>{const a={icon:X,type:t("command"),title:t("edit"),onAction:()=>$.show(yt,{folder:r,library:e})},n={icon:W,type:t("command"),title:t("delete"),onAction:()=>gt(e,r)};return{Edit:a,Delete:n}},Nt=(t,e,r)=>{const a={icon:X,type:t("command"),title:t("edit"),onAction:()=>$.show(lt,{exclusionPattern:r,library:e})},n={icon:W,type:t("command"),title:t("delete"),onAction:()=>vt(e,r)};return{Edit:a,Delete:n}},_t=async()=>{const t=await _();try{await at({name:nt.Library,queueCommandDto:{command:st.Start}}),u.info(t("admin.refreshing_all_libraries"))}catch(e){b(e,t("errors.unable_to_scan_libraries"))}},bt=async t=>{const e=await _();try{await et({id:t.id}),u.info(e("admin.scanning_library"))}catch(r){b(r,e("errors.unable_to_scan_library"))}},jt=async t=>{const e=await _();try{const r=await tt({createLibraryDto:t});return g.emit("LibraryCreate",r),u.success(e("admin.library_created",{values:{library:r.name}})),r}catch(r){b(r,e("errors.unable_to_create_library"))}},qt=async(t,e)=>{const r=await _();try{const a=await P({id:t.id,updateLibraryDto:e});return g.emit("LibraryUpdate",a),u.success(r("admin.library_updated")),!0}catch(a){return b(a,r("errors.unable_to_update_library")),!1}},pt=async t=>{const e=await _();if(await $.showDialog({prompt:e("admin.confirm_delete_library",{values:{library:t.name}})})&&!(t.assetCount>0&&!await $.showDialog({prompt:e("admin.confirm_delete_library_assets",{values:{count:t.assetCount}})})))try{await rt({id:t.id}),g.emit("LibraryDelete",{id:t.id}),u.success(e("admin.library_deleted"))}catch(a){b(a,e("errors.unable_to_remove_library"))}},ft=async(t,e)=>{const r=await _();if(t.importPaths.includes(e))return u.danger(r("errors.library_folder_already_exists")),!1;try{const a=await P({id:t.id,updateLibraryDto:{importPaths:[...t.importPaths,e]}});g.emit("LibraryUpdate",a),u.success(r("admin.library_updated"))}catch(a){return b(a,r("errors.unable_to_update_library")),!1}return!0},ht=async(t,e,r)=>{const a=await _();if(e===r)return!0;const n=t.importPaths.map(s=>s===e?r:s);try{const s=await P({id:t.id,updateLibraryDto:{importPaths:n}});g.emit("LibraryUpdate",s),u.success(a("admin.library_updated"))}catch(s){return b(s,a("errors.unable_to_update_library")),!1}return!0},gt=async(t,e)=>{const r=await _();if(await $.showDialog({prompt:r("admin.library_remove_folder_prompt"),confirmText:r("remove")}))try{const n=await P({id:t.id,updateLibraryDto:{importPaths:t.importPaths.filter(s=>s!==e)}});g.emit("LibraryUpdate",n),u.success(r("admin.library_updated"))}catch(n){b(n,r("errors.unable_to_update_library"))}},Lt=async(t,e)=>{const r=await _();if(t.exclusionPatterns.includes(e))return u.danger(r("errors.exclusion_pattern_already_exists")),!1;try{const a=await P({id:t.id,updateLibraryDto:{exclusionPatterns:[...t.exclusionPatterns,e]}});g.emit("LibraryUpdate",a),u.success(r("admin.library_updated"))}catch(a){return b(a,r("errors.unable_to_update_library")),!1}return!0},$t=async(t,e,r)=>{const a=await _();if(e===r)return!0;const n=t.exclusionPatterns.map(s=>s===e?r:s);try{const s=await P({id:t.id,updateLibraryDto:{exclusionPatterns:n}});g.emit("LibraryUpdate",s),u.success(a("admin.library_updated"))}catch(s){return b(s,a("errors.unable_to_update_library")),!1}return!0},vt=async(t,e)=>{const r=await _();if(await $.showDialog({prompt:r("admin.library_remove_exclusion_pattern_prompt")}))try{const n=await P({id:t.id,updateLibraryDto:{exclusionPatterns:t.exclusionPatterns.filter(s=>s!==e)}});g.emit("LibraryUpdate",n),u.success(r("admin.library_updated"))}catch(n){b(n,r("errors.unable_to_update_library"))}};export{ut as L,Qt as a,qt as b,Bt as c,Nt as d,Rt as g,jt as h};

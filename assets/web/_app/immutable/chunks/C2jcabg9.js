import{d as h,h as d,i as y,g as o,j as m,u as f}from"./BOqQhZBJ.js";import{e as l}from"./ytu5q_IM.js";import{D as c,u}from"./Cx5lmlld.js";import{a as p}from"./De1sTUmb.js";import{t as A}from"./BIB7ntQe.js";import{a as M,r as g,u as v,s as w}from"./DeYUhNiz.js";class S{#e;constructor(){l.on({AuthLogout:()=>this.clearCache(),AuthUserLoaded:()=>this.initialize()}),h(u)&&this.initialize()}ready(){return this.initialize()}#s=d(y([]));get memories(){return o(this.#s)}set memories(s){m(this.#s,s,!0)}#t=f(()=>{const s=[];let e;for(const[t,i]of this.memories.entries())for(const[a,n]of i.assets.entries()){const r={memory:i,memoryIndex:t,previousMemory:this.memories[t-1],nextMemory:this.memories[t+1],asset:A(n),assetIndex:a,previous:e};s.push(r),e&&(e.next=r),e=r}return s});get memoryAssets(){return o(this.#t)}set memoryAssets(s){m(this.#t,s)}getMemoryAsset(s){return this.memoryAssets.find(e=>e.asset.id===s)??this.memoryAssets[0]}hideAssetsFromMemory(s){const e=new Set(s);for(const t of this.memories)t.assets=t.assets.filter(i=>!e.has(i.id));this.memories=this.memories.filter(t=>t.assets.length>0)}async deleteMemory(s){const e=this.memories.find(t=>t.id===s);e&&(await M({id:e.id}),this.memories=this.memories.filter(t=>t.id!==s))}async deleteAssetFromMemory(s){const e=this.memories.find(t=>t.assets.some(i=>i.id===s));e&&(e.assets.length===1?await this.deleteMemory(e.id):(await g({id:e.id,bulkIdsDto:{ids:[s]}}),e.assets=e.assets.filter(t=>t.id!==s)))}async updateMemorySaved(s,e){const t=this.memories.find(i=>i.id===s);t&&(await v({id:s,memoryUpdateDto:{isSaved:e}}),t.isSaved=e)}clearCache(){this.#e=void 0,this.memories=[]}initialize(){return this.#e||(this.#e=this.load()),this.#e}async load(){const s=await w({$for:p(c.now())});this.memories=s.filter(e=>e.assets.length>0)}}const I=new S;export{I as m};

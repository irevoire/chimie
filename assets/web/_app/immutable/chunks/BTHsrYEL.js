import{h as c}from"./D4fmOnVC.js";class r{constructor(t,e,i){this.loadedCallback=t,this.canceledCallback=e,this.errorCallback=i,this.init()}cancelToken=null;cancellable=!0;complete;executed=!1;loadedSignal;canceledSignal;get loading(){return!!this.cancelToken}async waitUntilCompletion(){if(this.executed)return"DONE";try{return await this.complete,"WAITED"}catch{}return"CANCELED"}async waitUntilExecution(){for(;;)try{return this.executed?"DONE":(await this.complete,"WAITED")}catch{continue}}async execute(t,e){if(this.executed)return"DONE";if(this.cancelToken)return this.cancellable&&!e&&(this.cancellable=e),await this.complete,"WAITED";this.cancellable=e;const i=this.cancelToken=new AbortController;try{return await t(i.signal),i.signal.aborted?"CANCELED":(this.#e(),"LOADED")}catch(n){return n.name==="AbortError"?"CANCELED":(this.#i(n),"ERRORED")}finally{this.cancelToken=null}}init(){this.complete=new Promise((t,e)=>{this.cancelToken=null,this.executed=!1,this.loadedSignal=t,this.canceledSignal=e}),this.complete.catch(()=>{})}async reset(){this.#t(),this.cancelToken&&await this.waitUntilCompletion(),this.init()}cancel(){this.#t()}#t(){this.executed||this.cancellable&&(this.cancelToken?.abort(),this.canceledSignal?.(),this.init(),this.canceledCallback?.())}#e(){this.executed=!0,this.loadedSignal?.(),this.loadedCallback?.()}#i(t){this.cancelToken=null,this.canceledSignal?.(),this.init(),this.errorCallback?.(t)}}class o{invocationsStarted=0;invocationsEnded=0;constructor(){}startInvocation(){this.invocationsStarted++;const t=this.invocationsStarted;return{isStillValid:()=>t===this.invocationsStarted,endInvocation:()=>{this.invocationsEnded=t}}}isActive(){return this.invocationsStarted!==this.invocationsEnded}async invoke(t,e){const i=this.startInvocation();try{return await t()}catch(n){c(n,e)}finally{i.endInvocation()}}}export{r as C,o as I};

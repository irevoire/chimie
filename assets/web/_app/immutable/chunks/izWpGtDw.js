import"./DsnmJJEf.js";import{p,c as B,s as D,t as W,a as F,r as A,f as $,g as u,h as E,u as K,j as z}from"./BOqQhZBJ.js";import{s as ee,e as T,r as te}from"./BufZg4h2.js";import{f as v,a as g}from"./CnteGC4G.js";import{i as P}from"./QS5y7wlf.js";import{a as ae}from"./4T_x9N89.js";import{a as G,c1 as re,u as H,aa as J,$ as se,s as w,q as ie}from"./LrV5ZTyj.js";import{p as t,s as le,a as oe}from"./B227BkWK.js";import{$ as ne}from"./DdY9CyNE.js";import{t as L}from"./Jagi0WJL.js";import{B as j}from"./DeYUhNiz.js";var de=v('<span class="text-center"> </span>'),ce=v("<div><!> <!></div>");function fe(l,e){p(e,!0);const s=()=>oe(ne,"$t",i),[i,o]=le();let f=t(e,"class",3,""),y=t(e,"hideMessage",3,!1),h=t(e,"width",3,void 0),x=t(e,"height",3,void 0);var n=ce();let m;var _=B(n);G(_,{get icon(){return re},size:"7em",class:"max-w-full"});var k=D(_,2);{var C=d=>{var c=de(),I=B(c,!0);A(c),W(M=>ee(I,M),[()=>s()("error_loading_image")]),g(d,c)};P(k,d=>{y()||d(C)})}A(n),W(()=>{H(n,1,`flex flex-col overflow-hidden max-h-full max-w-full justify-center items-center bg-gray-100/40 dark:bg-gray-700/40 dark:text-gray-100 p-4 ${f()??""}`),m=J(n,"",m,{width:h(),height:x()})}),g(l,n),F(),o()}class me{#e;constructor(e){this.#e=e}send(e,s){this.#e.controller?.postMessage({type:e,...s})}}const ue=globalThis.isSecureContext&&"serviceWorker"in navigator,N=ue?new me(navigator.serviceWorker):void 0;function V(l){!l||!N||N.send("cancel",{url:l})}class he{preload(e,s=j.Preview){if(!e)return;const i=L({id:e.id,size:s,cacheKey:e.thumbhash});if(!i)return;const o=new Image;o.src=i}cancel(e,s=j.Preview){if(!e)return;const i=s==="all"?Object.values(j):[s];for(const o of i){const f=L({id:e.id,size:o,cacheKey:e.thumbhash});f&&V(f)}}cancelPreloadUrl(e){e&&V(e)}}const ge=new he;var ve=v('<img draggable="false"/>'),ye=v('<div class="absolute start-1/2 top-1/2 translate-x-[-50%] translate-y-[-50%] transform"><!></div>'),_e=v("<!> <!>",1);function We(l,e){p(e,!0);let s=t(e,"title",3,null),i=t(e,"heightStyle",3,void 0),o=t(e,"curve",3,!1),f=t(e,"shadow",3,!1),y=t(e,"circle",3,!1),h=t(e,"hidden",3,!1),x=t(e,"border",3,!1),n=t(e,"hiddenIconClass",3,"text-white"),m=t(e,"onComplete",3,void 0),_=t(e,"class",3,""),k=t(e,"brokenAssetClass",3,""),C=t(e,"preload",3,!0),d=E(!1),c=E(!1);const I=()=>{z(d,!0),m()?.(!1)},M=()=>{z(c,!0),m()?.(!0)};function Q(r){return r.complete&&(z(d,!0),m()?.(!1)),{destroy:()=>ge.cancelPreloadUrl(e.url)}}let U=K(()=>[o()&&"rounded-xl",y()&&"rounded-full",f()&&"shadow-lg",(y()||!i())&&"aspect-square",x()&&"border-3 border-immich-dark-primary/80 hover:border-immich-primary",k()].filter(Boolean).join(" "));var O=_e(),q=$(O);{var R=r=>{fe(r,{get class(){return u(U)},get width(){return e.widthStyle},get height(){return i()}})},X=r=>{var a=ve();let b;ae(a,S=>Q?.(S)),W(()=>{w(a,"src",e.url),w(a,"alt",u(d)||u(c)?e.altText:""),w(a,"title",s()),H(a,1,ie(["object-cover",u(U),_()])),w(a,"loading",C()?"eager":"lazy"),b=J(a,"",b,{width:e.widthStyle,height:i(),filter:h()?"grayscale(50%)":"none",opacity:h()?"0.5":"1"})}),T("load",a,I),T("error",a,M),te(a),g(r,a)};P(q,r=>{u(c)?r(R):r(X,!1)})}var Y=D(q,2);{var Z=r=>{var a=ye(),b=B(a);{let S=K(()=>s()??void 0);G(b,{get title(){return u(S)},get icon(){return se},size:"2em",get class(){return n()}})}A(a),g(r,a)};P(Y,r=>{h()&&r(Z)})}g(l,O),F()}export{fe as B,We as I,ge as i};

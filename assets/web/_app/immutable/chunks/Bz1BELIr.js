import"./DsnmJJEf.js";import{p as jt,i as Gt,j as r,f as vt,t as G,g as e,u as C,s as A,a as Nt,h as P,a7 as Qt,c as w,n as Ut,r as x,W as Wt,d as qt}from"./BOqQhZBJ.js";import{d as Jt,a as Kt,e as ht,s as J}from"./BufZg4h2.js";import{i as N}from"./QS5y7wlf.js";import{e as Xt}from"./D4fmOnVC.js";import{f as T,t as Yt,a as E}from"./CnteGC4G.js";import{G as Zt,a as gt,v as te,r as ee,I as oe,x as re,b1 as se,s as u,u as K,f as ae,aa as ie,H as ne}from"./LrV5ZTyj.js";import{a as Q}from"./4T_x9N89.js";import{p as m,c as mt,s as le,a as ce}from"./B227BkWK.js";import{$ as wt}from"./DdY9CyNE.js";import{L as de}from"./eLOR7anR.js";import{s as bt}from"./_U16pX41.js";function ue(f,s={}){const{onFocusOut:S}=s,z=k=>{S&&(!k.relatedTarget||k.relatedTarget instanceof Node&&!f.contains(k.relatedTarget))&&S(k)};return f.addEventListener("focusout",z),{destroy(){f.removeEventListener("focusout",z)}}}let fe=0;const pe=()=>`id-${fe++}`,ve=f=>f.map(s=>s===""?{label:qt(wt)("unknown"),value:""}:{label:s,value:s}),Ve=f=>f===void 0?void 0:ve([f])[0];var he=T('<div class="absolute inset-y-0 start-0 flex items-center ps-3"><div class="dark:text-immich-dark-fg/75"><!></div></div>'),ge=T('<li role="option" class="text-start w-full px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 cursor-default aria-selected:bg-gray-200 aria-selected:dark:bg-gray-700"> </li>'),me=T('<li class="text-start w-full px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all cursor-pointer aria-selected:bg-gray-200 aria-selected:dark:bg-gray-700 wrap-break-words" role="option"> </li>'),be=T("<!> <!>",1),we=T('<!> <div class="relative w-full dark:text-gray-300 text-gray-700 text-base"><div><!> <input aria-autocomplete="list" autocomplete="off" role="combobox" type="text"/> <div><!></div></div> <ul role="listbox" tabindex="-1"><!></ul></div>',1);function Fe(f,s){jt(s,!0);const S=()=>ce(wt,"$t",z),[z,k]=le();let xt=m(s,"hideLabel",3,!1),_t=m(s,"disabled",3,!1),yt=m(s,"options",19,()=>[]),h=m(s,"selectedOption",15),kt=m(s,"placeholder",3,""),X=m(s,"allowCreate",3,!1),Lt=m(s,"defaultFirstOption",3,!1),Y=m(s,"onSelect",3,()=>{}),It=m(s,"forceFocus",3,!1),Z=pe(),p=P(!1),$=P(!1),l=C(()=>h()?.label||""),a=P(void 0),B=Gt([]),_=P(void 0),M=P(void 0);const tt=`combobox-${Z}`,H=`listbox-${Z}`,et=15,Ot=225,ot=new IntersectionObserver(t=>{t[0].intersectionRatio<1&&r(p,!1)},{threshold:.5});Kt(()=>{if(!e(_))return;ot.observe(e(_));const t=e(_)?.closest(".overflow-y-auto, .overflow-y-scroll");return t?.addEventListener("scroll",y,{passive:!0}),window.visualViewport?.addEventListener("resize",y,{passive:!0}),window.visualViewport?.addEventListener("scroll",y,{passive:!0}),()=>{ot.disconnect(),t?.removeEventListener("scroll",y),window.visualViewport?.removeEventListener("resize",y),window.visualViewport?.removeEventListener("scroll",y)}});const Ct=t=>{It()&&t.focus()},Et=()=>{r($,!0),r(l,""),V()},St=()=>{r(l,h()?h().label:""),r($,!1),L()},V=()=>{r(p,!0),r(M,it(),!0)},L=()=>{r(p,!1),r(a,void 0)},rt=async t=>{e(b).length===0?r(a,0):e(a)===void 0?r(a,t===1?0:e(b).length-1,!0):r(a,(e(a)+t+e(b).length)%e(b).length),await Wt(),B[e(a)]?.scrollIntoView({block:"nearest"})},$t=t=>{V(),r(l,t.currentTarget.value),r(a,Lt()?0:void 0,!0),B[0]?.scrollIntoView({block:"nearest"})};let st=t=>{h(t),r(l,t.label),Y()(t),L()};const Ht=()=>{e(_)?.focus(),r(a,void 0),h(void 0),r(l,""),Y()(h())},Vt=t=>{const o=window.visualViewport;if(!t)return;const n=t.left+(o?.offsetLeft||0),c=o?.offsetTop||0;if(e(I)==="top")return{bottom:`${window.innerHeight-t.top-c}px`,left:`${n}px`,width:`${t.width}px`,maxHeight:at(t.top-et)};const d=(o?.height||0)-t.bottom;return{top:`${t.bottom+c}px`,left:`${n}px`,width:`${t.width}px`,maxHeight:at(d-et)}},at=t=>`min(${t}px,18rem)`,y=()=>{e(p)&&r(M,it(),!0)},Ft=(t,o)=>{if(!t)return"bottom";const n=o?.height||0,c=n-t.bottom,j=t.top,d=n&&Math.floor(n)!==Math.floor(window.innerHeight);return c<=Ot&&j>c&&!d?"top":"bottom"},it=()=>e(_)?.getBoundingClientRect();let b=C(()=>{const t=yt().filter(o=>o.label.toLowerCase().includes(e(l).toLowerCase()));return X()&&e(l)!==""&&t.filter(o=>o.label===e(l)).length===0&&t.unshift({label:e(l),value:e(l)}),t}),F=C(()=>Vt(e(M))),I=C(()=>Ft(e(M),visualViewport));var nt=we();ht("resize",Qt,y);var lt=vt(nt);{let t=C(()=>xt()?"sr-only":"");de(lt,{get class(){return`block mb-1 ${e(t)??""} text-xs text-neutral-500 font-light`},get for(){return tt},children:(o,n)=>{Ut();var c=Yt();G(()=>J(c,s.label)),E(o,c)},$$slots:{default:!0}})}var R=A(lt,2),U=w(R),ct=w(U);{var Dt=t=>{var o=he(),n=w(o),c=w(n);gt(c,{get icon(){return te},"aria-hidden":!0}),x(n),x(o),E(t,o)};N(ct,t=>{e($)&&t(Dt)})}var i=A(ct,2);ee(i);let dt;i.__input=$t,mt(i,t=>r(_,t),()=>e(_)),Q(i,t=>Ct?.(t)),Q(i,(t,o)=>bt?.(t,o),()=>[{shortcut:{key:"ArrowUp"},onShortcut:()=>{V(),rt(-1)}},{shortcut:{key:"ArrowDown"},onShortcut:()=>{V(),rt(1)}},{shortcut:{key:"ArrowDown",alt:!0},onShortcut:()=>{V()}},{shortcut:{key:"Enter"},onShortcut:()=>{e(a)!==void 0&&e(b).length>0&&st(e(b)[e(a)]),L()}},{shortcut:{key:"Escape"},onShortcut:t=>{t.stopPropagation(),L()}}]);var W=A(i,2);let ut;var At=w(W);{var Pt=t=>{{let o=C(()=>S()("clear_value"));oe(t,{shape:"round",color:"secondary",variant:"ghost",onclick:Ht,get"aria-label"(){return e(o)},get icon(){return re},size:"small"})}},Tt=t=>{gt(t,{get icon(){return se},"aria-hidden":!0})};N(At,t=>{h()?t(Pt):e(p)||t(Tt,1)})}x(W),x(U);var O=A(U,2);let ft,pt;var zt=w(O);{var Bt=t=>{var o=be(),n=vt(o);{var c=d=>{var v=ge();u(v,"aria-disabled",!0),v.__click=L;var D=w(v,!0);x(v),G(g=>{u(v,"aria-selected",e(a)===0),u(v,"id",`${H}-0`),J(D,g)},[()=>X()?e(l):S()("no_results")]),E(d,v)};N(n,d=>{e(b).length===0&&d(c)})}var j=A(n,2);Xt(j,19,()=>e(b),d=>d.id||d.label,(d,v,D)=>{var g=me();g.__click=()=>st(e(v));var Mt=w(g,!0);x(g),mt(g,(q,Rt)=>B[Rt]=q,q=>B?.[q],()=>[e(D)]),G(()=>{u(g,"aria-selected",e(D)===e(a)),u(g,"id",`${H}-${e(D)}`),J(Mt,e(v).label)}),E(d,g)}),E(t,o)};N(zt,t=>{e(p)&&t(Bt)})}x(O),x(R),Q(R,(t,o)=>ue?.(t,o),()=>({onFocusOut:St})),Q(R,(t,o)=>bt?.(t,o),()=>[{shortcut:{key:"Escape"},onShortcut:t=>{t.stopPropagation(),L()}}]),G(()=>{u(i,"placeholder",kt()),i.disabled=_t(),u(i,"aria-activedescendant",e(a)||e(a)===0?`${H}-${e(a)}`:""),u(i,"aria-controls",H),u(i,"aria-expanded",e(p)),dt=K(i,1,"immich-form-input text-sm w-full pe-12! transition-all",null,dt,{"!ps-8":e($),"!rounded-b-none":e(p)&&e(I)==="bottom","!rounded-t-none":e(p)&&e(I)==="top","cursor-pointer":!e($)}),u(i,"id",tt),ae(i,e(l)),ut=K(W,1,"absolute end-0 top-0 h-full flex px-4 justify-center items-center content-between",null,ut,{"pe-2":h(),"pointer-events-none":!h()}),u(O,"id",H),ft=K(O,1,"fixed z-1 text-start text-sm w-full overflow-y-auto bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-900",null,ft,{"rounded-b-xl":e(I)==="bottom","rounded-t-xl":e(I)==="top",shadow:e(I)==="bottom",border:e(p)}),pt=ie(O,"",pt,{top:e(F)?.top,bottom:e(F)?.bottom,left:e(F)?.left,width:e(F)?.width,"max-height":e(F)?.maxHeight})}),ht("focus",i,Et),Zt(1,O,()=>ne,()=>({duration:250})),E(f,nt),Nt(),k()}Jt(["input","click"]);export{Fe as C,ve as a,Ve as b,ue as f,pe as g};

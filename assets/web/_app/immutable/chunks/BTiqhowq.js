import{g as Fe}from"./C4XZXykC.js";import{l as Ge,d as Je,W as Ke}from"./Jagi0WJL.js";import{e as Be}from"./BNLYq5HQ.js";import{e as Y}from"./ytu5q_IM.js";import"./DsnmJJEf.js";import{a as Ee,s as k}from"./BufZg4h2.js";import{p as Ue,h as $e,i as Re,j as ve,f as T,g as a,u as c,c as _,r as f,n as x,t as P,s as u,a as ke,d as Xe}from"./BOqQhZBJ.js";import{i as We}from"./QS5y7wlf.js";import{e as ge,t as xe,h as q}from"./D4fmOnVC.js";import{c as Ae,a as d,f as O,t as S}from"./CnteGC4G.js";import{a as _e,s as Pe,p as Ze}from"./B227BkWK.js";import{U as we,A as he}from"./Bp2HQ4kn.js";import{b as et}from"./CaDSsDA9.js";import{D as tt,u as rt}from"./Cx5lmlld.js";import{$ as Se,g as G}from"./DdY9CyNE.js";import{bz as at,w as st,T as C,ah as ot,Y as lt,ae as nt,as as it,bA as dt,aN as je}from"./LrV5ZTyj.js";import{H as Ie}from"./Bj7pQby1.js";import{O as ct}from"./Di6OVBka.js";import{au as ut,a0 as mt,g as vt,av as ze,aw as Me,ax as _t,ay as ft,az as pt,aA as ht,aB as bt,aC as $t}from"./DeYUhNiz.js";import{M as gt,a as At,H as Te,m as ne}from"./C20f7eOz.js";import{S as ye}from"./Ze2c3aZz.js";import{F as me}from"./DzmAA-7p.js";import{S as wt}from"./rybNiN9i.js";import{S as be}from"./DU0cVi4D.js";import{S as yt}from"./LRhZRw-S.js";import{R as Ne}from"./BeWG-__C.js";import{c as Ut}from"./DsCc9Mx1.js";import{o as kt}from"./BjCgVxgW.js";import{F as xt}from"./C0Ca_l_S.js";import{L as Pt}from"./BH4ptThH.js";var St=O('<div class="w-full flex place-items-center place-content-center"><!></div>'),Ct=O('<!> <div class="text-start grow"><!> <!></div>',1);function Lt(r,t){Ue(t,!0);const e=()=>_e(Se,"$t",o),[o,n]=Pe();let s=$e(Re([]));const g=c(()=>[t.album.ownerId,...t.album.albumUsers.map(({user:{id:m}})=>m)]),A=c(()=>a(s).filter(({id:m})=>!a(g).includes(m))),y=new at;let j=$e(!0);const J=m=>{y.has(m.id)?y.delete(m.id):y.set(m.id,m)},z=async()=>{await jt(t.album,[...y.values()])&&t.onClose()};Ee(async()=>{ve(s,await ut(),!0),ve(j,!1)});{let m=c(()=>e()("users")),N=c(()=>e()("add")),L=c(()=>e()("back")),F=c(()=>y.size===0);xt(r,{get title(){return a(m)},get submitText(){return a(N)},get cancelText(){return a(L)},onSubmit:z,get disabled(){return a(F)},get onClose(){return t.onClose},children:(B,K)=>{var v=Ae(),h=T(v);{var ie=I=>{var E=St(),fe=_(E);st(fe,{}),f(E),d(I,E)},D=I=>{ye(I,{children:(E,fe)=>{var X=Ae(),Z=T(X);ge(Z,17,()=>a(A),M=>M.id,(M,U)=>{{let ee=c(()=>y.has(a(U).id));Pt(M,{get selected(){return a(ee)},onclick:()=>J(a(U)),children:(V,de)=>{var H=Ct(),te=T(H);we(te,{get user(){return a(U)},size:"md"});var re=u(te,2),Q=_(re);C(Q,{fontWeight:"medium",children:(se,ce)=>{x();var R=S();P(()=>k(R,a(U).name)),d(se,R)},$$slots:{default:!0}});var ae=u(Q,2);C(ae,{size:"tiny",color:"muted",children:(se,ce)=>{x();var R=S();P(()=>k(R,a(U).email)),d(se,R)},$$slots:{default:!0}}),f(re),d(V,H)},$$slots:{default:!0}})}},M=>{C(M,{class:"py-6",children:(U,ee)=>{x();var V=S();P(de=>k(V,de),[()=>e()("album_share_no_users")]),d(U,V)},$$slots:{default:!0}})}),d(E,X)},$$slots:{default:!0}})};We(h,I=>{a(j)?I(ie):I(D,!1)})}d(B,v)},$$slots:{default:!0}})}ke(),n()}var Dt=O('<div class="flex justify-between items-center"><div class="flex flex-col gap-1"><!> <!></div> <div class="flex"><!> <!> <!></div></div>');function It(r,t){Ue(t,!0);const e=()=>_e(Ge,"$locale",n),o=()=>_e(Se,"$t",n),[n,s]=Pe(),g=()=>[tt.fromISO(t.sharedLink.createdAt).toLocaleString({month:"long",day:"numeric",year:"numeric"},{locale:e()}),t.sharedLink.allowUpload&&o()("upload"),t.sharedLink.allowDownload&&o()("download"),t.sharedLink.showMetadata&&o()("exif").toUpperCase(),t.sharedLink.password&&o()("password")].filter(Boolean).join(" â€¢ "),A=c(()=>et(o(),t.sharedLink)),y=c(()=>a(A).ViewQrCode),j=c(()=>a(A).Copy),J=c(()=>a(A).Delete);var z=Dt(),m=_(z),N=_(m);C(N,{size:"small",children:(h,ie)=>{x();var D=S();P(()=>k(D,t.sharedLink.description||t.album.albumName)),d(h,D)},$$slots:{default:!0}});var L=u(N,2);C(L,{size:"tiny",color:"muted",children:(h,ie)=>{x();var D=S();P(I=>k(D,I),[g]),d(h,D)},$$slots:{default:!0}}),f(m);var F=u(m,2),B=_(F);he(B,{get action(){return a(y)}});var K=u(B,2);he(K,{get action(){return a(j)}});var v=u(K,2);he(v,{get action(){return a(J)}}),f(F),f(z),d(r,z),ke(),s()}var zt=O("<!> <!>",1),Mt=O('<div class="flex items-center justify-between gap-4 py-2"><div class="flex flex-row items-center gap-2"><div><!></div> <!></div> <!></div>'),Tt=O("<!> <!>",1),Ot=O('<div><!> <div class="grid gap-y-3 ps-2 mt-2"><!> <!></div></div> <div><!> <div class="ps-2"><div class="flex items-center gap-2 mb-2"><div><!></div> <!> <!></div> <!></div></div> <div class="mb-4"><!> <div class="ps-2"><!></div></div>',1),Ft=O("<!> <!>",1);function Bt(r,t){Ue(t,!0);const e=()=>_e(Se,"$t",o),[o,n]=Pe();let s=Ze(t,"album",7);const g=async(v,h)=>{if(h==="none"){await Nt(s(),v);return}await Wt({albumId:s().id,userId:v.id,role:h})},A=async()=>{s(await mt({id:s().id,withoutAssets:!0}))},y=async({userId:v})=>{s().albumUsers=s().albumUsers.filter(({user:{id:h}})=>h!==v),await A()},j=v=>{a(L).push(v)},J=v=>{ve(L,a(L).filter(({id:h})=>v.id!==h),!0)},z=c(()=>Et(e(),s(),Be.OPTIONS)),m=c(()=>a(z).AddUsers),N=c(()=>a(z).CreateSharedLink);let L=$e(Re([]));Ee(async()=>{ve(L,await vt({albumId:s().id}),!0)});var F=Ft(),B=T(F);ct(B,{onAlbumUserDelete:y,onAlbumShare:A,onSharedLinkCreate:j,onSharedLinkDelete:J,onAlbumUpdate:v=>s(v)});var K=u(B,2);{let v=c(()=>e()("options"));gt(K,{get title(){return a(v)},get onClose(){return t.onClose},size:"small",children:(h,ie)=>{At(h,{children:(D,I)=>{ye(D,{gap:6,children:(E,fe)=>{var X=Ot(),Z=T(X),M=_(Z);C(M,{size:"medium",fontWeight:"semi-bold",children:(i,b)=>{x();var l=S();P($=>k(l,$),[()=>e()("settings")]),d(i,l)},$$slots:{default:!0}});var U=u(M,2),ee=_(U);{var V=i=>{{let b=c(()=>e()("display_order"));me(i,{get label(){return a(b)},children:(l,$)=>{{let p=c(()=>[{label:e()("newest_first"),value:ze.Desc},{label:e()("oldest_first"),value:ze.Asc}]);be(l,{get value(){return s().order},get options(){return a(p)},onChange:w=>Oe(s(),{order:w})})}},$$slots:{default:!0}})}};We(ee,i=>{s().order&&i(V)})}var de=u(ee,2);{let i=c(()=>e()("comments_and_likes")),b=c(()=>e()("let_others_respond"));me(de,{get label(){return a(i)},get description(){return a(b)},children:(l,$)=>{wt(l,{get checked(){return s().isActivityEnabled},onCheckedChange:p=>Oe(s(),{isActivityEnabled:p})})},$$slots:{default:!0}})}f(U),f(Z);var H=u(Z,2),te=_(H);Te(te,{fullWidth:!0,class:"justify-between mb-2",children:(i,b)=>{var l=zt(),$=T(l);C($,{size:"medium",fontWeight:"semi-bold",children:(w,oe)=>{x();var W=S();P(le=>k(W,le),[()=>e()("people")]),d(w,W)},$$slots:{default:!0}});var p=u($,2);Ie(p,{get action(){return a(m)}}),d(i,l)},$$slots:{default:!0}});var re=u(te,2),Q=_(re),ae=_(Q),se=_(ae);we(se,{get user(){return s().owner},size:"md"}),f(ae);var ce=u(ae,2);C(ce,{class:"w-full",size:"small",children:(i,b)=>{x();var l=S();P(()=>k(l,s().owner.name)),d(i,l)},$$slots:{default:!0}});var R=u(ce,2);me(R,{disabled:!0,class:"w-32 shrink-0",children:(i,b)=>{{let l=c(()=>[{label:e()("owner"),value:"owner"}]);be(i,{get options(){return a(l)},value:"owner"})}},$$slots:{default:!0}}),f(Q);var Ve=u(Q,2);ge(Ve,17,()=>s().albumUsers,({user:i,role:b})=>i.id,(i,b)=>{let l=()=>a(b).user,$=()=>a(b).role;var p=Mt(),w=_(p),oe=_(w),W=_(oe);we(W,{get user(){return l()},size:"md"}),f(oe);var le=u(oe,2);C(le,{size:"small",children:(pe,Ye)=>{x();var ue=S();P(()=>k(ue,l().name)),d(pe,ue)},$$slots:{default:!0}}),f(w);var Qe=u(w,2);me(Qe,{class:"w-32",children:(pe,Ye)=>{{let ue=c(()=>[{label:e()("role_editor"),value:Me.Editor},{label:e()("role_viewer"),value:Me.Viewer},{label:e()("remove_user"),value:"none"}]);be(pe,{get value(){return $()},get options(){return a(ue)},onChange:qe=>g(l(),qe)})}},$$slots:{default:!0}}),f(p),d(i,p)}),f(re),f(H);var Ce=u(H,2),Le=_(Ce);Te(Le,{class:"justify-between mb-2",children:(i,b)=>{var l=Tt(),$=T(l);C($,{size:"medium",fontWeight:"semi-bold",children:(w,oe)=>{x();var W=S();P(le=>k(W,le),[()=>e()("shared_links")]),d(w,W)},$$slots:{default:!0}});var p=u($,2);Ie(p,{get action(){return a(N)}}),d(i,l)},$$slots:{default:!0}});var De=u(Le,2),He=_(De);ye(He,{gap:4,children:(i,b)=>{var l=Ae(),$=T(l);ge($,17,()=>a(L),p=>p.id,(p,w)=>{It(p,{get album(){return s()},get sharedLink(){return a(w)}})}),d(i,l)},$$slots:{default:!0}}),f(De),f(Ce),d(E,X)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})}d(r,F),ke(),n()}const gr=r=>({Create:{title:r("create_album"),icon:je,onAction:()=>Ut()}}),Et=(r,t,e)=>{const o=Xe(rt).id===t.ownerId,n={title:r("share"),type:r("command"),icon:it,$if:()=>o,onAction:()=>ne.show(Bt,{album:t})},s={title:r("invite_people"),type:r("command"),icon:nt,color:"primary",onAction:()=>ne.show(Lt,{album:t})},g={title:r("create_link"),type:r("command"),icon:lt,color:"primary",onAction:()=>ne.show(yt,{albumId:t.id})},A={title:r("go_back"),type:r("command"),icon:ot,onAction:()=>Fe(Ne.albums()),$if:()=>e===Be.VIEW,shortcuts:{key:"Escape"}};return{Share:n,AddUsers:s,CreateSharedLink:g,Close:A}},Ar=(r,t,e)=>{const o={title:r("add_assets"),type:r("command"),color:"primary",icon:je,$if:()=>e.length>0,onAction:()=>Rt(t,e)},n={title:r("select_from_computer"),description:r("album_upload_assets"),type:r("command"),icon:dt,onAction:()=>{kt({albumId:t.id})}};return{AddAssets:o,Upload:n}},Rt=async(r,t)=>{const e=await G(),o=t.map(({id:n})=>n);try{const s=(await $t({id:r.id,bulkIdsDto:{ids:o}})).filter(({success:g})=>g).length;xe.success(e("assets_added_count",{values:{count:s}})),Y.emit("AlbumAddAssets")}catch(n){q(n,e("errors.error_adding_assets_to_album"))}},Wt=async({albumId:r,userId:t,role:e})=>{const o=await G();try{await ht({id:r,userId:t,updateAlbumUserDto:{role:e}}),Y.emit("AlbumUserUpdate",{albumId:r,userId:t,role:e})}catch(n){q(n,o("errors.unable_to_change_album_user_role"))}},jt=async(r,t)=>{const e=await G();try{return await bt({id:r.id,addUsersDto:{albumUsers:t.map(({id:o})=>({userId:o}))}}),Y.emit("AlbumShare"),!0}catch(o){q(o,e("errors.error_adding_users_to_album"))}},Nt=async(r,t)=>{const e=await G();if(await ne.showDialog({title:e("album_remove_user"),prompt:e("album_remove_user_confirmation",{values:{user:t.name}}),confirmText:e("remove_user")}))try{await pt({id:r.id,userId:t.id}),Y.emit("AlbumUserDelete",{albumId:r.id,userId:t.id})}catch(n){q(n,e("errors.unable_to_remove_album_users"))}},Oe=async({id:r},t)=>{const e=await G();try{const o=await ft({id:r,updateAlbumDto:t});return Y.emit("AlbumUpdate",o),xe.custom({component:Ke,props:{color:"primary",title:e("success"),description:e("album_info_updated"),button:{text:e("view_album"),color:"primary",onClick:()=>Fe(Ne.viewAlbum({id:r}))}}}),!0}catch(o){q(o,e("errors.unable_to_update_album_info"))}},wr=async(r,t)=>{const e=await G(),{prompt:o=!0,notify:n=!0}=t??{};if(o){const s=r.albumName.length>0?e("album_delete_confirmation",{values:{album:r.albumName}}):e("unnamed_album_delete_confirmation"),g=e("album_delete_confirmation_description");if(!await ne.showDialog({prompt:`${s} ${g}`}))return!1}try{return await _t({id:r.id}),Y.emit("AlbumDelete",r),n&&xe.success(),!0}catch(s){return q(s,e("errors.unable_to_delete_album")),!1}},yr=async r=>{await Je(`${r.albumName}.zip`,{albumId:r.id})};export{Bt as A,wr as a,Ar as b,Et as c,Oe as d,gr as g,yr as h};

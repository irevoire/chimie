import"./DsnmJJEf.js";import{s as H,a as tt,d as Ue,e as ze,b as It}from"./BufZg4h2.js";import{p as se,h as G,i as ge,P as he,g as e,u as n,c as d,n as ee,t as L,s as m,r as o,a as oe,j as O,b as Ct,f as be,$ as At,e as Pt,W as Qt}from"./BOqQhZBJ.js";import{i as le}from"./QS5y7wlf.js";import{h as qt,e as Je,i as Mt}from"./D4fmOnVC.js";import{f as W,t as te,a as b,s as Ot,c as Ee}from"./CnteGC4G.js";import{a as Ne}from"./4T_x9N89.js";import{T as de,r as vt,s as K,u as Te,q as Ft,w as Nt,B as He,x as Ke,cC as zt,a as ft,ba as mt,v as gt,I as Re,G as Et,H as Dt}from"./LrV5ZTyj.js";import{L as je,a as Bt,b as Lt}from"./eLOR7anR.js";import{p as Z,a as ne,s as ce,c as Ve}from"./B227BkWK.js";import{g as Wt}from"./C4XZXykC.js";import{C as pe,a as Ie,b as Ce,g as et,f as Ze}from"./Bz1BELIr.js";import{M as fe,j as Rt,v as jt}from"./BNLYq5HQ.js";import{h as xe,r as Gt}from"./Jagi0WJL.js";import{bo as Ae,bp as Pe,z as Ht,a1 as Vt,J as Be,A as st}from"./DeYUhNiz.js";import{$ as ue}from"./DdY9CyNE.js";import{D as ot,a as Ut}from"./9i_j0jQI.js";import{C as Ge}from"./BHgwLGQu.js";import{a as Jt}from"./yWuLE-qO.js";import{I as Kt}from"./izWpGtDw.js";import{S as Xt}from"./6ckOa7Ax.js";import{p as ht}from"./Cx5lmlld.js";import{S as we,p as it}from"./De1sTUmb.js";import{f as dt}from"./D5h9ps2j.js";import{F as Le}from"./DzmAA-7p.js";import{I as We}from"./BJT5MMCK.js";import{M as Yt,a as Zt,b as er,H as tr,m as rr}from"./C20f7eOz.js";import{R as ct}from"./BeWG-__C.js";import{s as Y}from"./Cv1syPnL.js";import{s as ut}from"./_U16pX41.js";var ar=W('<div id="camera-selection"><!> <div class="grid grid-auto-fit-40 gap-5 mt-1"><div class="w-full"><!></div> <div class="w-full"><!></div> <div class="w-full"><!></div></div></div>');function lr(D,r){se(r,!0);const a=()=>ne(ue,"$t",q),[q,Q]=ce();let t=Z(r,"filters",15),c=G(ge([])),y=G(ge([])),h=G(ge([]));async function _(){const f=await Ae({$type:Pe.CameraMake,includeNull:!0});O(c,f.map(s=>s??""),!0),t().make&&!e(c).includes(t().make)&&t(t().make=void 0,!0)}async function A(f){const s=await Ae({$type:Pe.CameraModel,make:f,includeNull:!0});O(y,s.map(v=>v??""),!0),t().model&&!e(y).includes(t().model)&&t(t().model=void 0,!0)}async function g(f,s){const v=await Ae({$type:Pe.CameraLensModel,make:f,model:s,includeNull:!0});O(h,v.map(S=>S??""),!0),t().lensModel&&!e(h).includes(t().lensModel)&&t(t().lensModel=void 0,!0)}const w=n(()=>t().make),l=n(()=>t().model),I=n(()=>t().lensModel);he(()=>{xe(_())}),he(()=>{xe(A(e(w)))}),he(()=>{xe(g(e(w),e(l)))});var u=ar(),T=d(u);de(T,{fontWeight:"medium",children:(f,s)=>{ee();var v=te();L(S=>H(v,S),[()=>a()("camera")]),b(f,v)},$$slots:{default:!0}});var C=m(T,2),p=d(C),x=d(p);{let f=n(()=>a()("make")),s=n(()=>Ie(e(c))),v=n(()=>a()("search_camera_make")),S=n(()=>Ce(e(w)));pe(x,{get label(){return e(f)},onSelect:R=>t(t().make=R?.value,!0),get options(){return e(s)},get placeholder(){return e(v)},get selectedOption(){return e(S)}})}o(p);var E=m(p,2),F=d(E);{let f=n(()=>a()("model")),s=n(()=>Ie(e(y))),v=n(()=>a()("search_camera_model")),S=n(()=>Ce(e(l)));pe(F,{get label(){return e(f)},onSelect:R=>t(t().model=R?.value,!0),get options(){return e(s)},get placeholder(){return e(v)},get selectedOption(){return e(S)}})}o(E);var $=m(E,2),k=d($);{let f=n(()=>a()("lens_model")),s=n(()=>Ie(e(h))),v=n(()=>a()("search_camera_lens_model")),S=n(()=>Ce(e(I)));pe(k,{get label(){return e(f)},onSelect:R=>t(t().lensModel=R?.value,!0),get options(){return e(s)},get placeholder(){return e(v)},get selectedOption(){return e(S)}})}o($),o(C),o(u),b(D,u),oe(),Q()}var nr=W('<div class="flex flex-col gap-1"><div id="date-range-selection" class="grid grid-auto-fit-40 gap-5"><div><!> <!></div> <div><!> <!></div></div> <!></div>');function sr(D,r){se(r,!0);const a=()=>ne(ue,"$t",q),[q,Q]=ce();let t=Z(r,"filters",15),c=n(()=>t().takenAfter&&t().takenBefore&&t().takenAfter>t().takenBefore);var y=nr(),h=d(y),_=d(h),A=d(_);de(A,{class:"mb-2",fontWeight:"medium",children:(C,p)=>{ee();var x=te();L(E=>H(x,E),[()=>a()("start_date")]),b(C,x)},$$slots:{default:!0}});var g=m(A,2);ot(g,{get value(){return t().takenAfter},set value(C){t(t().takenAfter=C,!0)}}),o(_);var w=m(_,2),l=d(w);de(l,{class:"mb-2",fontWeight:"medium",children:(C,p)=>{ee();var x=te();L(E=>H(x,E),[()=>a()("end_date")]),b(C,x)},$$slots:{default:!0}});var I=m(l,2);ot(I,{get value(){return t().takenBefore},set value(C){t(t().takenBefore=C,!0)}}),o(w),o(h);var u=m(h,2);{var T=C=>{de(C,{color:"danger",children:(p,x)=>{ee();var E=te();L(F=>H(E,F),[()=>a()("start_date_before_end_date")]),b(p,E)},$$slots:{default:!0}})};le(u,C=>{e(c)&&C(T)})}o(y),b(D,y),oe(),Q()}var or=W('<div id="display-options-selection"><fieldset><!> <div class="flex flex-wrap gap-x-5 gap-y-2 mt-1"><div class="flex items-center gap-2"><!> <!></div> <div class="flex items-center gap-2"><!> <!></div> <div class="flex items-center gap-2"><!> <!></div></div></fieldset></div>');function ir(D,r){se(r,!0);const a=()=>ne(ue,"$t",q),[q,Q]=ce();let t=Z(r,"filters",15);var c=or(),y=d(c),h=d(y);de(h,{class:"mb-2",fontWeight:"medium",children:(x,E)=>{ee();var F=te();L($=>H(F,$),[()=>a()("display_options")]),b(x,F)},$$slots:{default:!0}});var _=m(h,2),A=d(_),g=d(A);Ge(g,{id:"not-in-album-checkbox",size:"tiny",get checked(){return t().isNotInAlbum},set checked(x){t(t().isNotInAlbum=x,!0)}});var w=m(g,2);{let x=n(()=>a()("not_in_any_album"));je(w,{get label(){return e(x)},for:"not-in-album-checkbox",class:"text-sm font-normal"})}o(A);var l=m(A,2),I=d(l);Ge(I,{id:"archive-checkbox",size:"tiny",get checked(){return t().isArchive},set checked(x){t(t().isArchive=x,!0)}});var u=m(I,2);{let x=n(()=>a()("archive"));je(u,{get label(){return e(x)},for:"archive-checkbox",class:"text-sm font-normal"})}o(l);var T=m(l,2),C=d(T);Ge(C,{id:"favorites-checkbox",size:"tiny",get checked(){return t().isFavorite},set checked(x){t(t().isFavorite=x,!0)}});var p=m(C,2);{let x=n(()=>a()("favorites"));je(p,{get label(){return e(x)},for:"favorites-checkbox",class:"text-sm font-normal"})}o(T),o(_),o(y),o(c),b(D,c),oe(),Q()}var dr=W('<div id="location-selection"><!> <div class="grid grid-auto-fit-40 gap-5 mt-1"><div class="w-full"><!></div> <div class="w-full"><!></div> <div class="w-full"><!></div></div></div>');function cr(D,r){se(r,!0);const a=()=>ne(ue,"$t",q),[q,Q]=ce();let t=Z(r,"filters",15),c=G(ge([])),y=G(ge([])),h=G(ge([]));async function _(){const k=await Ae({$type:Pe.Country,includeNull:!0});O(c,k.map(f=>f??""),!0),t().country&&!e(c).includes(t().country)&&t(t().country=void 0,!0)}async function A(k){const f=await Ae({$type:Pe.State,country:k,includeNull:!0});O(y,f.map(s=>s??""),!0),t().state&&!e(y).includes(t().state)&&t(t().state=void 0,!0)}async function g(k,f){const s=await Ae({$type:Pe.City,country:k,state:f});O(h,s.map(v=>v??""),!0),t().city&&!e(h).includes(t().city)&&t(t().city=void 0,!0)}let w=n(()=>t().country),l=n(()=>t().state);he(()=>xe(A(e(w)))),he(()=>xe(g(e(w),e(l)))),tt(()=>_());var I=dr(),u=d(I);de(u,{fontWeight:"medium",children:(k,f)=>{ee();var s=te();L(v=>H(s,v),[()=>a()("place")]),b(k,s)},$$slots:{default:!0}});var T=m(u,2),C=d(T),p=d(C);{let k=n(()=>a()("country")),f=n(()=>Ie(e(c))),s=n(()=>a()("search_country")),v=n(()=>Ce(t().country));pe(p,{get label(){return e(k)},onSelect:S=>t(t().country=S?.value,!0),get options(){return e(f)},get placeholder(){return e(s)},get selectedOption(){return e(v)}})}o(C);var x=m(C,2),E=d(x);{let k=n(()=>a()("state")),f=n(()=>Ie(e(y))),s=n(()=>a()("search_state")),v=n(()=>Ce(t().state));pe(E,{get label(){return e(k)},onSelect:S=>t(t().state=S?.value,!0),get options(){return e(f)},get placeholder(){return e(s)},get selectedOption(){return e(v)}})}o(x);var F=m(x,2),$=d(F);{let k=n(()=>a()("city")),f=n(()=>Ie(e(h))),s=n(()=>a()("search_city")),v=n(()=>Ce(t().city));pe($,{get label(){return e(k)},onSelect:S=>t(t().city=S?.value,!0),get options(){return e(f)},get placeholder(){return e(s)},get selectedOption(){return e(v)}})}o(F),o(T),o(I),b(D,I),oe(),Q()}var ur=W('<div class="flex items-center gap-2"><input type="radio" class="focus-visible:ring"/> <label class="text-sm"> </label></div>');function _e(D,r){se(r,!0);const a=[];let q=Z(r,"group",15,void 0);var Q=ur(),t=d(Q);vt(t);var c,y=m(t,2),h=d(y,!0);o(y),o(Q),L(()=>{K(t,"name",r.name),K(t,"id",r.id),c!==(c=r.value)&&(t.value=(t.__value=r.value)??""),K(y,"for",r.id),H(h,r.label)}),Bt(a,[],t,()=>(r.value,q()),q),b(D,Q),oe()}var vr=W('<div id="media-type-selection"><fieldset><!> <div class="flex flex-wrap gap-x-5 gap-y-2 mt-1"><!> <!> <!></div></fieldset></div>');function fr(D,r){se(r,!0);const a=()=>ne(ue,"$t",q),[q,Q]=ce();let t=Z(r,"filteredMedia",15);var c=vr(),y=d(c),h=d(y);de(h,{class:"mb-2",fontWeight:"medium",children:(l,I)=>{ee();var u=te();L(T=>H(u,T),[()=>a()("media_type")]),b(l,u)},$$slots:{default:!0}});var _=m(h,2),A=d(_);{let l=n(()=>a()("all"));_e(A,{name:"media-type",id:"type-all",get label(){return e(l)},get value(){return fe.All},get group(){return t()},set group(I){t(I)}})}var g=m(A,2);{let l=n(()=>a()("image"));_e(g,{name:"media-type",id:"type-image",get label(){return e(l)},get value(){return fe.Image},get group(){return t()},set group(I){t(I)}})}var w=m(g,2);{let l=n(()=>a()("video"));_e(w,{name:"media-type",id:"type-video",get label(){return e(l)},get value(){return fe.Video},get group(){return t()},set group(I){t(I)}})}o(_),o(y),o(c),b(D,c),oe(),Q()}var mr=W("<div><!></div>");function gr(D,r){se(r,!0);let a=Z(r,"class",3,""),q=Z(r,"itemCount",15,1),Q=G(void 0),t=G(void 0);const c=g=>{const w=getComputedStyle(g);return{columnGap:y(w.columnGap)}},y=g=>Number.parseInt(g,10)||0,h=(g,w)=>{if(!g.firstElementChild)return 1;const l=g.firstElementChild.getBoundingClientRect(),I=Math.floor(l.width||1/0),{columnGap:u}=c(g);return Math.floor((w+u)/(I+u))||1};he(()=>{e(Q)&&e(t)&&q(h(e(Q),e(t).width))});var _=mr(),A=d(_);Ot(A,()=>r.children??Ct,()=>({itemCount:q()})),o(_),Ve(_,g=>O(Q,g),()=>e(Q)),L(()=>Te(_,1,Ft(a()))),Ut(_,"contentRect",g=>O(t,g)),b(D,_),oe()}var hr=W('<button type="button"><!> <p class="mt-2 line-clamp-2 text-sm font-medium dark:text-white"> </p></button>'),pr=W('<div class="flex justify-center mt-2"><!></div>'),yr=W('<div id="people-selection" class="max-h-60 -mb-4 overflow-y-auto immich-scrollbar"><div class="flex items-center w-full justify-between gap-6"><!> <!></div> <!> <!></div>'),_r=W('<div id="spinner" class="flex h-54 items-center justify-center -mb-4"><!></div>');function br(D,r){se(r,!0);const a=()=>ne(ue,"$t",q),[q,Q]=ce();let t=A(),c=G(!1),y=G(""),h=G(1);function _(u){return[...u.filter(T=>r.selectedPeople.has(T.id)),...u.filter(T=>!r.selectedPeople.has(T.id))]}async function A(){try{const u=await Ht({withHidden:!1});return _(u.people)}catch(u){qt(u,a()("errors.failed_to_get_people"))}}function g(u){r.selectedPeople.has(u)?r.selectedPeople.delete(u):r.selectedPeople.add(u)}const w=(u,T)=>{const C=T.toLowerCase();return T?u.filter(p=>p.name.toLowerCase().includes(C)):u};var l=Ee(),I=be(l);Jt(I,()=>t,u=>{var T=_r(),C=d(T);Nt(C,{size:"large"}),o(T),b(u,T)},(u,T)=>{var C=Ee(),p=be(C);{var x=E=>{const F=n(()=>e(c)?w(e(T),e(y)):w(e(T),e(y)).slice(0,e(h)));var $=yr(),k=d($),f=d(k);de(f,{class:"py-3",fontWeight:"medium",children:(N,X)=>{ee();var V=te();L(j=>H(V,j),[()=>a()("people")]),b(N,V)},$$slots:{default:!0}});var s=m(f,2);{let N=n(()=>a()("filter_people"));Xt(s,{get placeholder(){return e(N)},showLoadingSpinner:!1,get name(){return e(y)},set name(X){O(y,X,!0)}})}o(k);var v=m(k,2);gr(v,{class:"grid grid-auto-fill-20 gap-1 mt-2 overflow-y-auto immich-scrollbar space-between",get itemCount(){return e(h)},set itemCount(N){O(h,N,!0)},children:(N,X)=>{var V=Ee(),j=be(V);Je(j,17,()=>e(F),P=>P.id,(P,z)=>{var U=hr();U.__click=()=>g(e(z).id);var J=d(U);{let M=n(()=>Gt(e(z)));Kt(J,{circle:!0,shadow:!0,get url(){return e(M)},get altText(){return e(z).name},widthStyle:"100%"})}var ae=m(J,2),re=d(ae,!0);o(ae),o(U),L(M=>{Te(U,1,`flex flex-col items-center rounded-3xl border-2 hover:bg-subtle dark:hover:bg-immich-dark-primary/20 p-2 transition-all ${M??""}`),H(re,e(z).name)},[()=>r.selectedPeople.has(e(z).id)?"dark:border-slate-500 border-slate-400 bg-slate-200 dark:bg-slate-800 dark:text-white":"border-transparent"]),b(P,U)}),b(N,V)},$$slots:{default:!0}});var S=m(v,2);{var R=N=>{var X=pr(),V=d(X);{let j=n(()=>e(c)?Ke:zt);He(V,{color:"primary",variant:"ghost",shape:"round",get leadingIcon(){return e(j)},class:"flex gap-2 place-items-center",onclick:()=>O(c,!e(c)),children:(P,z)=>{ee();var U=te();L(J=>H(U,J),[()=>e(c)?a()("collapse"):a()("see_all_people")]),b(P,U)},$$slots:{default:!0}})}o(X),b(N,X)};le(S,N=>{(e(c)||e(T).length>e(F).length)&&N(R)})}o($),b(E,$)};le(p,E=>{e(T)&&e(T).length>0&&E(x)})}b(u,C)}),b(D,l),oe(),Q()}Ue(["click"]);var xr=W('<div class="flex flex-col"><!> <!></div>');function $r(D,r){se(r,!0);const a=()=>ne(ue,"$t",q),[q,Q]=ce();let t=Z(r,"rating",15);const c=[{value:"0",label:a()("rating_count",{values:{count:0}})},{value:"1",label:a()("rating_count",{values:{count:1}})},{value:"2",label:a()("rating_count",{values:{count:2}})},{value:"3",label:a()("rating_count",{values:{count:3}})},{value:"4",label:a()("rating_count",{values:{count:4}})},{value:"5",label:a()("rating_count",{values:{count:5}})}];var y=xr(),h=d(y);de(h,{class:"mb-2",fontWeight:"medium",children:(A,g)=>{ee();var w=te();L(l=>H(w,l),[()=>a()("rating")]),b(A,w)},$$slots:{default:!0}});var _=m(h,2);{let A=n(()=>a()("rating")),g=n(()=>a()("search_rating")),w=n(()=>t()===void 0?void 0:c[t()]);pe(_,{get label(){return e(A)},get placeholder(){return e(g)},hideLabel:!0,get options(){return c},get selectedOption(){return e(w)},onSelect:l=>t(l===void 0?void 0:Number.parseInt(l.value))})}o(y),b(D,y),oe(),Q()}var kr=W('<div class="flex group transition-all"><span class="inline-block h-min whitespace-nowrap ps-3 pe-1 group-hover:ps-3 py-1 text-center align-baseline leading-none text-gray-100 dark:text-immich-dark-gray bg-primary roudned-s-full hover:bg-immich-primary/80 dark:hover:bg-immich-dark-primary/80 transition-all"><p class="text-sm"> </p></span> <button type="button" class="text-gray-100 dark:text-immich-dark-gray bg-immich-primary/95 dark:bg-immich-dark-primary/95 rounded-e-full place-items-center place-content-center pe-2 ps-1 py-1 hover:bg-immich-primary/80 dark:hover:bg-immich-dark-primary/80 transition-all"><!></button></div>'),Sr=W('<div id="location-selection"><form autocomplete="off" id="create-tag-form"><div class="mb-4 flex flex-col"><!> <!></div> <div class="flex items-center gap-2"><!> <!></div></form> <section class="flex flex-wrap pt-2 gap-1"></section></div>');function wr(D,r){se(r,!0);const a=()=>ne(ht,"$preferences",Q),q=()=>ne(ue,"$t",Q),[Q,t]=ce();let c=Z(r,"selectedTags",15),y=G(ge([])),h=n(()=>Object.fromEntries(e(y).map(u=>[u.id,u]))),_=G(void 0);tt(async()=>{O(y,await Vt(),!0)});const A=u=>{!u||!u.id||c()===null||(c().add(u.value),O(_,void 0))},g=u=>{c()!==null&&c().delete(u)};var w=Ee(),l=be(w);{var I=u=>{var T=Sr(),C=d(T),p=d(C),x=d(p);de(x,{class:"py-3",fontWeight:"medium",children:(s,v)=>{ee();var S=te();L(R=>H(S,R),[()=>q()("tags")]),b(s,S)},$$slots:{default:!0}});var E=m(x,2);{let s=n(()=>c()===null),v=n(()=>q()("tags")),S=n(()=>e(y).map(N=>({id:N.id,label:N.value,value:N.id}))),R=n(()=>q()("search_tags"));pe(E,{get disabled(){return e(s)},hideLabel:!0,onSelect:A,get label(){return e(v)},defaultFirstOption:!0,get options(){return e(S)},get placeholder(){return e(R)},get selectedOption(){return e(_)},set selectedOption(N){O(_,N,!0)}})}o(p);var F=m(p,2),$=d(F);{let s=n(()=>c()===null);Ge($,{id:"untagged-checkbox",size:"tiny",get checked(){return e(s)},onCheckedChange:v=>{c(v?null:new we)}})}var k=m($,2);{let s=n(()=>q()("untagged"));je(k,{get label(){return e(s)},for:"untagged-checkbox",class:"text-sm font-normal"})}o(F),o(C);var f=m(C,2);Je(f,20,()=>c()??[],s=>s,(s,v)=>{const S=n(()=>e(h)[v]);var R=Ee(),N=be(R);{var X=V=>{var j=kr(),P=d(j),z=d(P),U=d(z,!0);o(z),o(P);var J=m(P,2);J.__click=()=>g(v);var ae=d(J);ft(ae,{get icon(){return Ke}}),o(J),o(j),L(re=>{H(U,e(S).value),K(J,"title",re)},[()=>q()("remove_tag")]),b(V,j)};le(N,V=>{e(S)&&V(X)})}b(s,R)}),o(f),o(T),b(u,T)};le(l,u=>{a()?.tags?.enabled&&u(I)})}b(D,w),oe(),t()}Ue(["click"]);var Tr=W('<section><fieldset><!> <div class="flex flex-wrap gap-x-5 gap-y-2 my-2"><!> <!> <!> <!></div></fieldset> <!></section>');function Ir(D,r){se(r,!0);const a=()=>ne(ue,"$t",q),[q,Q]=ce();let t=Z(r,"query",15),c=Z(r,"queryType",15,"smart");var y=Tr(),h=d(y),_=d(h);de(_,{class:"mb-2",fontWeight:"medium",children:($,k)=>{ee();var f=te();L(s=>H(f,s),[()=>a()("search_type")]),b($,f)},$$slots:{default:!0}});var A=m(_,2),g=d(A);{var w=$=>{{let k=n(()=>a()("context"));_e($,{name:"query-type",id:"context-radio",get label(){return e(k)},value:"smart",get group(){return c()},set group(f){c(f)}})}};le(g,$=>{dt.value.smartSearch&&$(w)})}var l=m(g,2);{let $=n(()=>a()("file_name_or_extension"));_e(l,{name:"query-type",id:"file-name-radio",get label(){return e($)},value:"metadata",get group(){return c()},set group(k){c(k)}})}var I=m(l,2);{let $=n(()=>a()("description"));_e(I,{name:"query-type",id:"description-radio",get label(){return e($)},value:"description",get group(){return c()},set group(k){c(k)}})}var u=m(I,2);{var T=$=>{{let k=n(()=>a()("ocr"));_e($,{name:"query-type",id:"ocr-radio",get label(){return e(k)},value:"ocr",get group(){return c()},set group(f){c(f)}})}};le(u,$=>{dt.value.ocr&&$(T)})}o(A),o(h);var C=m(h,2);{var p=$=>{{let k=n(()=>a()("search_by_context"));Le($,{get label(){return e(k)},children:(f,s)=>{{let v=n(()=>a()("sunrise_on_the_beach"));We(f,{type:"text",get placeholder(){return e(v)},get value(){return t()},set value(S){t(S)}})}},$$slots:{default:!0}})}},x=$=>{{let k=n(()=>a()("search_by_filename"));Le($,{get label(){return e(k)},children:(f,s)=>{{let v=n(()=>a()("search_by_filename_example"));We(f,{type:"text",get placeholder(){return e(v)},get value(){return t()},set value(S){t(S)}})}},$$slots:{default:!0}})}},E=$=>{{let k=n(()=>a()("search_by_description"));Le($,{get label(){return e(k)},children:(f,s)=>{{let v=n(()=>a()("search_by_description_example"));We(f,{type:"text",get placeholder(){return e(v)},get value(){return t()},set value(S){t(S)}})}},$$slots:{default:!0}})}},F=$=>{{let k=n(()=>a()("search_by_ocr"));Le($,{get label(){return e(k)},children:(f,s)=>{{let v=n(()=>a()("search_by_ocr_example"));We(f,{type:"text",get placeholder(){return e(v)},get value(){return t()},set value(S){t(S)}})}},$$slots:{default:!0}})}};le(C,$=>{c()==="smart"?$(p):c()==="metadata"?$(x,1):c()==="description"?$(E,2):c()==="ocr"&&$(F,3)})}o(y),b(D,y),oe(),Q()}var Cr=W('<form autocomplete="off"><div class="flex flex-col gap-5 pb-10" tabindex="-1"><!> <!> <!> <!> <!> <!> <!> <div class="grid md:grid-cols-2 gap-x-5 gap-y-10"><!> <!></div></div></form>'),Ar=W("<!> <!>",1),Pr=W("<!> <!>",1);function Qr(D,r){se(r,!0);const a=()=>ne(ue,"$t",Q),q=()=>ne(ht,"$preferences",Q),[Q,t]=ce(),c=p=>p?it(p.toString()):void 0,y=p=>it(p)?.startOf("day")||void 0,h=et();function _(p){return p===null?void 0:p}function A(p){localStorage.setItem("searchQueryType",p)}function g(){const p=localStorage.getItem("searchQueryType");return jt.has(p)?p:Rt.SMART}let w="";"query"in r.searchQuery&&r.searchQuery.query&&(w=r.searchQuery.query),"originalFileName"in r.searchQuery&&r.searchQuery.originalFileName&&(w=r.searchQuery.originalFileName);let l=G(ge({query:w,ocr:r.searchQuery.ocr,queryType:g(),personIds:new we("personIds"in r.searchQuery?r.searchQuery.personIds:[]),tagIds:"tagIds"in r.searchQuery?r.searchQuery.tagIds===null?null:new we(r.searchQuery.tagIds):new we,location:{country:_(r.searchQuery.country),state:_(r.searchQuery.state),city:_(r.searchQuery.city)},camera:{make:_(r.searchQuery.make),model:_(r.searchQuery.model),lensModel:_(r.searchQuery.lensModel)},date:{takenAfter:r.searchQuery.takenAfter?y(r.searchQuery.takenAfter):void 0,takenBefore:r.searchQuery.takenBefore?y(r.searchQuery.takenBefore):void 0},display:{isArchive:r.searchQuery.visibility===st.Archive,isFavorite:r.searchQuery.isFavorite??!1,isNotInAlbum:"isNotInAlbum"in r.searchQuery?r.searchQuery.isNotInAlbum??!1:!1},mediaType:r.searchQuery.type===Be.Image?fe.Image:r.searchQuery.type===Be.Video?fe.Video:fe.All,rating:r.searchQuery.rating}));const I=()=>{O(l,{query:"",ocr:void 0,queryType:g(),personIds:new we,tagIds:new we,location:{},camera:{},date:{},display:{isArchive:!1,isFavorite:!1,isNotInAlbum:!1},mediaType:fe.All,rating:void 0},!0)},u=()=>{let p;e(l).mediaType===fe.Image?p=Be.Image:e(l).mediaType===fe.Video&&(p=Be.Video);const x=e(l).query||void 0;let E={query:e(l).queryType==="smart"?x:void 0,ocr:e(l).queryType==="ocr"?x:void 0,originalFileName:e(l).queryType==="metadata"?x:void 0,description:e(l).queryType==="description"?x:void 0,country:e(l).location.country,state:e(l).location.state,city:e(l).location.city,make:e(l).camera.make,model:e(l).camera.model,lensModel:e(l).camera.lensModel,takenAfter:c(e(l).date.takenAfter)?.startOf("day").toISO()||void 0,takenBefore:c(e(l).date.takenBefore)?.endOf("day").toISO()||void 0,visibility:e(l).display.isArchive?st.Archive:void 0,isFavorite:e(l).display.isFavorite||void 0,isNotInAlbum:e(l).display.isNotInAlbum||void 0,personIds:e(l).personIds.size>0?[...e(l).personIds]:void 0,tagIds:e(l).tagIds===null?null:e(l).tagIds.size>0?[...e(l).tagIds]:void 0,type:p,rating:e(l).rating};r.onClose(E)},T=p=>{p.preventDefault(),I()},C=p=>{p.preventDefault(),A(e(l).queryType),u()};he(()=>{A(e(l).queryType)});{let p=n(()=>a()("search_options"));Yt(D,{get icon(){return mt},size:"giant",get title(){return e(p)},get onClose(){return r.onClose},children:(x,E)=>{var F=Pr(),$=be(F);Zt($,{children:(f,s)=>{var v=Cr(),S=d(v),R=d(S);br(R,{get selectedPeople(){return e(l).personIds},set selectedPeople(M){e(l).personIds=M}});var N=m(R,2);Ir(N,{get query(){return e(l).query},set query(M){e(l).query=M},get queryType(){return e(l).queryType},set queryType(M){e(l).queryType=M}});var X=m(N,2);wr(X,{get selectedTags(){return e(l).tagIds},set selectedTags(M){e(l).tagIds=M}});var V=m(X,2);cr(V,{get filters(){return e(l).location},set filters(M){e(l).location=M}});var j=m(V,2);lr(j,{get filters(){return e(l).camera},set filters(M){e(l).camera=M}});var P=m(j,2);sr(P,{get filters(){return e(l).date},set filters(M){e(l).date=M}});var z=m(P,2);{var U=M=>{$r(M,{get rating(){return e(l).rating},set rating(Qe){e(l).rating=Qe}})};le(z,M=>{q()?.ratings.enabled&&M(U)})}var J=m(z,2),ae=d(J);fr(ae,{get filteredMedia(){return e(l).mediaType},set filteredMedia(M){e(l).mediaType=M}});var re=m(ae,2);ir(re,{get filters(){return e(l).display},set filters(M){e(l).display=M}}),o(J),o(S),o(v),L(()=>K(v,"id",h)),ze("submit",v,C),ze("reset",v,T),b(f,v)},$$slots:{default:!0}});var k=m($,2);er(k,{children:(f,s)=>{tr(f,{fullWidth:!0,children:(v,S)=>{var R=Ar(),N=be(R);He(N,{shape:"round",size:"large",type:"reset",color:"secondary",fullWidth:!0,get form(){return h},children:(V,j)=>{ee();var P=te();L(z=>H(P,z),[()=>a()("clear_all")]),b(V,P)},$$slots:{default:!0}});var X=m(N,2);He(X,{shape:"round",size:"large",type:"submit",fullWidth:!0,get form(){return h},children:(V,j)=>{ee();var P=te();L(z=>H(P,z),[()=>a()("search")]),b(V,P)},$$slots:{default:!0}}),b(v,R)},$$slots:{default:!0}})},$$slots:{default:!0}}),b(x,F)},$$slots:{default:!0}})}oe(),t()}var qr=W('<button type="button" class="rounded-lg p-2 font-semibold text-primary aria-selected:bg-immich-primary/25 hover:bg-immich-primary/25" role="option" tabindex="-1"> </button>'),Mr=W('<div class="flex w-full items-center justify-between text-sm text-black dark:text-gray-300"><div class="relative w-full items-center"><div class="relative flex w-full cursor-pointer gap-3 py-3 ps-5 hover:bg-gray-100 aria-selected:bg-gray-100 dark:aria-selected:bg-gray-500/30 dark:hover:bg-gray-500/30" role="option" tabindex="-1"><!> </div> <div class="absolute end-5 top-0 items-center justify-center py-3"><!></div></div></div>'),Or=W('<div class="absolute w-full rounded-b-3xl border-2 border-t-0 border-gray-200 bg-white pb-5 shadow-2xl transition-all dark:border-gray-700 dark:bg-immich-dark-gray dark:text-gray-300 z-1"><div class="flex items-center justify-between px-5 pt-5 text-xs"><!> <!></div> <!></div>'),Fr=W('<div role="listbox"><!></div>');function Nr(D,r){se(r,!0);const a=()=>ne(ue,"$t",q),[q,Q]=ce();let t=Z(r,"searchQuery",3,""),c=Z(r,"isSearchSuggestions",15,!1),y=Z(r,"isOpen",3,!1),h=n(()=>Y.savedSearchTerms.filter(s=>s.toLowerCase().includes(t().toLowerCase())));he(()=>{c(e(h).length>0)});let _=n(()=>t()===""),A=n(()=>e(_)?e(h).length+1:e(h).length),g=G(void 0),w=G(void 0);function l(s){if(c())e(g)===void 0?O(g,s===1?0:e(A)-1,!0):e(g)+s<0||e(g)+s>=e(A)?I():O(g,(e(g)+s+e(A))%e(A));else return;r.onActiveSelectionChange(x(e(g)))}function I(){O(g,void 0),r.onActiveSelectionChange(void 0)}function u(){if(e(g)===void 0)return;e(w)?.querySelector(`#${x(e(g))}`)?.click()}const T=()=>{I(),r.onClearAllSearchTerms()},C=s=>{I(),r.onClearSearchTerm(s)},p=s=>{I(),r.onSelectSearchTerm(s)},x=s=>{if(s!==void 0)return`${r.id}-${s}`};var E={moveSelection:l,clearSelection:I,selectActiveOption:u},F=Fr(),$=d(F);{var k=s=>{var v=Or(),S=d(v),R=d(S);de(R,{class:"py-2",color:"muted","aria-hidden":!0,children:(j,P)=>{ee();var z=te();L(U=>H(z,U),[()=>a()("recent_searches")]),b(j,z)},$$slots:{default:!0}});var N=m(R,2);{var X=j=>{var P=qr();P.__click=()=>T();var z=d(P,!0);o(P),L((U,J,ae)=>{K(P,"id",U),K(P,"aria-selected",e(g)===0),K(P,"aria-label",J),H(z,ae)},[()=>x(0),()=>a()("clear_all_recent_searches"),()=>a()("clear_all")]),b(j,P)};le(N,j=>{e(_)&&j(X)})}o(S);var V=m(S,2);Je(V,17,()=>e(h),Mt,(j,P,z)=>{const U=n(()=>e(_)?z+1:z);var J=Mr(),ae=d(J),re=d(ae);re.__click=()=>p(e(P));var M=d(re);ft(M,{get icon(){return gt},size:"1.5em","aria-hidden":!0});var Qe=m(M);o(re);var qe=m(re,2);K(qe,"aria-hidden",!0);var $e=d(qe);{let ve=n(()=>a()("remove"));Re($e,{shape:"round",color:"secondary",variant:"ghost",get icon(){return Ke},get"aria-label"(){return e(ve)},size:"medium",tabindex:-1,onclick:()=>C(e(P))})}o(qe),o(ae),o(J),L(ve=>{K(re,"id",ve),K(re,"aria-selected",e(g)===e(U)),K(re,"aria-label",e(P)),H(Qe,` ${e(P)??""}`)},[()=>x(e(U))]),b(j,J)}),o(v),Et(3,v,()=>Dt,()=>({y:25,duration:150})),b(s,v)};le($,s=>{y()&&c()&&s(k)})}o(F),Ve(F,s=>O(w,s),()=>e(w)),L(s=>{K(F,"id",r.id),K(F,"aria-label",s)},[()=>a()("recent_searches")]),b(D,F);var f=oe(E);return Q(),f}Ue(["click"]);var zr=W('<button type="button" tabindex="0"> </button>'),Er=W('<div class="absolute top-full right-0 mt-1 bg-white dark:bg-immich-dark-gray border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg py-1 min-w-32 z-9999"></div>'),Dr=W('<div><div class="relative"><!> <!></div></div>'),Br=W('<div class="absolute inset-y-0 end-0 flex items-center pe-2"><!></div>'),Lr=W('<div class="w-full relative z-auto" tabindex="-1"><form draggable="false" autocomplete="off" class="select-text text-sm" role="search"><div tabindex="-1"><label for="main-search-bar" class="sr-only"> </label> <input type="text" name="q" id="main-search-bar" required="" pattern="^(?!m:$).*$" role="combobox" aria-autocomplete="list"/> <!></div> <!> <!> <div class="absolute inset-y-0 start-0 flex items-center ps-2"><!></div></form> <div><!></div></div>');function ya(D,r){se(r,!0);const a=()=>ne(ue,"$t",q),[q,Q]=ce();let t=Z(r,"value",15,""),c=Z(r,"searchQuery",19,()=>({})),y=n(()=>t().length>0),h=G(void 0),_=G(void 0),A=G(!1),g=G(!1),w=G(void 0),l,I=G(!1),u=G("smart");const T=et(),C=et();It(()=>{Y.isSearchEnabled=!1});const p=async i=>{z(),Y.isSearchEnabled=!1,await Wt(ct.search(i))},x=i=>{e(h)?.focus(),Y.savedSearchTerms=Y.savedSearchTerms.filter(B=>B!==i)},E=i=>{const B=Y.savedSearchTerms.filter(me=>me.toLowerCase()!==i.toLowerCase());Y.savedSearchTerms=[i,...B],Y.savedSearchTerms.length>5&&(Y.savedSearchTerms=Y.savedSearchTerms.slice(0,5))},F=()=>{e(h)?.focus(),Y.savedSearchTerms=[]},$=()=>{Y.isSearchEnabled=!0,M()},k=()=>{Y.isSearchEnabled=!1},f=i=>{switch(M()){case"smart":return{query:i};case"metadata":return{originalFileName:i};case"description":return{description:i};case"ocr":return{ocr:i};default:return{query:i}}},s=async i=>{t(i),await p(f(i))},v=async()=>{if(t(""),l){await l(),l=void 0,Y.isSearchEnabled=!1;return}const i=rr.open(Qr,{searchQuery:c()});l=()=>i.close(),z();const B=await i.onClose;l=void 0,Y.isSearchEnabled=!1,M(),B&&await p(B)},S=()=>{xe(p(f(t()))),E(t())},R=()=>{t(""),e(h)?.focus()},N=()=>{z(),J()},X=async i=>{P(),await Qt(),e(_)?.moveSelection(i)},V=i=>{e(w)&&(i.preventDefault(),e(_)?.selectActiveOption())},j=()=>{P(),e(_)?.clearSelection()},P=()=>{O(A,!0)},z=()=>{O(A,!1),e(_)?.clearSelection()},U=()=>{O(I,!e(I))},J=()=>{O(I,!1)},ae=i=>{localStorage.setItem("searchQueryType",i),O(u,i,!0),O(I,!1)},re=i=>{i.preventDefault(),S()};function M(){const i=localStorage.getItem("searchQueryType");switch(i){case"smart":case"metadata":case"description":case"ocr":return O(u,i,!0),i;default:return O(u,"smart"),"smart"}}function Qe(){switch(e(u)){case"smart":return a()("context");case"metadata":return a()("filename");case"description":return a()("description");case"ocr":return a()("ocr");default:return a()("context")}}tt(()=>{M()});const qe=[{value:"smart",label:()=>a()("context")},{value:"metadata",label:()=>a()("filename")},{value:"description",label:()=>a()("description")},{value:"ocr",label:()=>a()("ocr")}];var $e=Lr();Ne(At,(i,B)=>ut?.(i,B),()=>[{shortcut:{ctrl:!0,key:"k"},onShortcut:()=>e(h)?.select()},{shortcut:{ctrl:!0,shift:!0,key:"k"},onShortcut:v}]);var ve=d($e);ve.__focusin=$;var De=d(ve),Xe=d(De),pt=d(Xe,!0);o(Xe);var ie=m(Xe,2);vt(ie),ie.__input=j,Pt(()=>Lt(ie,t)),Ve(ie,i=>O(h,i),()=>e(h)),Ne(ie,(i,B)=>ut?.(i,B),()=>[{shortcut:{key:"Escape"},onShortcut:N},{shortcut:{ctrl:!0,shift:!0,key:"k"},onShortcut:v},{shortcut:{key:"ArrowUp"},onShortcut:()=>X(-1)},{shortcut:{key:"ArrowDown"},onShortcut:()=>X(1)},{shortcut:{key:"Enter"},onShortcut:V,preventDefault:!1},{shortcut:{key:"ArrowDown",alt:!0},onShortcut:P}]);var yt=m(ie,2);Ve(Nr(yt,{get id(){return T},get searchQuery(){return t()},get isOpen(){return e(A)},onClearAllSearchTerms:F,onClearSearchTerm:i=>x(i),onSelectSearchTerm:i=>xe(s(i)),onActiveSelectionChange:i=>O(w,i,!0),get isSearchSuggestions(){return e(g)},set isSearchSuggestions(i){O(g,i,!0)}}),i=>O(_,i,!0),()=>e(_)),o(De),Ne(De,(i,B)=>Ze?.(i,B),()=>({onFocusOut:z}));var rt=m(De,2);{var _t=i=>{var B=Dr();let me;var Me=d(B),nt=d(Me);He(nt,{class:"bg-immich-primary text-white dark:bg-immich-dark-primary/90 dark:text-black/75 rounded-full px-3 py-1 text-xs hover:opacity-80 transition-opacity cursor-pointer",onclick:U,get"aria-expanded"(){return e(I)},"aria-haspopup":"listbox",children:(ye,ke)=>{ee();var Se=te();L(Oe=>H(Se,Oe),[Qe]),b(ye,Se)},$$slots:{default:!0}});var kt=m(nt,2);{var St=ye=>{var ke=Er();Je(ke,21,()=>qe,Se=>Se.value,(Se,Oe)=>{var Fe=zr();Fe.__click=()=>ae(e(Oe).value);var wt=d(Fe,!0);o(Fe),L(Tt=>{Te(Fe,1,`w-full text-left px-3 py-2 text-xs hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors
                         ${e(u)===e(Oe).value?"bg-gray-100 dark:bg-gray-700":""}`),H(wt,Tt)},[()=>e(Oe).label()]),b(Se,Fe)}),o(ke),b(ye,ke)};le(kt,ye=>{e(I)&&ye(St)})}o(Me),Ne(Me,(ye,ke)=>Ze?.(ye,ke),()=>({onFocusOut:J})),o(B),L(()=>{K(B,"id",C),me=Te(B,1,"absolute inset-y-0 flex items-center end-16",null,me,{"max-md:hidden":t(),"end-28":t().length>0})}),b(i,B)};le(rt,i=>{Y.isSearchEnabled&&i(_t)})}var at=m(rt,2);{var bt=i=>{var B=Br(),me=d(B);{let Me=n(()=>a()("clear"));Re(me,{onclick:R,get icon(){return Ke},get"aria-label"(){return e(Me)},size:"medium",color:"secondary",variant:"ghost",shape:"round"})}o(B),b(i,B)};le(at,i=>{e(y)&&i(bt)})}var lt=m(at,2),xt=d(lt);{let i=n(()=>a()("search"));Re(xt,{type:"submit",get"aria-label"(){return e(i)},get icon(){return gt},size:"medium",onclick:()=>{},shape:"round",color:"secondary",variant:"ghost"})}o(lt),o(ve);var Ye=m(ve,2),$t=d(Ye);{let i=n(()=>a()("show_search_options"));Re($t,{get"aria-label"(){return e(i)},shape:"round",get icon(){return mt},onclick:v,size:"medium",color:"secondary",variant:"ghost"})}o(Ye),o($e),Ne($e,(i,B)=>Ze?.(i,B),()=>({onFocusOut:k})),L((i,B,me)=>{K(ve,"action",i),H(pt,B),Te(ie,1,`w-full transition-all border-2 ps-14 py-4 max-md:py-2 text-immich-fg/75 dark:text-immich-dark-fg
        ${e(y)?"pe-22.5":"pe-14"}
        ${r.grayTheme?"dark:bg-immich-dark-gray":"dark:bg-immich-dark-bg"}
        ${e(A)&&e(g)?"rounded-t-3xl":"rounded-3xl bg-gray-200"}
        ${Y.isSearchEnabled?"border-gray-200 dark:border-gray-700 bg-white":"border-transparent"}`),K(ie,"placeholder",me),K(ie,"aria-controls",T),K(ie,"aria-activedescendant",e(w)??""),K(ie,"aria-expanded",e(A)&&e(g)),K(ie,"aria-describedby",C),Te(Ye,1,`absolute inset-y-0 ${e(y)?"end-14":"end-2"} flex items-center ps-6 transition-all`)},[()=>ct.search(),()=>a()("search_your_photos"),()=>a()("search_your_photos")]),ze("reset",ve,()=>t("")),ze("submit",ve,re),ze("focus",ie,P),b(D,$e),oe(),Q()}Ue(["focusin","input","click"]);export{gr as S,ya as a};

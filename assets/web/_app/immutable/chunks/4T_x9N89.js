import{e as n,Q as d,af as f,S as l,ag as h}from"./BOqQhZBJ.js";import{c as p}from"./BufZg4h2.js";function g(o,r,a){n(()=>{var e=d(()=>r(o,a?.())||{});if(a&&e?.update){var i=!1,t={};f(()=>{var s=a();l(s),i&&h(t,s)&&(t=s,e.update(s))}),i=!0}if(e?.destroy)return()=>e.destroy()})}class v{#e;#t;#r=()=>{};#s;get current(){return this.#t(),this.#e}set current(r){this.#s(r),this.#r(),this.#e=r}constructor(r,a,e){const i=e.read(r);this.#e=i===void 0?a:i,this.#s=t=>e.write(r,t),this.#t=p(t=>(this.#r=t,()=>{this.#r=()=>{}}))}}class b extends v{constructor(r,a,e={}){const i=e.valid||(()=>!0),t=e.serializer||JSON;super(r,a,{read:s=>{const c=localStorage.getItem(s)??void 0;if(c===void 0)return;const u=t.parse(c);if(i(u))return u},write:(s,c)=>{localStorage.setItem(s,t.stringify(c))}})}}export{b as P,g as a};

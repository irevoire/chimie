import{u,E as p,A as h,P as a}from"./BQXmwHOz.js";import{V as v}from"./DpAluyhr.js";function m({src:e,withCredentials:t,muted:r,autoplay:o}){const i=document.createElement("video");return i.crossOrigin=t?"use-credentials":"anonymous",i.loop=!0,i.playsInline=!0,i.autoplay=o,i.muted=r,i.preload="metadata",e instanceof MediaStream?i.srcObject=e:i.src=e,i}var n=class extends h{constructor(e){super(e)}init(){super.init(),this.viewer.needsContinuousUpdate(!0)}destroy(){this.__removeVideo(),super.destroy()}supportsPreload(){return!1}supportsTransition(){return!1}async loadTexture(e){if(typeof e!="object"||!e.source)return Promise.reject(new a("Invalid panorama configuration, are you using the right adapter?"));if(!this.viewer.getPlugin("video"))return Promise.reject(new a("Video adapters require VideoPlugin to be loaded too."));const t=e.source instanceof HTMLVideoElement?e.source:m({src:e.source,withCredentials:this.viewer.config.withCredentials(e.source),muted:!0,autoplay:!1});await this.__videoLoadPromise(t);const r=new v(t);return{panorama:e,texture:r}}switchVideo(e){let t,r,o=!this.config.autoplay,i=this.config.muted,s=1;this.video&&({currentTime:t,duration:r,paused:o,muted:i,volume:s}=this.video),this.__removeVideo(),this.video=e.image,this.video.duration===r&&(this.video.currentTime=t),this.video.muted=i,this.video.volume=s,o||this.video.play()}setTextureOpacity(e,t){e.material.opacity=t,e.material.transparent=t<1}disposeTexture({texture:e}){e.dispose()}disposeMesh(e){e.geometry.dispose(),e.material.dispose()}__removeVideo(){this.video&&(this.video.pause(),this.video.remove(),delete this.video)}__videoLoadPromise(e){return new Promise((t,r)=>{const o=()=>{this.video&&e.duration===this.video.duration&&(e.currentTime=this.video.currentTime),t(),e.removeEventListener("loadedmetadata",o)},i=s=>{r(s),e.removeEventListener("error",i)};e.addEventListener("loadedmetadata",o),e.addEventListener("error",i)})}};n.supportsDownload=!1;var f=u.getConfigParser({resolution:64,autoplay:!1,muted:!1}),d=class c extends n{static withConfig(t){return[c,t]}constructor(t,r){super(t),this.config=f(r),this.adapter=new p(this.viewer,{resolution:this.config.resolution})}destroy(){this.adapter.destroy(),delete this.adapter,super.destroy()}textureCoordsToSphericalCoords(t,r){return this.adapter.textureCoordsToSphericalCoords(t,r)}sphericalCoordsToTextureCoords(t,r){return this.adapter.sphericalCoordsToTextureCoords(t,r)}async loadTexture(t,r,o){const{texture:i}=await super.loadTexture(t),s=i.image;t.data&&(o=t.data),typeof o=="function"&&(o=o(s));const l=u.mergePanoData(s.videoWidth,s.videoHeight,o);return{panorama:t,texture:i,panoData:l}}createMesh(t){return this.adapter.createMesh(t)}setTexture(t,{texture:r}){t.material.map=r,this.switchVideo(r)}};d.id="equirectangular-video";d.VERSION="5.14.1";var T=d;export{T as EquirectangularVideoAdapter};

import"./DsnmJJEf.js";import{p as W,h as C,i as I,P as _t,g as t,c as X,r as Y,s as S,t as tt,j as d,a as N,u as c,f as B,n as ot}from"./BOqQhZBJ.js";import{f as U,a as T,t as rt,c as pt}from"./CnteGC4G.js";import{i as R}from"./QS5y7wlf.js";import{p as E,r as ht,a as P,s as V}from"./B227BkWK.js";import{M as ut}from"./ClWsMFS7.js";import{d as bt,s as et}from"./BufZg4h2.js";import{C as $t}from"./Bz1BELIr.js";import{D as yt}from"./zKTaOrsI.js";import{h as Ct,r as J,s as K,bC as wt,a_ as Dt,bn as xt}from"./LrV5ZTyj.js";import{b as Q,L as nt}from"./eLOR7anR.js";import{$ as q}from"./DdY9CyNE.js";import{b as it,D as at,u as mt}from"./Cx5lmlld.js";import{g as lt,a as Tt,t as St}from"./CH9-R8qO.js";import{L as ct}from"./Jagi0WJL.js";import{h as dt}from"./D4fmOnVC.js";import{j as st}from"./DeYUhNiz.js";import{F as kt}from"./C0Ca_l_S.js";import{F as Mt}from"./DzmAA-7p.js";import{S as Ot}from"./rybNiN9i.js";import{g as ft}from"./Dw326QmB.js";import{f as At}from"./BIB7ntQe.js";import{m as It}from"./C20f7eOz.js";import{C as Pt}from"./ghntbn61.js";var zt=U('<div><button type="button" class="w-8 text-xl font-bold leading-none" title="Toggle sign"> </button> <input type="number" min="0" class="w-1/3"/> <input type="number" min="0" max="23" class="w-1/3"/> <input type="number" min="0" max="59" class="w-1/3"/></div>');function Ft(k,s){W(s,!0);const h=()=>P(q,"$t",o),[o,b]=V();let w=E(s,"value",15),$=E(s,"class",3,""),f=ht(s,["$$slots","$$events","$$legacy","value","class"]);function g(r){const u=it.fromObject({minutes:Math.abs(r)}).shiftTo("days","hours","minutes");return{sign:r<0?-1:1,days:u.days===0?null:u.days,hours:u.hours===0?null:u.hours,minutes:u.minutes===0?null:u.minutes}}function n(r,u,L,H){return r*it.fromObject({days:u??0,hours:L??0,minutes:H??0}).shiftTo("minutes").minutes}const i=g(w());let l=C(I(i.sign)),a=C(I(i.days)),m=C(I(i.hours)),D=C(I(i.minutes));_t(()=>{w(n(t(l),t(a),t(m),t(D)))});function x(){d(l,-t(l))}var e=zt();Ct(e,()=>({class:`flex gap-2 ${$()}`,...f}));var v=X(e);v.__click=x;var z=X(v,!0);Y(v);var F=S(v,2);J(F);var M=S(F,2);J(M);var A=S(M,2);J(A),Y(e),tt((r,u,L)=>{et(z,t(l)>=0?"+":"-"),K(F,"placeholder",r),K(M,"placeholder",u),K(A,"placeholder",L)},[()=>h()("days"),()=>h()("hours"),()=>h()("minutes")]),Q(F,()=>t(a),r=>d(a,r)),Q(M,()=>t(m),r=>d(m,r)),Q(A,()=>t(D),r=>d(D,r)),T(k,e),N(),b()}bt(["click"]);var Lt=U("<!> <!>",1),Zt=U("<!> <!>",1),jt=U('<!> <!> <div class="w-full"><!></div>',1);function Bt(k,s){W(s,!0);const h=()=>P(mt,"$user",b),o=()=>P(q,"$t",b),[b,w]=V();let $=E(s,"initialDate",19,()=>at.now()),f=C(!1),g=C(0),n=C(I($().toFormat("yyyy-MM-dd'T'HH:mm:ss.SSS")));const i=c(()=>Tt(t(n)));let l=C(I(lt($(),s.initialTimeZone,t(i)))),a=c(()=>lt($(),s.initialTimeZone,t(i),t(l)));const m=async()=>{const x=ct(s.assets,h());try{if(t(f)&&(t(g)||t(a))){await st({assetBulkUpdateDto:{ids:x,dateTimeRelative:t(g),timeZone:t(a)?.value}}),s.onClose(!0);return}const e=St(t(n),t(a));await st({assetBulkUpdateDto:{ids:x,dateTimeOriginal:e}}),s.onClose(!0)}catch(e){dt(e,o()("errors.unable_to_change_date")),s.onClose(!1)}},D=c(()=>at.fromISO(t(n),{zone:t(a)?.value,setZone:!0}));{let x=c(()=>o()("edit_date_and_time")),e=c(()=>o()("confirm")),v=c(()=>!t(D).isValid);kt(k,{get title(){return t(x)},get icon(){return wt},onClose:()=>s.onClose(!1),onSubmit:m,get submitText(){return t(e)},get disabled(){return t(v)},size:"small",children:(z,F)=>{var M=jt(),A=B(M);{let _=c(()=>o()("edit_date_and_time_by_offset"));Mt(A,{get label(){return t(_)},children:(y,p)=>{Ot(y,{"data-testid":"edit-by-offset-switch",class:"mb-2",get checked(){return t(f)},set checked(Z){d(f,Z,!0)}})},$$slots:{default:!0}})}var r=S(A,2);{var u=_=>{var y=Lt(),p=B(y);nt(p,{for:"relativedatetime",class:"block mb-1",children:(O,vt)=>{ot();var j=rt();tt(G=>et(j,G),[()=>o()("offset")]),T(O,j)},$$slots:{default:!0}});var Z=S(p,2);Ft(Z,{class:"immich-form-input w-full mb-2",id:"relativedatetime",get value(){return t(g)},set value(O){d(g,O,!0)}}),T(_,y)},L=_=>{var y=Zt(),p=B(y);nt(p,{for:"datetime",class:"block mb-1",children:(O,vt)=>{ot();var j=rt();tt(G=>et(j,G),[()=>o()("date_and_time")]),T(O,j)},$$slots:{default:!0}});var Z=S(p,2);yt(Z,{class:"immich-form-input w-full mb-2",id:"datetime",type:"datetime-local",get value(){return t(n)},set value(O){d(n,O,!0)}}),T(_,y)};R(r,_=>{t(f)?_(u):_(L,!1)})}var H=S(r,2),gt=X(H);{let _=c(()=>o()("timezone")),y=c(()=>o()("search_timezone"));$t(gt,{get label(){return t(_)},get options(){return t(i)},get placeholder(){return t(y)},onSelect:p=>d(l,p,!0),get selectedOption(){return t(a)},set selectedOption(p){d(a,p)}})}Y(H),T(z,M)},$$slots:{default:!0}})}N(),w()}function ce(k,s){W(s,!0);const h=()=>P(q,"$t",o),[o,b]=V();let w=E(s,"menuItem",3,!1);const{clearSelect:$,getOwnedAssets:f}=ft(),g=async()=>{const a=f(),m=a.length===1?At(a[0].localDateTime):at.now();await It.show(Bt,{initialDate:m,assets:a})&&$()};var n=pt(),i=B(n);{var l=a=>{{let m=c(()=>h()("change_date"));ut(a,{get text(){return t(m)},get icon(){return Dt},onClick:g})}};R(i,a=>{w()&&a(l)})}T(k,n),N(),b()}var Et=U("<!> <!>",1);function de(k,s){W(s,!0);const h=()=>P(mt,"$user",b),o=()=>P(q,"$t",b),[b,w]=V();let $=E(s,"menuItem",3,!1);const{clearSelect:f,getOwnedAssets:g}=ft();let n=C(!1);async function i(e){if(d(n,!1),!e)return;const v=ct(g(),h());try{await st({assetBulkUpdateDto:{ids:v,latitude:e.lat,longitude:e.lng}}),f()}catch(z){dt(z,o()("errors.unable_to_update_location"))}}var l=Et(),a=B(l);{var m=e=>{{let v=c(()=>o()("change_location"));ut(e,{get text(){return t(v)},get icon(){return xt},onClick:()=>d(n,!0)})}};R(a,e=>{$()&&e(m)})}var D=S(a,2);{var x=e=>{Pt(e,{onClose:i})};R(D,e=>{t(n)&&e(x)})}T(k,l),N(),w()}export{ce as C,de as a};

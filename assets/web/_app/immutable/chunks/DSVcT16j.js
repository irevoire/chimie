import"./DsnmJJEf.js";import{s as p,a as je}from"./BufZg4h2.js";import{p as xe,b as Ke,s as n,c as V,t as m,a as De,r as F,f as C,g as t,u as v,n as _,h as be,j as pe,i as Ie,at as qe}from"./BOqQhZBJ.js";import{i as ce}from"./QS5y7wlf.js";import{h as _e,e as Me}from"./D4fmOnVC.js";import{f as w,s as Ge,a as r,t as g,c as Ne}from"./CnteGC4G.js";import{p as fe,a as ye,s as Ue}from"./B227BkWK.js";import{H as Je}from"./Bj7pQby1.js";import{O as Ve}from"./Di6OVBka.js";import{B as Z}from"./BNLYq5HQ.js";import{e as re}from"./ytu5q_IM.js";import{V as Qe,R as Fe,o as Xe,l as Ye}from"./Jagi0WJL.js";import{a as Ze}from"./BjCgVxgW.js";import{g as ge,$ as He}from"./DdY9CyNE.js";import{n as Pe,p as ke,q as Se,i as Ce,u as Te,aa as et,V as tt,a4 as at,a as ae,aM as rt,cx as Ae,T as y,B as st,b8 as ot,cy as nt,cz as it,cA as lt}from"./LrV5ZTyj.js";import{b4 as Le,M as Oe,b5 as dt,N as ct}from"./DeYUhNiz.js";import{m as Ee,H as ue}from"./C20f7eOz.js";import{D as ve}from"./Cx5lmlld.js";import{C as Re,b as We,S as we}from"./Ze2c3aZz.js";import{C as ut}from"./BPix1jPq.js";var mt=w('<div><div class="absolute flex h-full w-full items-center justify-center"><!></div> <div></div></div>');function ft(o,e){xe(e,!0);let l=fe(e,"shape",3,"round"),a=fe(e,"size",3,"medium"),W=fe(e,"color",3,"primary"),j=fe(e,"border",3,!1);const N=Pe({base:"bg-light-100 dark:bg-light-200 relative w-full overflow-hidden",variants:{shape:ke.shape,size:{tiny:"h-2",small:"h-3",medium:"h-4",large:"h-5",giant:"h-7"},roundedSize:{tiny:"rounded-sm",small:"rounded-md",medium:"rounded-md",large:"rounded-lg",giant:"rounded-xl"},border:{true:"dark:border-light-300 border"}}}),K=Pe({base:"h-full transition-all duration-700 ease-in-out",variants:{color:ke.filledColor,shape:ke.shape,size:{tiny:"min-w-2",small:"min-w-3",medium:"min-w-4",large:"min-w-5",giant:"min-w-7"}}});var H=mt(),I=V(H),q=V(I);Ge(q,()=>e.children??Ke),F(I);var T=n(I,2);F(H),m((J,se)=>{Te(H,1,J),Te(T,1,se),et(T,`width: ${e.progress*100}%`)},[()=>Se(Ce(N({size:a(),shape:l(),roundedSize:l()==="semi-round"?a():void 0,border:j()}),e.class)),()=>Se(Ce(K({size:e.progress>0?a():void 0,color:W(),shape:l()})))]),r(o,H),De()}const pt=(o,e)=>{const l={type:o("command"),title:o("download"),icon:at,onAction:()=>gt(e)},a={type:o("command"),title:o("delete"),icon:tt,color:"danger",onAction:()=>_t(e)};return{Download:l,Delete:a}},vt=async o=>{const e=await ge();if(await Ee.showDialog({confirmText:e("restore"),title:e("admin.maintenance_restore_backup"),prompt:e("admin.maintenance_restore_backup_description")}))try{await Le({setMaintenanceModeDto:{action:Oe.RestoreDatabase,restoreBackupFilename:o}})}catch(a){_e(a,e("admin.maintenance_start_error"))}},_t=async(...o)=>{const e=await ge();if(await Ee.showDialog({confirmText:e("delete"),title:e("admin.maintenance_delete_backup"),prompt:e("admin.maintenance_delete_backup_description")}))try{for(const a of o)re.emit("BackupDeleteStatus",{filename:a,isDeleting:!0});await dt({databaseBackupDeleteDto:{backups:o}});for(const a of o)re.emit("BackupDeleted",{filename:a})}catch(a){_e(a,e("admin.maintenance_delete_error"));for(const W of o)re.emit("BackupDeleteStatus",{filename:W,isDeleting:!1})}},gt=o=>{location.href=Fe()+"/admin/database-backups/"+o},$t=async()=>{const o=await ge();try{const[e]=await Ze({multiple:!1}),l=new FormData;l.append("file",e),await Qe({url:Fe()+"/admin/database-backups/upload",data:l,onUploadProgress(a){re.emit("BackupUpload",{progress:a.loaded/a.total,isComplete:!1})}}),re.emit("BackupUpload",{progress:1,isComplete:!0})}catch(e){_e(e,o("admin.maintenance_upload_backup_error"))}finally{re.emit("BackupUpload",{progress:-1,isComplete:!1})}};var ht=w('<div class="flex items-center gap-2"><div class="w-1 h-1 bg-light-500"></div> <!></div>'),kt=w("<!> <!> <!>",1),bt=w("<!> <!>",1),yt=w("<!> <!>",1),wt=w('<div class="flex gap-1"><!> <!></div> <div class="flex gap-1"><!> <!></div>',1),xt=w('<div class="flex justify-between items-center gap-3"><!> <!></div> <!> <!> <!>',1),Dt=w("<!> <!>",1);function zt(o,e){xe(e,!0);const l=()=>ye(Ye,"$locale",W),a=()=>ye(He,"$t",W),[W,j]=Ue(),N=v(()=>Xe(e.filesize,1)),K=v(()=>{const c=e.filename.match(/\d+T\d+/);return c?ve.fromFormat(c[0],"yyyyMMdd'T'HHmmss",{zone:"utc"}).toLocal():null}),H=v(()=>t(K)?.toLocaleString(ve.TIME_SIMPLE)),I=v(()=>t(K)?.toRelative({locale:l()})),q=v(()=>e.filename.match(/-v(.*)-/)?.[1]),T=v(()=>t(q)?t(q)!==e.expectedVersion?Z.DifferentVersion:Z.OK:Z.UnknownVersion),J=v(()=>pt(a(),e.filename)),se=v(()=>t(J).Download),u=v(()=>t(J).Delete);let A=be(!1);function ee(c){c.filename===e.filename&&pe(A,c.isDeleting,!0)}var $=Dt(),x=C($);Ve(x,{onBackupDeleteStatus:ee});var h=n(x,2);Re(h,{class:"dark:bg-dark-900",children:(c,oe)=>{We(c,{class:"pt-3 pb-4 px-6",children:(me,ne)=>{we(me,{gap:3,class:"grow min-w-0",children:(ie,$e)=>{var Q=xt(),f=C(Q),z=V(f);ue(z,{gap:2,class:"min-w-0",children:(i,P)=>{var k=kt(),d=C(k);{var D=s=>{ae(s,{get icon(){return rt},size:"18",class:"text-success"})},E=s=>{ae(s,{get icon(){return Ae},size:"18",class:"text-warning"})},G=s=>{ae(s,{get icon(){return Ae},size:"18",class:"text-danger"})};ce(d,s=>{t(T)===Z.OK?s(D):t(T)===Z.DifferentVersion?s(E,1):s(G,!1)})}var S=n(d,2);{var le=s=>{y(s,{class:"font-medium",size:"small",children:(X,he)=>{_();var Y=g();m(()=>p(Y,t(H))),r(X,Y)},$$slots:{default:!0}})},R=s=>{y(s,{class:"font-medium",size:"small",children:(X,he)=>{_();var Y=g();m(ze=>p(Y,ze),[()=>a()("unknown_date")]),r(X,Y)},$$slots:{default:!0}})};ce(S,s=>{t(H)?s(le):s(R,!1)})}var de=n(S,2);{var b=s=>{var X=ht(),he=n(V(X),2);y(he,{size:"tiny",color:"muted",children:(Y,ze)=>{_();var Be=g();m(()=>p(Be,t(I))),r(Y,Be)},$$slots:{default:!0}}),F(X),r(s,X)};ce(de,s=>{t(I)&&s(b)})}r(i,k)},$$slots:{default:!0}});var L=n(z,2);ue(L,{gap:1,children:(i,P)=>{var k=bt(),d=C(k);st(d,{size:"small",onclick:()=>vt(e.filename),get disabled(){return t(A)},children:(E,G)=>{_();var S=g();m(le=>p(S,le),[()=>a()("restore")]),r(E,S)},$$slots:{default:!0}});var D=n(d,2);{let E=v(()=>a()("open")),G=v(()=>[t(se),t(u)]);ut(D,{get disabled(){return t(A)},position:"top-right",get"aria-label"(){return t(E)},get items(){return t(G)}})}r(i,k)},$$slots:{default:!0}}),F(f);var U=n(f,2);ue(U,{children:(i,P)=>{var k=yt(),d=C(k);ae(d,{get icon(){return ot},size:"16",color:"gray"});var D=n(d,2);y(D,{size:"small",class:"break-all font-mono",children:(E,G)=>{_();var S=g();m(()=>p(S,e.filename)),r(E,S)},$$slots:{default:!0}}),r(i,k)},$$slots:{default:!0}});var O=n(U,2);{var B=i=>{y(i,{size:"small",color:"danger",children:(P,k)=>{_();var d=g();m(D=>p(d,D),[()=>a()("admin.maintenance_restore_backup_unknown_version")]),r(P,d)},$$slots:{default:!0}})},M=i=>{y(i,{size:"small",color:"warning",children:(P,k)=>{_();var d=g();m(D=>p(d,D),[()=>a()("admin.maintenance_restore_backup_different_version")]),r(P,d)},$$slots:{default:!0}})};ce(O,i=>{t(T)===Z.UnknownVersion?i(B):t(T)===Z.DifferentVersion&&i(M,1)})}var te=n(O,2);ue(te,{gap:8,children:(i,P)=>{var k=wt(),d=C(k),D=V(d);y(D,{size:"tiny",color:"muted",children:(R,de)=>{_();var b=g();m(s=>p(b,`${s??""}:`),[()=>a()("version")]),r(R,b)},$$slots:{default:!0}});var E=n(D,2);y(E,{size:"tiny",fontWeight:"medium",children:(R,de)=>{_();var b=g();m(s=>p(b,s),[()=>t(q)?`v${t(q)}`:a()("unknown")]),r(R,b)},$$slots:{default:!0}}),F(d);var G=n(d,2),S=V(G);y(S,{size:"tiny",color:"muted",children:(R,de)=>{_();var b=g();m(s=>p(b,`${s??""}:`),[()=>a()("size")]),r(R,b)},$$slots:{default:!0}});var le=n(S,2);y(le,{size:"tiny",fontWeight:"medium",children:(R,de)=>{_();var b=g();m(()=>p(b,`${t(N)[0]??""} ${t(N)[1]??""}`)),r(R,b)},$$slots:{default:!0}}),F(G),r(i,k)},$$slots:{default:!0}}),r(ie,Q)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),r(o,$),De(),j()}var Bt=w('<div class="flex justify-between items-center"><div class="flex gap-2 items-end w-max"><!> <!></div> <!></div>'),Mt=w("<!> <!>",1),Pt=w('<div class="mt-5 mb-1"><div class="bg-primary-50 flex gap-2 px-4 py-2 rounded-xl w-max place-items-center"><!> <!></div></div> <!>',1),St=w("<!> <hr/> <!>",1),Ct=w("<!> <!>",1);function Zt(o,e){xe(e,!0);const l=()=>ye(He,"$t",a),[a,W]=Ue();let j=be(Ie(e.backups??[]));async function N(){const u=await ct();pe(j,u.backups,!0)}je(()=>{e.backups||N()});let K=be(-1);function H(u){pe(j,t(j).filter(A=>A.filename!==u.filename),!0)}function I(u){pe(K,u.progress,!0),u.isComplete&&N()}const q=v(()=>{const u=new Map,A=l()("unknown_date");for(const $ of t(j)){const x=$.filename.match(/\d+T\d+/);let h,c;x?(c=ve.fromFormat(x[0],"yyyyMMdd'T'HHmmss",{zone:"utc"}),h=c.toFormat("LLLL d, yyyy")):(c=ve.fromMillis(0),h=A),u.has(h)||u.set(h,{date:c.startOf("day"),backups:[]}),u.get(h).backups.push($)}const ee=[...u.entries()].sort(($,x)=>$[0]===A?-1:x[0]===A?1:x[1].date.toMillis()-$[1].date.toMillis());return new Map(ee.map(([$,x])=>[$,x.backups]))});var T=Ct(),J=C(T);Ve(J,{onBackupDeleted:H,onBackupUpload:I});var se=n(J,2);we(se,{gap:4,class:"mt-4 text-left",children:(u,A)=>{var ee=St(),$=C(ee);Re($,{color:"info",children:(h,c)=>{We(h,{children:(oe,me)=>{var ne=Ne(),ie=C(ne);{var $e=f=>{var z=Bt(),L=V(z),U=V(L);ae(U,{get icon(){return nt},size:"20",class:"text-muted"});var O=n(U,2);y(O,{class:"grow",children:(M,te)=>{_();var i=g();m(P=>p(i,P),[()=>l()("admin.maintenance_upload_backup")]),r(M,i)},$$slots:{default:!0}}),F(L);var B=n(L,2);{let M=v(()=>({color:"primary",title:l()("select_from_computer"),onAction:$t}));Je(B,{get action(){return t(M)}})}F(z),r(f,z)},Q=f=>{ue(f,{gap:8,children:(z,L)=>{var U=Mt(),O=C(U);y(O,{class:"grow",children:(M,te)=>{_();var i=g();m(P=>p(i,P),[()=>l()("asset_uploading")]),r(M,i)},$$slots:{default:!0}});var B=n(O,2);ft(B,{get progress(){return t(K)},size:"tiny"}),r(z,U)},$$slots:{default:!0}})};ce(ie,f=>{t(K)===-1?f($e):f(Q,!1)})}r(oe,ne)},$$slots:{default:!0}})},$$slots:{default:!0}});var x=n($,4);Me(x,17,()=>[...t(q).entries()],([h,c])=>h,(h,c)=>{var oe=v(()=>qe(t(c),2));let me=()=>t(oe)[0],ne=()=>t(oe)[1];we(h,{gap:2,children:(ie,$e)=>{var Q=Pt(),f=C(Q),z=V(f),L=V(z);ae(L,{get icon(){return it},size:"18"});var U=n(L,2);y(U,{size:"small",fontWeight:"medium",color:"muted",children:(B,M)=>{_();var te=g();m(()=>p(te,me())),r(B,te)},$$slots:{default:!0}}),F(z),F(f);var O=n(f,2);Me(O,17,ne,B=>B.filename,(B,M)=>{zt(B,{get filename(){return t(M).filename},get filesize(){return t(M).filesize},get expectedVersion(){return e.expectedVersion}})}),r(ie,Q)},$$slots:{default:!0}})}),r(u,ee)},$$slots:{default:!0}}),r(o,T),De(),W()}const ea=o=>({StartMaintenance:{title:o("admin.maintenance_start"),onAction:()=>Tt({action:Oe.Start}),icon:lt}}),Tt=async o=>{const e=await ge();try{await Le({setMaintenanceModeDto:o})}catch(l){_e(l,e("admin.maintenance_start_error"))}};export{Zt as M,ft as P,ea as g,Tt as h};

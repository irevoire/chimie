const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_app/immutable/chunks/BEfn6cqG.js","_app/immutable/chunks/DsnmJJEf.js","_app/immutable/chunks/BufZg4h2.js","_app/immutable/chunks/BOqQhZBJ.js","_app/immutable/chunks/DIeogL5L.js","_app/immutable/chunks/CnteGC4G.js","_app/immutable/chunks/QS5y7wlf.js","_app/immutable/chunks/D4fmOnVC.js","_app/immutable/chunks/DeYUhNiz.js","_app/immutable/chunks/B_VXSWsl.js","_app/immutable/chunks/B227BkWK.js","_app/immutable/chunks/LrV5ZTyj.js","_app/immutable/chunks/C4XZXykC.js","_app/immutable/chunks/BUApaBEI.js","_app/immutable/assets/Logo.BzPWps5k.css","_app/immutable/chunks/4T_x9N89.js","_app/immutable/chunks/CKQ4VlI3.js","_app/immutable/chunks/De1sTUmb.js","_app/immutable/chunks/BNLYq5HQ.js","_app/immutable/chunks/Jagi0WJL.js","_app/immutable/chunks/C2I_EQjW.js","_app/immutable/chunks/DbKlvrsB.js","_app/immutable/chunks/ytu5q_IM.js","_app/immutable/chunks/BeWG-__C.js","_app/immutable/chunks/DdY9CyNE.js","_app/immutable/chunks/Cx5lmlld.js","_app/immutable/chunks/_U16pX41.js","_app/immutable/chunks/Bp2HQ4kn.js","_app/immutable/chunks/CT-ELVN-.js","_app/immutable/chunks/ClWsMFS7.js","_app/immutable/chunks/Bz1BELIr.js","_app/immutable/chunks/eLOR7anR.js","_app/immutable/chunks/Clv0aeC8.js","_app/immutable/chunks/DFvk55M8.js","_app/immutable/chunks/DsCc9Mx1.js","_app/immutable/chunks/CsUlL5WR.js","_app/immutable/chunks/CYAb_6oJ.js","_app/immutable/chunks/CS-10t6W.js","_app/immutable/chunks/BihPMor6.js","_app/immutable/chunks/C20f7eOz.js","_app/immutable/chunks/Ze2c3aZz.js","_app/immutable/chunks/Vqhp0wrh.js","_app/immutable/chunks/BIB7ntQe.js","_app/immutable/chunks/BjCgVxgW.js","_app/immutable/chunks/DnqqNi3p.js","_app/immutable/chunks/D5h9ps2j.js","_app/immutable/chunks/CH9-R8qO.js","_app/immutable/chunks/C9pIfr-B.js","_app/immutable/chunks/BbGcRfD-.js","_app/immutable/chunks/BHgwLGQu.js","_app/immutable/chunks/69_IOA4Y.js","_app/immutable/chunks/CMtyP6CA.js","_app/immutable/chunks/CRYXttfP.js","_app/immutable/chunks/9i_j0jQI.js","_app/immutable/chunks/1WjNB9m1.js","_app/immutable/chunks/Bc5ULZvy.js","_app/immutable/chunks/C0Ca_l_S.js","_app/immutable/chunks/LRhZRw-S.js","_app/immutable/chunks/CBNU4HUx.js","_app/immutable/chunks/DzmAA-7p.js","_app/immutable/chunks/BJT5MMCK.js","_app/immutable/assets/Input.DUYXNfxO.css","_app/immutable/chunks/DHEjuV7w.js","_app/immutable/chunks/rybNiN9i.js","_app/immutable/chunks/CaDSsDA9.js","_app/immutable/chunks/FIvvbHQR.js","_app/immutable/chunks/yWuLE-qO.js","_app/immutable/chunks/izWpGtDw.js","_app/immutable/chunks/ngppk3MK.js","_app/immutable/chunks/BSBkdVh4.js","_app/immutable/chunks/BTHsrYEL.js","_app/immutable/chunks/y_IyUkeW.js","_app/immutable/chunks/Ydc33-3A.js","_app/immutable/chunks/ClLqiWoK.js","_app/immutable/chunks/BmZTbFl5.js","_app/immutable/chunks/BCL4P6ef.js","_app/immutable/chunks/SuizJy8Y.js","_app/immutable/chunks/Di6OVBka.js","_app/immutable/chunks/B6A-PVC5.js","_app/immutable/chunks/BXaFREg4.js","_app/immutable/assets/Textarea.M6eTxvbo.css","_app/immutable/assets/activity-viewer.CwxlvmcY.css","_app/immutable/chunks/B1PyaZbq.js","_app/immutable/assets/thumbnail.Di7rqjOL.css","_app/immutable/chunks/ghntbn61.js","_app/immutable/chunks/6ckOa7Ax.js","_app/immutable/chunks/Bj7pQby1.js","_app/immutable/chunks/Dj0AsE1j.js","_app/immutable/chunks/zKTaOrsI.js","_app/immutable/chunks/DxfhPdFw.js","_app/immutable/chunks/CaTmVaxL.js","_app/immutable/chunks/CsIzZJ43.js","_app/immutable/chunks/8PJ7VpFA.js","_app/immutable/chunks/BzKamodV.js","_app/immutable/chunks/D-O87UL4.js","_app/immutable/chunks/o4H9mija.js","_app/immutable/assets/asset-viewer.CSooJwqO.css"])))=>i.map(i=>d[i]);
import"./DsnmJJEf.js";import{d as ls,s as xt,e as at,a as se,b as ze}from"./BufZg4h2.js";import{h as y,g as e,j as f,u as M,i as Bt,d as _s,p as Dt,c as z,s as J,b as Le,r as V,t as $,a as _t,f as yt,P as vt,a7 as _e,Q as xs,W as cs,$ as Wt,n as ks}from"./BOqQhZBJ.js";import{f as N,s as ie,a as C,c as kt}from"./CnteGC4G.js";import{i as st}from"./QS5y7wlf.js";import{h as Hs,e as Ae,a as Cs}from"./D4fmOnVC.js";import{P as Es,a as us}from"./4T_x9N89.js";import{s as pt,aa as Z,G as Lt,eP as Os,d4 as Ps,u as Ht,q as Se,a as ve,aM as Ls,eQ as Ws,H as Fs,bq as Qe,ab as me,eR as Rs}from"./LrV5ZTyj.js";import{b as Je}from"./9i_j0jQI.js";import{s as Ut,a as ft,p as W,c as We,e as Bs,d as hs}from"./B227BkWK.js";import{g as Vs,b as Us,a as zs}from"./C4XZXykC.js";import{p as Ze}from"./DbKlvrsB.js";import{r as Ns}from"./CrEwRPGF.js";import{T as Ys}from"./B1PyaZbq.js";import{u as ds}from"./BjCgVxgW.js";import{S as Ks,f as js}from"./DtjhqBtS.js";import{av as Gt,b_ as $e,b$ as qs,f as fs,A as ts}from"./DeYUhNiz.js";import{a0 as Xs,Y as Ft,h as ms,n as es,b as Qs,a as Js,a6 as Zs,j as $s,s as ti}from"./Jagi0WJL.js";import{s as Ne,d as ei,p as gs,t as It,e as si,h as ii,j as ps,k as oi,l as vs,f as ss,m as ri,n as ni}from"./BIB7ntQe.js";import{a as Vt,k as xe,b as ge,l as ke}from"./C2I_EQjW.js";import{$ as Ye}from"./DdY9CyNE.js";import{s as ai}from"./BHgwLGQu.js";import{a as li,s as He}from"./Cv1syPnL.js";import{m as Fe}from"./BihPMor6.js";import{S as Rt,g as ci,m as ys,P as ui}from"./De1sTUmb.js";import{c as Re,u as Ce,b as pe,e as hi,g as di,a as fi,A as mi,d as gi}from"./CH9-R8qO.js";import{_ as pi,A as nt}from"./BNLYq5HQ.js";import{a as vi}from"./yWuLE-qO.js";import{a as ye}from"./ngppk3MK.js";import{C as ws,I as yi}from"./BTHsrYEL.js";import{e as Be}from"./ytu5q_IM.js";import{f as wi}from"./D5h9ps2j.js";import{D as bi}from"./zKTaOrsI.js";import{D as oe}from"./Cx5lmlld.js";import{F as Ai}from"./C0Ca_l_S.js";import{V as Si}from"./C9EoECmB.js";import{H as is,i as Ti,m as Ee}from"./C20f7eOz.js";import{S as Mi}from"./AHWy_irw.js";import{c as Ii,R as Gi}from"./BeWG-__C.js";import{s as Di}from"./_U16pX41.js";import{d as Ve}from"./Bc85SLlq.js";import{g as _i}from"./DeL_lkPB.js";import{i as xi}from"./BzKamodV.js";var ki="Expected a function";function Hi(l,t,s){var i=!0,o=!0;if(typeof l!="function")throw new TypeError(ki);return Ii(s)&&(i="leading"in s?!!s.leading:i,o="trailing"in s?!!s.trailing:o),Ve(l,t,{leading:i,maxWait:t,trailing:o})}class Ci{#t=y(0);get topSectionHeight(){return e(this.#t)}set topSectionHeight(t){f(this.#t,t,!0)}#o=y(0);get bodySectionHeight(){return e(this.#o)}set bodySectionHeight(t){f(this.#o,t,!0)}#i=y(0);get bottomSectionHeight(){return e(this.#i)}set bottomSectionHeight(t){f(this.#i,t,!0)}#n=M(()=>this.topSectionHeight+this.bodySectionHeight+this.bottomSectionHeight);get totalViewerHeight(){return e(this.#n)}set totalViewerHeight(t){f(this.#n,t)}#e=M(()=>({top:e(this.#a),bottom:e(this.#a)+this.viewportHeight}));get visibleWindow(){return e(this.#e)}set visibleWindow(t){f(this.#e,t)}#r=y(0);#u=y(0);#a=y(0);#l=y(235);#c=y(48);#s=y(12);#h=y(!1);#d=y(!1);#f=Ve(()=>f(this.#h,!1),1e3);#m=Ve(()=>this.suspendTransitions=!1,1e3);#p=M(()=>({spacing:2,heightTolerance:.5,rowHeight:e(this.#l),rowWidth:Math.floor(this.viewportWidth)}));constructor(){this.setLayoutOptions()}get scrollTop(){return 0}get justifiedLayoutOptions(){return e(this.#p)}get maxScrollPercent(){const t=this.totalViewerHeight;return(t-this.viewportHeight)/t}get maxScroll(){return this.totalViewerHeight-this.viewportHeight}#v(t){return e(this.#c)==t?!1:(f(this.#c,t,!0),!0)}get headerHeight(){return e(this.#c)}#y(t){return e(this.#s)==t?!1:(f(this.#s,t,!0),!0)}get gap(){return e(this.#s)}#g(t){return e(this.#l)==t?!1:(f(this.#l,t,!0),!0)}get rowHeight(){return e(this.#l)}set scrolling(t){f(this.#h,t,!0),t&&(this.suspendTransitions=!0,this.#f())}get scrolling(){return e(this.#h)}set suspendTransitions(t){f(this.#d,t,!0),t&&this.#m()}get suspendTransitions(){return e(this.#d)}set viewportWidth(t){const s=t!==e(this.#u);f(this.#u,t,!0),this.suspendTransitions=!0,this.updateViewportGeometry(s)}get viewportWidth(){return e(this.#u)}set viewportHeight(t){f(this.#r,t,!0),f(this.#d,!0),this.updateViewportGeometry(!1)}get viewportHeight(){return e(this.#r)}get hasEmptyViewport(){return this.viewportWidth===0||this.viewportHeight===0}updateIntersections(){}updateViewportGeometry(t){}setLayoutOptions({headerHeight:t=48,rowHeight:s=235,gap:i=12}={}){let o=!1;o||=this.#v(t),o||=this.#y(i),o||=this.#g(s),o&&this.refreshLayout()}updateSlidingWindow(){const t=this.scrollTop;e(this.#a)!==t&&(f(this.#a,t,!0),this.updateIntersections())}refreshLayout(){this.updateIntersections()}destroy(){}}class bs{#t={};unprocessedAssets=[];changedDayGroups=new Set;newDayGroups=new Set;getDayGroup({year:t,month:s,day:i}){return this.#t[t]?.[s]?.[i]}setDayGroup(t,{year:s,month:i,day:o}){this.#t[s]||(this.#t[s]={}),this.#t[s][i]||(this.#t[s][i]={}),this.#t[s][i][o]=t}get existingDayGroups(){return Ne(this.changedDayGroups,this.newDayGroups)}get updatedBuckets(){const t=new Set;for(const s of this.changedDayGroups)t.add(s.monthGroup);return t}get bucketsWithNewDayGroups(){const t=new Set;for(const s of this.newDayGroups)t.add(s.monthGroup);return t}sort(t,s=Gt.Desc){for(const i of this.changedDayGroups)i.sortAssets(s);for(const i of this.newDayGroups)i.sortAssets(s);this.newDayGroups.size>0&&t.sortDayGroups()}}const{TIMELINE:{INTERSECTION_EXPAND_TOP:As,INTERSECTION_EXPAND_BOTTOM:Ss}}=Xs;function Ei(l,t){const s=os(l,t,0,0);let i=!1;s||(i=os(l,t,As,Ss)),t.intersecting=s||i,t.actuallyIntersecting=s,(i||s)&&l.clearDeferredLayout(t)}function Ke(l,t,s,i){return l>=s&&l<i||t>=s&&t<i||l<s&&t>=i}function os(l,t,s,i){const o=t.top,a=o+t.height,u=l.visibleWindow.top-s,p=l.visibleWindow.bottom+i;return Ke(o,a,u,p)}function Oi(l,t,s,i=As,o=Ss){const a=l.visibleWindow.top-l.headerHeight-i,u=l.visibleWindow.bottom+l.headerHeight+o,p=t+s;return Ke(t,p,a,u)}function Pt(l,t,s){const{invalidateHeight:i,noDefer:o=!1}=s;if(i&&(t.isHeightActual=!1),!t.isLoaded){const a=l.viewportWidth;if(!t.isHeightActual){const u=1.5*t.assetsCount*l.rowHeight*.7,p=Math.ceil(u/a),S=l.headerHeight+Math.max(1,p)*l.rowHeight;t.height=S}return}Pi(l,t,o)}function Pi(l,t,s=!1){let i=0,o=0,a=0,u=0,p=0;const S=l.justifiedLayoutOptions;for(const n of t.dayGroups){n.layout(S,s);const m=n.width+(p>0?l.gap:0);o+m<=l.viewportWidth?(n.row=u,n.col=p++,n.left=o,n.top=i,o+=n.width+l.gap):(i+=a,o=0,u++,p=0,n.row=u,n.col=p,n.left=0,n.top=i,p++,o+=n.width+l.gap),a=n.height+l.headerHeight}i+=a,t.height=i,t.isHeightActual=!0}async function Li(l,t,s,i){if(t.getFirstAsset())return;const o=ei(t.yearMonth),a=await $e({...Vt.params,...s,timeBucket:o},{signal:i});if(!a)return;if(s.timelineAlbumId){const p=await $e({...Vt.params,albumId:s.timelineAlbumId,timeBucket:o},{signal:i});if(!p)return;for(const S of p.id)l.albumAssets.add(S)}const u=t.addAssets(a,!0);u.length>0&&console.error(`Warning: getTimeBucket API returning assets not in requested month: ${t.yearMonth.month}, ${JSON.stringify(u.map(p=>({id:p.id,localDateTime:p.localDateTime})))}`)}async function rs(l,t,s="asset",i){const o=await l.findMonthGroupForAsset(t);if(!o)return;const a=o.findAssetById(t);if(a)switch(s){case"asset":return Wi(l,a,o,i);case"day":return Fi(l,a,o,i);case"month":return Ri(l,o,i);case"year":return Bi(l,o,i)}}function we(l,t){for(const s of l.months){const i=s.findAssetById({id:t});if(i)return{monthGroup:s,asset:i}}}function Oe(l,t){return l.months.find(s=>s.yearMonth.year===t.year&&s.yearMonth.month===t.month)}async function Wi(l,t,s,i){const o=s.findDayGroupForAsset(t);for await(const a of l.assetsIterator({startMonthGroup:s,startDayGroup:o,startAsset:t,direction:i}))if(t.id!==a.id)return a}async function Fi(l,t,s,i){const o=s.findDayGroupForAsset(t);for await(const a of l.assetsIterator({startMonthGroup:s,startDayGroup:o,startAsset:t,direction:i}))if(a.localDateTime.day!==t.localDateTime.day)return a}async function Ri(l,t,s){for(const i of l.monthGroupIterator({startMonthGroup:t,direction:s}))if(i.yearMonth.month!==t.yearMonth.month){const{value:o,done:a}=await l.assetsIterator({startMonthGroup:i,direction:s}).next();return a?void 0:o}}async function Bi(l,t,s){for(const i of l.monthGroupIterator({startMonthGroup:t,direction:s}))if(i.yearMonth.year!==t.yearMonth.year){const{value:o,done:a}=await l.assetsIterator({startMonthGroup:i,direction:s}).next();return a?void 0:o}}async function Vi(l,t,s){let{asset:i,monthGroup:o}=we(l,t.id)??{};if(!o||!i)return[];let{asset:a,monthGroup:u}=we(l,s.id)??{};if(!u||!a)return[];const p=l.getAssetOrder();gs(p===Gt.Desc,i.localDateTime,a.localDateTime)<0&&([i,a]=[a,i],[o,u]=[u,o]);const S=[],n=o.findDayGroupForAsset(i);for await(const m of l.assetsIterator({startMonthGroup:o,startDayGroup:n,startAsset:i}))if(S.push(m),m.id===a.id)break;return S}function Ui(l,t){for(const s of l.months){const{year:i,month:o}=s.yearMonth;if(o===t.month&&i===t.year)return s}}function zi(l,t){const s=oe.fromObject({year:t.year,month:t.month});let i,o=Number.MAX_SAFE_INTEGER;for(const a of l){const u=oe.fromObject({year:a.yearMonth.year,month:a.yearMonth.month}),p=Math.abs(u.diff(s,"months").months);p<o&&(o=p,i=a)}return i}class Ni{#t=[];#o=[];#i;#n=Hi(()=>{const{add:t,update:s,remove:i}=this.#r();t.length>0&&this.#i.upsertAssets(t),s.length>0&&this.#i.upsertAssets(s),i.length>0&&this.#i.removeAssets(i),this.#t=[]},2500);constructor(t){this.#i=t}connectWebsocketEvents(){this.#o.push(Ft.on("on_upload_success",t=>this.#e({type:"add",values:[It(t)]})),Ft.on("on_asset_trash",t=>this.#e({type:"trash",values:t})),Ft.on("on_asset_update",t=>this.#e({type:"update",values:[It(t)]})),Ft.on("on_asset_delete",t=>this.#e({type:"delete",values:[t]})))}disconnectWebsocketEvents(){for(const t of this.#o)t();this.#o=[]}#e(...t){this.#t.push(...t),this.#n()}#r(){const t={add:[],update:[],remove:[]};for(const{type:s,values:i}of this.#t)switch(s){case"add":{t.add.push(...i);break}case"update":{t.update.push(...i);break}case"delete":case"trash":{t.remove.push(...i);break}}return t}}class Yi{#t;#o=M(()=>{if(!this.position)return!1;const t=this.#t.monthGroup.timelineManager,s=this.#t.absoluteDayGroupTop+this.position.top;return Oi(t,s,this.position.height)});get intersecting(){return e(this.#o)}set intersecting(t){f(this.#o,t)}#i=y();get position(){return e(this.#i)}set position(t){f(this.#i,t)}#n=y();get asset(){return e(this.#n)}set asset(t){f(this.#n,t,!0)}#e=M(()=>this.asset.id);get id(){return e(this.#e)}set id(t){f(this.#e,t)}constructor(t,s){this.#t=t,this.asset=s}}class Ki{monthGroup;index;groupTitle;day;#t=y(Bt([]));get viewerAssets(){return e(this.#t)}set viewerAssets(t){f(this.#t,t,!0)}#o=y(0);get height(){return e(this.#o)}set height(t){f(this.#o,t,!0)}#i=y(0);get width(){return e(this.#i)}set width(t){f(this.#i,t,!0)}#n=M(()=>this.viewerAssets.some(t=>t.intersecting));get intersecting(){return e(this.#n)}set intersecting(t){f(this.#n,t)}#e=y(0);#r=y(0);#u=y(0);#a=y(0);#l=!1;constructor(t,s,i,o){this.index=s,this.monthGroup=t,this.day=i,this.groupTitle=o}get top(){return e(this.#e)}set top(t){f(this.#e,t,!0)}get left(){return e(this.#r)}set left(t){f(this.#r,t,!0)}get row(){return e(this.#u)}set row(t){f(this.#u,t,!0)}get col(){return e(this.#a)}set col(t){f(this.#a,t,!0)}get deferredLayout(){return this.#l}set deferredLayout(t){this.#l=t}sortAssets(t=Gt.Desc){const s=gs.bind(void 0,t===Gt.Asc);this.viewerAssets.sort((i,o)=>s(i.asset.fileCreatedAt,o.asset.fileCreatedAt))}getFirstAsset(){return this.viewerAssets[0]?.asset}*assetsIterator(t={}){const s=(t?.direction??"earlier")==="earlier";let i=t?.startAsset?this.viewerAssets.findIndex(o=>o.asset.id===t.startAsset.id):s?0:this.viewerAssets.length-1;for(;i>=0&&i<this.viewerAssets.length;)yield this.viewerAssets[i].asset,i+=s?1:-1}getAssets(){return this.viewerAssets.map(t=>t.asset)}runAssetCallback(t,s){const i=new Rt(t),o=new Rt,a=[];let u=!1;if(t.size===0)return{moveAssets:a,processedIds:o,unprocessedIds:i,changedGeometry:u};for(let p=this.viewerAssets.length-1;p>=0;p--){const{id:S,asset:n}=this.viewerAssets[p];if(!t.has(S))continue;const m={...n.localDateTime};let k=s(n)?.remove??!1;const G=n.localDateTime;if(m.year!==G.year||m.month!==G.month||m.day!==G.day){const{year:A,month:E,day:Y}=G;k=!0,a.push({asset:n,date:{year:A,month:E,day:Y}})}i.delete(S),o.add(S),(k||this.monthGroup.timelineManager.isExcluded(n))&&(this.viewerAssets.splice(p,1),u=!0)}return{moveAssets:a,processedIds:o,unprocessedIds:i,changedGeometry:u}}layout(t,s){if(!s&&!this.monthGroup.intersecting&&!this.monthGroup.timelineManager.isScrollingOnLoad){this.#l=!0;return}const i=this.viewerAssets.map(a=>a.asset),o=_i(i,t);this.width=o.containerWidth,this.height=i.length===0?0:o.containerHeight;for(let a=0;a<this.viewerAssets.length;a++)this.viewerAssets[a].position=o.getPosition(a)}get absoluteDayGroupTop(){return this.monthGroup.top+e(this.#e)}}function Ts(l,t){if(!l)return!1;let s=!1;for(const i in t){if(!Object.prototype.hasOwnProperty.call(t,i)||i==="__proto__"||i==="constructor")continue;const o=l[i]instanceof Date;typeof l[i]=="object"&&!o?s=s||Ts(l[i],t[i]):l[i]!==t[i]&&(l[i]=t[i],s=!0)}return s}function Pe(l,t){return l===void 0?!1:l!==t}class ns{#t=y(!1);#o=y(!1);get actuallyIntersecting(){return e(this.#o)}set actuallyIntersecting(t){f(this.#o,t,!0)}#i=y(!1);get isLoaded(){return e(this.#i)}set isLoaded(t){f(this.#i,t,!0)}#n=y(Bt([]));get dayGroups(){return e(this.#n)}set dayGroups(t){f(this.#n,t,!0)}timelineManager;#e=y(0);#r=y(0);#u=0;#a=Gt.Desc;#l=y(0);get percent(){return e(this.#l)}set percent(t){f(this.#l,t,!0)}#c=M(()=>this.isLoaded?this.dayGroups.reduce((t,s)=>t+s.viewerAssets.length,0):this.#u);get assetsCount(){return e(this.#c)}set assetsCount(t){f(this.#c,t)}loader;#s=y(!1);get isHeightActual(){return e(this.#s)}set isHeightActual(t){f(this.#s,t,!0)}monthGroupTitle;yearMonth;constructor(t,s,i,o,a=Gt.Desc){this.timelineManager=t,this.#u=i,this.#a=a,this.yearMonth=s,this.monthGroupTitle=si(ii(s)),this.loader=new ws(()=>{this.isLoaded=!0},()=>{this.dayGroups=[],this.isLoaded=!1},this.#h),o&&(this.isLoaded=!0)}set intersecting(t){e(this.#t)!==t&&(f(this.#t,t,!0),t?this.timelineManager.loadMonthGroup(this.yearMonth):this.cancel())}get intersecting(){return e(this.#t)}get lastDayGroup(){return this.dayGroups.at(-1)}getFirstAsset(){return this.dayGroups[0]?.getFirstAsset()}getAssets(){return this.dayGroups.reduce((t,s)=>t.concat(s.getAssets()),[])}sortDayGroups(){return this.#a===Gt.Asc?this.dayGroups.sort((t,s)=>t.day-s.day):this.dayGroups.sort((t,s)=>s.day-t.day)}runAssetCallback(t,s){if(t.size===0)return{moveAssets:[],processedIds:new Rt,unprocessedIds:t,changedGeometry:!1};const{dayGroups:i}=this;let o=!1,a=new Rt(t);const u=new Rt,p=[];let S=i.length;for(;S--;)if(a.size>0){const n=i[S],{moveAssets:m,processedIds:x,changedGeometry:k}=n.runAssetCallback(t,s);m.length>0&&p.push(m),a=Ne(a,x);for(const G of x)u.add(G);o=o||k,n.viewerAssets.length===0&&(i.splice(S,1),o=!0)}return{moveAssets:p.flat(),unprocessedIds:a,processedIds:u,changedGeometry:o}}addAssets(t,s){const i=new bs;for(let o=0;o<t.id.length;o++){const{localDateTime:a,fileCreatedAt:u}=ps(t.fileCreatedAt[o],t.localOffsetHours[o]),p={city:t.city[o],country:t.country[o],duration:t.duration[o],id:t.id[o],visibility:t.visibility[o],isFavorite:t.isFavorite[o],isImage:t.isImage[o],isTrashed:t.isTrashed[o],isVideo:!t.isImage[o],livePhotoVideoId:t.livePhotoVideoId[o],localDateTime:a,fileCreatedAt:u,ownerId:t.ownerId[o],projectionType:t.projectionType[o],ratio:t.ratio[o],stack:t.stack?.[o]?{id:t.stack[o][0],primaryAssetId:t.id[o],assetCount:Number.parseInt(t.stack[o][1])}:null,thumbhash:t.thumbhash[o],people:null};t.latitude?.[o]&&t.longitude?.[o]&&(p.latitude=t.latitude?.[o],p.longitude=t.longitude?.[o]),this.addTimelineAsset(p,i)}if(s)return i.unprocessedAssets;for(const o of i.existingDayGroups)o.sortAssets(this.#a);return i.newDayGroups.size>0&&this.sortDayGroups(),i.sort(this,this.#a),i.unprocessedAssets}addTimelineAsset(t,s){const{localDateTime:i}=t,{year:o,month:a}=this.yearMonth;if(a!==i.month||o!==i.year){s.unprocessedAssets.push(t);return}let u=s.getDayGroup(i)||this.findDayGroupByDay(i.day);if(u)s.setDayGroup(u,i);else{const S=oi(vs(i));u=new Ki(this,this.dayGroups.length,i.day,S),this.dayGroups.push(u),s.setDayGroup(u,i),s.newDayGroups.add(u)}const p=new Yi(u,t);u.viewerAssets.push(p),s.changedDayGroups.add(u)}get viewId(){const{year:t,month:s}=this.yearMonth;return t+"-"+s}set height(t){if(e(this.#e)===t)return;const s=this.timelineManager,i=s.months.indexOf(this),o=t-e(this.#e);f(this.#e,t,!0);const a=s.months[i-1];if(a){const m=e(a.#r)+e(a.#e);e(this.#r)!==m&&f(this.#r,m)}if(o===0)return;for(let m=i+1;m<s.months.length;m++){const x=this.timelineManager.months[m],k=e(x.#r)+o;e(x.#r)!==k&&f(x.#r,k)}if(!s.viewportTopMonthIntersection)return;const{month:u,monthBottomViewportRatio:p,viewportTopRatioInMonth:S}=s.viewportTopMonthIntersection,n=u?s.months.indexOf(u):-1;if(!(!u||n<=0||i>n)){if(i<n||p<1)s.scrollBy(o);else if(i===n){const m=this.top+t*S;s.scrollTo(m)}}}get height(){return e(this.#e)}get top(){return e(this.#r)+this.timelineManager.topSectionHeight}#h(t){const s=_s(Ye);Hs(t,s("errors.failed_to_load_assets"))}findDayGroupForAsset(t){for(const s of this.dayGroups)if(s.viewerAssets.some(i=>i.id===t.id))return s}findDayGroupByDay(t){return this.dayGroups.find(s=>s.day===t)}findAssetAbsolutePosition(t){this.timelineManager.clearDeferredLayout(this);for(const s of this.dayGroups){const i=s.viewerAssets.find(o=>o.id===t);if(i){if(!i.position){console.warn("No position for asset");return}return{top:this.top+s.top+i.position.top+this.timelineManager.headerHeight,height:i.position.height}}}}*assetsIterator(t){const s=t?.direction??"earlier";let{startAsset:i}=t??{};const o=s==="earlier";let a=t?.startDayGroup?this.dayGroups.indexOf(t.startDayGroup):o?0:this.dayGroups.length-1;for(;a>=0&&a<this.dayGroups.length;)yield*this.dayGroups[a].assetsIterator({startAsset:i,direction:s}),i=void 0,a+=o?1:-1}findAssetById(t){for(const s of this.assetsIterator())if(s.id===t.id)return s}findClosest(t){const s=ss(t);let i,o=1/0;for(const a of this.assetsIterator()){const u=ss(a.localDateTime),p=Math.abs(s.diff(u).as("milliseconds"));p<o&&(o=p,i=a)}return i}cancel(){this.loader?.cancel()}}class be extends Ci{#t=y(60);get bottomSectionHeight(){return e(this.#t)}set bottomSectionHeight(t){f(this.#t,t,!0)}#o=M(()=>{let t=0;for(const s of this.months)t+=s.height;return t});get bodySectionHeight(){return e(this.#o)}set bodySectionHeight(t){f(this.#o,t)}#i=M(()=>{let t=0;for(const s of this.months)t+=s.assetsCount;return t});get assetCount(){return e(this.#i)}set assetCount(t){f(this.#i,t)}#n=y(!1);get isInitialized(){return e(this.#n)}set isInitialized(t){f(this.#n,t,!0)}isScrollingOnLoad=!1;#e=y(Bt([]));get months(){return e(this.#e)}set months(t){f(this.#e,t,!0)}albumAssets=new Rt;#r=y(Bt([]));get scrubberMonths(){return e(this.#r)}set scrubberMonths(t){f(this.#r,t,!0)}#u=y(0);get scrubberTimelineHeight(){return e(this.#u)}set scrubberTimelineHeight(t){f(this.#u,t,!0)}viewportTopMonthIntersection;#a=M(()=>this.maxScrollPercent<.5);get limitedScroll(){return e(this.#a)}set limitedScroll(t){f(this.#a,t)}initTask=new ws(()=>{this.isInitialized=!0,!(this.#s.albumId||this.#s.personId)&&this.connect()},()=>{this.disconnect(),this.isInitialized=!1},()=>{});static#l={};#c;#s=be.#l;#h=!1;#d=y();#f=new Es("album-show-asset-owners",!1);#m=[];get showAssetOwners(){return this.#f.current}setShowAssetOwners(t){this.#f.current=t}toggleShowAssetOwners(){this.#f.current=!this.#f.current}constructor(){super(),this.#m.push(Be.on({AssetUpdate:t=>this.upsertAssets([It(t)])}))}get scrollTop(){return e(this.#d)?.scrollTop??0}set scrollableElement(t){f(this.#d,t,!0)}scrollTo(t){e(this.#d)?.scrollTo({top:t}),this.updateSlidingWindow()}scrollBy(t){e(this.#d)?.scrollBy(0,t),this.updateSlidingWindow()}async*assetsIterator(t){const s=t?.direction??"earlier";let{startDayGroup:i,startAsset:o}=t??{};for(const a of this.monthGroupIterator({direction:s,startMonthGroup:t?.startMonthGroup}))await this.loadMonthGroup(a.yearMonth,{cancelable:!1}),yield*a.assetsIterator({startDayGroup:i,startAsset:o,direction:s}),i=o=void 0}*monthGroupIterator(t){const s=t?.direction==="earlier";let i=t?.startMonthGroup?this.months.indexOf(t.startMonthGroup):s?0:this.months.length-1;for(;i>=0&&i<this.months.length;)yield this.months[i],i+=s?1:-1}connect(){if(this.#c)throw new Error("TimelineManager already connected");this.#c=new Ni(this),this.#c.connectWebsocketEvents()}disconnect(){this.#c&&(this.#c.disconnectWebsocketEvents(),this.#c=void 0)}#p(t){if(!t)return 0;const s=this.visibleWindow.bottom-this.visibleWindow.top,o=t.top+t.height-this.visibleWindow.top;return Re(o/s,0,1)}#v(t){return t?Re((this.visibleWindow.top-t.top)/t.height,0,1):0}updateIntersections(){if(this.#h||!this.isInitialized||this.visibleWindow.bottom===this.visibleWindow.top)return;this.#h=!0;for(const o of this.months)Ei(this,o);const t=this.months.find(o=>o.actuallyIntersecting),s=this.#v(t),i=this.#p(t);this.viewportTopMonthIntersection={month:t,monthBottomViewportRatio:i,viewportTopRatioInMonth:s},this.#h=!1}clearDeferredLayout(t){if(t.dayGroups.some(i=>i.deferredLayout)){Pt(this,t,{invalidateHeight:!0,noDefer:!0});for(const i of t.dayGroups)i.deferredLayout=!1}}async#y(){const t=await qs({...Vt.params,...this.#s});this.months=t.map(s=>{const i=new Ks(s.timeBucket);return new ns(this,{year:i.getUTCFullYear(),month:i.getUTCMonth()+1},s.count,!1,this.#s.order)}),this.albumAssets.clear(),this.updateViewportGeometry(!1)}async updateOptions(t){t.deferInit||this.#s!==be.#l&&xi(this.#s,t)||(await this.initTask.reset(),await this.#g(t),this.updateViewportGeometry(!1),this.#b())}async#g(t){this.isInitialized=!1,this.months=[],this.albumAssets.clear(),await this.initTask.execute(async()=>{this.#s=t,await this.#y()},!0)}destroy(){this.disconnect(),this.isInitialized=!1;for(const t of this.#m)t();super.destroy()}async updateViewport(t){if(t.height===0&&t.width===0||this.viewportHeight===t.height&&this.viewportWidth===t.width)return;this.initTask.executed||await(this.initTask.loading?this.initTask.waitUntilCompletion():this.#g(this.#s));const s=t.width!==this.viewportWidth;this.viewportHeight=t.height,this.viewportWidth=t.width,this.updateViewportGeometry(s)}updateViewportGeometry(t){if(!(!this.isInitialized||this.hasEmptyViewport)){for(const s of this.months)Pt(this,s,{invalidateHeight:t});this.updateIntersections(),t&&this.#b()}}#b(){this.scrubberMonths=this.months.map(t=>({assetCount:t.assetsCount,year:t.yearMonth.year,month:t.yearMonth.month,title:t.monthGroupTitle,height:t.height})),this.scrubberTimelineHeight=this.totalViewerHeight}async loadMonthGroup(t,s){let i=!0;s&&(i=s.cancelable);const o=Oe(this,t);if(!o||o.loader?.executed)return;await o.loader?.execute(async u=>{await Li(this,o,this.#s,u)},i)==="LOADED"&&(Pt(this,o,{invalidateHeight:!1}),this.updateIntersections())}upsertAssets(t){const i=this.#S(t).filter(o=>!this.isExcluded(o));this.addAssetsUpsertSegments([...i])}async findMonthGroupForAsset(t){this.isInitialized||await this.initTask.waitUntilExecution();const{id:s}=t;let{monthGroup:i}=we(this,s)??{};if(i)return i;const o=ri(t)?t:await fs({...Vt.params,id:s}).catch(()=>null);if(!o)return;const a=It(o);if(!this.isExcluded(a)&&(i=await this.#A(a.localDateTime,{cancelable:!1}),i?.findAssetById({id:s})))return i}async#A(t,s){return await this.loadMonthGroup(t,s),Oe(this,t)}getMonthGroupByAssetId(t){return we(this,t)?.monthGroup}async getRandomAsset(t){const s=t??Math.floor(Math.random()*this.assetCount);let i=0,o;for(const u of this.months){if(s<i+u.assetsCount){o=u;break}i+=u.assetsCount}if(!o)return;await this.loadMonthGroup(o.yearMonth,{cancelable:!1});let a;for(const u of o.dayGroups){if(s<i+u.viewerAssets.length){a=u;break}i+=u.viewerAssets.length}if(a)return a.viewerAssets[s-i].asset}update(t,s){return this.#w(new Set(t),s)}removeAssets(t){return[...this.#w(new Set(t),()=>({remove:!0})).notUpdated]}upsertSegmentForAsset(t){let s=Oe(this,t.localDateTime);return s||(s=new ns(this,t.localDateTime,1,!0,this.#s.order),this.months.push(s)),s}addAssetsUpsertSegments(t){if(t.length===0)return;const s=new bs,i=this.months.length;for(const o of t)this.upsertSegmentForAsset(o).addTimelineAsset(o,s);this.months.length!==i&&this.postCreateSegments(),this.postUpsert(s)}#S(t){const s=new Map(t.map(u=>[u.id,u])),i=new Set(s.keys()),o=this.#w(i,u=>{Ts(u,s.get(u.id))}),a=[];for(const u of o.notUpdated)a.push(s.get(u));return a}#w(t,s){if(t.size===0)return{updated:new Set,notUpdated:t,changedGeometry:!1};const i=new Set;let o=new Set(t);const a=new Set,u=[];for(const n of this.months){if(o.size===0)break;const m=n.runAssetCallback(o,s);m.moveAssets.length>0&&u.push(m.moveAssets),m.changedGeometry&&i.add(n),o=Ne(o,m.processedIds);for(const x of m.processedIds)a.add(x)}const p=[];for(const n of u)for(const m of n)p.push(m.asset);this.addAssetsUpsertSegments(p);const S=i.size>0;for(const n of i)Pt(this,n,{invalidateHeight:!0});return S&&this.updateIntersections(),{updated:a,notUpdated:o,changedGeometry:S}}refreshLayout(){for(const t of this.months)Pt(this,t,{invalidateHeight:!0});this.updateIntersections()}getFirstAsset(){return this.months[0]?.getFirstAsset()}async getLaterAsset(t,s="asset"){return await rs(this,t,s,"later")}async getEarlierAsset(t,s="asset"){return await rs(this,t,s,"earlier")}async getClosestAssetToDate(t){let s=Ui(this,t);if(!s&&(s=zi(this.months,t),!s))return;await this.loadMonthGroup(t,{cancelable:!1});const i=s.findClosest(t);if(i)return i;for await(const o of this.assetsIterator({startMonthGroup:s}))return o}async retrieveRange(t,s){return Vi(this,t,s)}isExcluded(t){return Pe(this.#s.visibility,t.visibility)||Pe(this.#s.isFavorite,t.isFavorite)||Pe(this.#s.isTrashed,t.isTrashed)}getAssetOrder(){return this.#s.order??Gt.Desc}postCreateSegments(){this.months.sort((t,s)=>t.yearMonth.year===s.yearMonth.year?s.yearMonth.month-t.yearMonth.month:s.yearMonth.year-t.yearMonth.year)}postUpsert(t){for(const s of t.existingDayGroups)s.sortAssets(this.#s.order);for(const s of t.bucketsWithNewDayGroups)s.sortDayGroups();for(const s of t.updatedBuckets)s.sortDayGroups(),Pt(this,s,{invalidateHeight:!0});this.updateIntersections()}}var ji=N('<div class="absolute"><!> <!></div>'),qi=N('<div data-image-grid="" class="relative overflow-clip svelte-yrxz8a"></div>');function Xi(l,t){Dt(t,!0);const s=()=>ft(a,"$isUploading",i),[i,o]=Ut();let{isUploading:a}=ds;const u=M(()=>t.manager.suspendTransitions&&!s()?0:150),p=M(()=>e(u)===0?0:e(u)+100),S=x=>x.filter(({intersecting:k})=>k);var n=qi();let m;Ae(n,29,()=>S(t.viewerAssets),x=>x.id,(x,k)=>{const G=M(()=>e(k).position),A=M(()=>e(k).asset);var E=ji();let Y;var tt=z(E);ie(tt,()=>t.thumbnail,()=>({asset:e(A),position:e(G)}));var R=J(tt,2);ie(R,()=>t.customThumbnailLayout??Le,()=>e(A)),V(E),$(()=>{pt(E,"data-asset-id",e(A).id),Y=Z(E,"",Y,{top:e(G).top+"px",left:e(G).left+"px",width:e(G).width+"px",height:e(G).height+"px"})}),Lt(6,E,()=>Os,()=>({start:.1,duration:e(p)})),Ps(E,()=>js,()=>({duration:e(u)})),C(x,E)}),V(n),$(()=>m=Z(n,"",m,{height:t.height+"px",width:t.width+"px"})),C(l,n),_t(),o()}const Ue=l=>l.map(t=>ai(t));var Qi=N("<div><!></div>"),Ji=N('<section data-group=""><div class="flex pt-7 pb-5 max-md:pt-5 max-md:pb-3 h-6 place-items-center text-xs font-medium text-immich-fg dark:text-immich-dark-fg md:text-sm"><!> <span class="w-full truncate first-letter:capitalize"> </span></div> <!></section>');function Zi(l,t){Dt(t,!0);const s=()=>ft(a,"$isUploading",i),[i,o]=Ut();let{isUploading:a}=ds,u=y(null);const p=M(()=>e(u)!==null),S=M(()=>t.monthGroup.timelineManager.suspendTransitions&&!s()?0:150),n=G=>G.filter(({intersecting:A})=>A),m=G=>{const{month:A,year:E}=G.monthGroup.yearMonth,Y=vs({year:E,month:A,day:G.day});return ni(Y)};var x=kt(),k=yt(x);Ae(k,19,()=>n(t.monthGroup.dayGroups),G=>G.day,(G,A,E)=>{const Y=M(()=>e(A).left),tt=M(()=>t.assetInteraction.selectedGroup.has(e(A).groupTitle));var R=Ji();let K;var j=z(R);let O;var it=z(j);{var w=L=>{var U=Qi();let lt;U.__click=()=>t.onDayGroupSelect(e(A),Ue(e(A).getAssets())),U.__keydown=()=>t.onDayGroupSelect(e(A),Ue(e(A).getAssets()));var wt=z(U);{var ct=B=>{ve(B,{get icon(){return Ls},size:"24",class:"text-primary"})},ut=B=>{ve(B,{get icon(){return Ws},size:"24",color:"#757575"})};st(wt,B=>{e(tt)?B(ct):B(ut,!1)})}V(U),$(B=>lt=Ht(U,1,"hover:cursor-pointer transition-all duration-200 ease-out overflow-hidden w-0",null,lt,B),[()=>({"w-8":e(u)===e(A).groupTitle&&e(p)||t.assetInteraction.selectedGroup.has(e(A).groupTitle)})]),C(L,U)};st(it,L=>{t.singleSelect||L(w)})}var P=J(it,2),v=z(P,!0);V(P),V(j);var I=J(j,2);Xi(I,{get manager(){return t.manager},get viewerAssets(){return e(A).viewerAssets},get height(){return e(A).height},get width(){return e(A).width},get customThumbnailLayout(){return t.customThumbnailLayout},thumbnail:(U,lt)=>{let wt=()=>lt?.().asset,ct=()=>lt?.().position;var ut=kt(),B=yt(ut);ie(B,()=>t.thumbnail,()=>({asset:wt(),position:ct(),dayGroup:e(A),groupIndex:e(E)})),C(U,ut)},$$slots:{thumbnail:!0}}),V(R),$(L=>{Ht(R,1,Se([{"transition-all":!t.monthGroup.timelineManager.suspendTransitions},!t.monthGroup.timelineManager.suspendTransitions&&`delay-${e(S)}`]),"svelte-19t4ggy"),K=Z(R,"",K,{position:"absolute",transform:`translate3d(${e(Y)}px,${e(A).top}px,0)`}),O=Z(j,"",O,{width:e(A).width+"px"}),pt(P,"title",L),xt(v,e(A).groupTitle)},[()=>m(e(A))]),at("mouseenter",R,()=>f(u,e(A).groupTitle,!0)),at("mouseleave",R,()=>f(u,null)),C(G,R)}),C(l,x),_t(),o()}ls(["click","keydown"]);var $i=N('<div id="time-label"> </div>'),to=N('<p class="truncate pointer-events-none absolute text-sm rounded-full w-8 py-2 px-4 text-white bg-immich-primary/90 dark:bg-gray-500 hover:cursor-pointer select-none font-semibold"> </p>'),eo=N('<div id="time-label" class="rounded-s-full w-8 ps-2 text-white bg-immich-primary dark:bg-gray-600 hover:cursor-pointer select-none"><!> <!> <!></div>'),so=N('<p class="truncate pointer-events-none absolute end-0 bottom-0 min-w-20 max-w-64 w-fit rounded-tl-md border-b-2 border-immich-primary bg-subtle/90 z-1 py-1 px-1 text-sm font-medium shadow-[0_0_8px_rgba(0,0,0,0.25)] dark:border-immich-dark-primary dark:text-immich-dark-fg"> </p>'),io=N('<div class="absolute end-0 h-0.5 w-10 bg-primary"><!></div>'),oo=N('<div class="absolute end-5 text-[13px] dark:text-immich-dark-fg font-mono bottom-0"> </div>'),ro=N('<div class="absolute end-3 bottom-0 h-1 w-1 rounded-full bg-gray-300"></div>'),no=N("<!> <!>",1),ao=N('<div class="relative" data-id="time-segment"><!></div>'),lo=N('<div tabindex="0" role="scrollbar" aria-controls="time-label" data-id="scrubber" class="absolute end-0 z-1 select-none hover:cursor-row-resize" draggable="false"><!> <!> <!> <div class="relative" data-id="lead-in"></div> <!> <div data-id="lead-out" class="relative"></div></div>');function co(l,t){Dt(t,!0);let s=W(t,"timelineTopOffset",3,0),i=W(t,"timelineBottomOffset",3,0),o=W(t,"height",3,0),a=W(t,"timelineScrollPercent",3,0),u=W(t,"viewportTopMonthScrollPercent",3,0),p=W(t,"viewportTopMonth",3,void 0),S=W(t,"onScrub",3,void 0),n=W(t,"onScrubKeyDown",3,void 0),m=W(t,"startScrub",3,void 0),x=W(t,"stopScrub",3,void 0),k=W(t,"scrubberWidth",15),G=y(!1),A=y(!1),E=y(!1),Y=y(!1),tt=y(0),R=0,K=y(0),j=y(void 0);const O=h=>h*(o()-(e(L)+e(U))),it=h=>h/(o()-(e(L)+e(U))),w=M(()=>Fe.pointerCoarse),P=20,v=60,I=31.75,L=M(()=>e(w)?25:I),U=M(()=>e(w)?25:10),lt=16,wt=8,ct=M(()=>e(A)?"100vw":e(w)?t.timelineManager.scrolling?P+"px":"0px":v+"px");vt(()=>{k(e(w)?P:v)});const ut=(h,r,c)=>{if(h==="lead-in")return e(ht)*r;if(h==="lead-out"){let d=e(ht);for(const g of e(q))d+=g.height;return d+e(Nt)*r}else if(h){let d=e(ht),g=!1;for(const b of e(q)){if(b.month===h.month&&b.year===h.year){d+=r*b.height,g=!0;break}d+=b.height}return g||(d+=r*e(Nt)),d}else return c*(o()-(e(L)+e(U)))},B=M(()=>ut(p(),u(),a())),zt=M(()=>t.timelineManager.scrubberTimelineHeight),ht=M(()=>O(s()/e(zt))),Nt=M(()=>O(i()/e(zt))),Te=h=>{let r=0,c=0,d=[],g,b=0;const T=[...h].reverse();for(const D of T){const H=D.height/e(zt),_={top:b,count:D.assetCount,height:O(H),dateFormatted:D.title,year:D.year,month:D.month,hasLabel:!1,hasDot:!1};b+=_.height,g?(g.year!==_.year&&r>lt&&(r=0,_.hasLabel=!0,g=_),_.height>5&&c>wt&&(_.hasDot=!0,c=0)):(_.hasDot=!0,_.hasLabel=!0,g=_),r+=_.height,c+=_.height,d.push(_)}return d.reverse(),d};let mt=y(void 0);const q=M(()=>Te(t.timelineManager.scrubberMonths)),Yt=M(()=>e(E)?e(q).at(0)?.dateFormatted:e(Y)?e(q).at(-1)?.dateFormatted:e(mt)?.dataset.label),Ct=M(()=>{if(e(mt)?.dataset.id==="lead-in")return"lead-in";if(e(mt)?.dataset.id==="lead-out")return"lead-out";if(!e(mt)?.dataset.segmentYearMonth)return;const[h,r]=e(mt).dataset.segmentYearMonth.split("-").map(Number);return{year:h,month:r}}),gt=M(()=>{const h=e(B);let r=e(ht);for(const c of e(q)){if(h<r+c.height)return c;r+=c.height}return null}),rt=M(()=>{if(e(B)!==void 0){if(e(B)<e(ht))return e(q).at(0)?.dateFormatted;{let h=e(ht);for(const r of e(q))h+=r.height;if(e(B)>h)return e(q).at(-1)?.dateFormatted}}return e(gt)?.dateFormatted||""}),Kt=(h,r,...c)=>{if(c.length===0)return;const d=h.filter(b=>b instanceof HTMLElement&&b.dataset.id?c.includes(b.dataset.id):!1),g=[];for(const b of d){const T=b.getBoundingClientRect();if(T.y>r){g.push({element:b,boundingClientRect:T});continue}if(r<=T.y+T.height)return{element:b,boundingClientRect:T}}return g.at(0)},Me=(h,r)=>{const c=document.elementsFromPoint(h,r),d=Kt(c,r,"time-segment","lead-in","lead-out");if(d){const D=d.element,H=d.boundingClientRect,_=H.y,X=(r-_)/H.height;return{isOnPaddingTop:!1,isOnPaddingBottom:!1,segment:D,monthGroupPercentY:X}}const g=Kt(c,0,"scrubber");let b=!1,T=!1;if(g){const D=g.boundingClientRect;r<D.top+e(L)&&(b=!0),r>D.bottom-e(U)-1&&(T=!0)}return{isOnPaddingTop:b,isOnPaddingBottom:T,segment:void 0,monthGroupPercentY:0}},At=h=>{const r=e(A);if(f(A,h.isDragging??e(A),!0),R=h.clientY,!e(j))return;const c=e(j).getBoundingClientRect(),d=0,g=c?.height-(e(L)+e(U));f(tt,Re(R-c?.top-e(L),d,g),!0);const b=c.left+c.width/2,{segment:T,monthGroupPercentY:D,isOnPaddingTop:H,isOnPaddingBottom:_}=Me(b,R);f(mt,T,!0),f(E,H,!0),f(Y,_,!0);const F={scrubberMonth:e(Ct),overallScrollPercent:it(e(tt)),scrubberMonthScrollPercent:D};if(r===!1&&e(A)&&(m()?.(F),S()?.(F)),r&&!e(A)){x()?.(F);return}e(A)&&S()?.(F)},re=h=>h.touches.length===1?h.touches[0]:null,jt=h=>{const r=re(h);if(!r){f(G,!1);return}const c=document.elementsFromPoint(r.clientX,r.clientY),d=Kt(c,0,"scrubber","time-label","lead-in","lead-out")!==void 0;f(G,d),d&&At({clientY:r.clientY,isDragging:!0})},qt=()=>{e(G)&&f(G,!1),At({clientY:R,isDragging:!1})},Xt=h=>{const r=re(h);r&&e(A)?At({clientY:r.clientY}):f(G,!1)};se(()=>(document.addEventListener("touchmove",Xt,{capture:!0,passive:!0}),()=>{document.removeEventListener("touchmove",Xt,!0)})),se(()=>(document.addEventListener("touchstart",jt,{capture:!0,passive:!0}),document.addEventListener("touchend",qt,{capture:!0,passive:!0}),()=>{document.removeEventListener("touchstart",jt,!0),document.removeEventListener("touchend",qt,!0)}));const Et=h=>h?.key==="Tab",Ie=h=>Et(h)&&!h.shiftKey,ne=h=>Et(h)&&h.shiftKey,ae=h=>h?.key==="ArrowUp",le=h=>h?.key==="ArrowDown",ce=h=>{const r=Ie(h),c=ne(h);if(r||c){h.preventDefault();const d=ci(document.body);if(e(j)){const g=d.indexOf(e(j));if(g!==-1){let b;b=r?d[(g+1)%d.length]:d[(g-1)%d.length],b.focus()}}}},Ge=h=>{if(Et(h))return ce(h),!0;if(ae(h)){let r;if(e(gt)){const c=e(q).indexOf(e(gt));r=c===-1?e(q).at(-2):e(q)[c-1]}else r=e(q).at(-2);if(r)return h.preventDefault(),S()?.({scrubberMonth:{year:r.year,month:r.month},overallScrollPercent:-1,scrubberMonthScrollPercent:0}),!0}if(le(h)&&e(gt)){const r=e(q).indexOf(e(gt));if(r!==-1){const c=e(q)[r+1];if(c)return h.preventDefault(),S()?.({scrubberMonth:{year:c.year,month:c.month},overallScrollPercent:-1,scrubberMonthScrollPercent:0}),!0}}return!1},dt=h=>{Ge(h)||n()?.(h,h.currentTarget)};var et=lo();at("mousemove",_e,({clientY:h})=>(e(A)||e(G))&&At({clientY:h})),at("mousedown",_e,({clientY:h})=>e(G)&&At({clientY:h,isDragging:!0})),at("mouseup",_e,({clientY:h})=>At({clientY:h,isDragging:!1})),et.__keydown=dt;let St;var Qt=z(et);{var ue=h=>{var r=$i();let c;var d=z(r,!0);V(r),$(()=>{Ht(r,1,Se([{"border-b-2":e(A)},{"rounded-bl-md":!e(A)},"bg-light truncate opacity-85 pointer-events-none absolute end-0 min-w-20 max-w-64 w-fit rounded-ss-md border-b-2 border-primary py-1 px-1 text-sm font-medium shadow-[0_0_8px_rgba(0,0,0,0.25)] z-1"])),c=Z(r,"",c,{top:`${e(tt)+2}px`}),xt(d,e(Yt))}),C(h,r)};st(Qt,h=>{!e(w)&&e(Yt)&&(e(G)||e(A))&&h(ue)})}var bt=J(Qt,2);{var he=h=>{var r=eo();let c;var d=z(r);ve(d,{get icon(){return Qe},size:"20",class:"-rotate-90 relative top-2.25 -end-0.5"});var g=J(d,2);ve(g,{get icon(){return Qe},size:"20",class:"rotate-90 relative top-px -end-0.5"});var b=J(g,2);{var T=D=>{var H=to();Z(H,"",{},{bottom:"10px",right:"36px",width:"fit-content"});var _=z(H,!0);V(H),$(()=>xt(_,e(rt))),Lt(3,H,()=>me,()=>({duration:200})),C(D,H)};st(b,D=>{(t.timelineManager.scrolling&&e(rt)||e(G)||e(A))&&D(T)})}V(r),$(()=>c=Z(r,"",c,{top:`${e(L)+(e(B)-25)}px`,height:"50px",right:"0",position:"absolute"})),Lt(1,r,()=>me,()=>({duration:200})),Lt(2,r,()=>me,()=>({duration:200})),C(h,r)};st(bt,h=>{e(w)&&(t.timelineManager.scrolling&&e(rt)||e(G)||e(A))&&h(he)})}var Jt=J(bt,2);{var De=h=>{var r=io();let c;var d=z(r);{var g=b=>{var T=so(),D=z(T,!0);V(T),$(()=>xt(D,e(rt))),Lt(3,T,()=>me,()=>({duration:200})),C(b,T)};st(d,b=>{t.timelineManager.scrolling&&e(rt)&&!e(G)&&b(g)})}V(r),$(()=>c=Z(r,"",c,{top:`${e(B)+e(L)-2}px`})),C(h,r)};st(Jt,h=>{!e(w)&&!e(A)&&h(De)})}var Zt=J(Jt,2);let $t;var de=J(Zt,2);Ae(de,17,()=>e(q),h=>h.year+"-"+h.month,(h,r)=>{var c=ao();let d;var g=z(c);{var b=T=>{var D=no(),H=yt(D);{var _=Q=>{var ot=oo(),Tt=z(ot,!0);V(ot),$(()=>xt(Tt,e(r).year)),C(Q,ot)};st(H,Q=>{e(r).hasLabel&&Q(_)})}var F=J(H,2);{var X=Q=>{var ot=ro();C(Q,ot)};st(F,Q=>{e(r).hasDot&&Q(X)})}C(T,D)};st(g,T=>{e(w)||T(b)})}V(c),$(()=>{pt(c,"data-segment-year-month",e(r).year+"-"+e(r).month),pt(c,"data-label",e(r).dateFormatted),d=Z(c,"",d,{height:e(r).height+"px"})}),C(h,c)});var te=J(de,2);let fe;V(et),We(et,h=>f(j,h),()=>e(j)),$((h,r,c,d)=>{pt(et,"aria-valuetext",e(Yt)),pt(et,"aria-valuenow",e(B)+e(L)),pt(et,"aria-valuemax",h),pt(et,"aria-valuemin",r),St=Z(et,"",St,{"padding-top":e(L)+"px","padding-bottom":e(U)+"px",width:e(ct),height:o()+"px","background-color":(e(A),"transparent")}),pt(Zt,"data-label",c),$t=Z(Zt,"",$t,{height:e(ht)+"px"}),pt(te,"data-label",d),fe=Z(te,"",fe,{height:e(Nt)+"px"})},[()=>O(1),()=>O(0),()=>e(q).at(0)?.dateFormatted,()=>e(q).at(-1)?.dateFormatted]),li("innerHeight",h=>f(K,h,!0)),at("mouseenter",et,()=>f(G,!0)),at("mouseleave",et,()=>f(G,!1)),Lt(3,et,()=>Fs,()=>({x:50,duration:250})),C(l,et),_t()}ls(["keydown"]);function uo(l,t){Dt(t,!0);const s=()=>ft(Ye,"$t",a),i=()=>ft(p,"$viewingAsset",a),o=()=>ft(S,"$gridScrollTarget",a),[a,u]=Ut();let{asset:p,gridScrollTarget:S}=ye,n=W(t,"invisible",15,!1),m=W(t,"withStacked",3,!1),x=W(t,"isShared",3,!1);const k=v=>Cs(()=>xe.getAsset({...Vt.params,id:v}),s()("error_retrieving_asset_information")),G=async v=>{const I=await t.timelineManager.getEarlierAsset(v);if(I)return k(I.id)},A=async v=>{const I=await t.timelineManager.getLaterAsset(v);if(I)return k(I.id)};let E=y(Bt({current:i(),previousAsset:void 0,nextAsset:void 0}));const Y=async v=>{const[I,L]=await Promise.all([G(v),A(v)]);f(E,{current:v,nextAsset:I,previousAsset:L},!0)};vt(()=>{i(),xs(()=>ms(Y(i())))});const tt=async()=>{const v=await t.timelineManager.getRandomAsset();if(v)return await ge({targetRoute:"current",assetId:v.id}),{id:v.id}},R=async v=>{n(!0),hs(S,{at:v.id}),await ge({targetRoute:"current",assetId:null,assetGridRouteSearchParams:o()})},K=async v=>{switch(v.type){case t.removeAction:case nt.TRASH:case nt.RESTORE:case nt.DELETE:case nt.ARCHIVE:case nt.SET_VISIBILITY_LOCKED:case nt.SET_VISIBILITY_TIMELINE:{t.timelineManager.removeAssets([v.asset.id]),await es(e(E)?.nextAsset)||await es(e(E)?.previousAsset)||await R(v.asset);break}}},j=v=>{switch(v.type){case nt.ARCHIVE:case nt.UNARCHIVE:case nt.ADD:{t.timelineManager.upsertAssets([v.asset]);break}case nt.STACK:{pe(t.timelineManager,{stack:v.stack,toDeleteIds:v.stack.assets.filter(I=>I.id!==v.stack.primaryAssetId).map(I=>I.id)});break}case nt.UNSTACK:{Ce(t.timelineManager,v.assets);break}case nt.REMOVE_ASSET_FROM_STACK:{t.timelineManager.upsertAssets([It(v.asset)]),v.stack&&(Ce(t.timelineManager,v.stack.assets.map(I=>It(I))),pe(t.timelineManager,{stack:v.stack,toDeleteIds:v.stack.assets.filter(I=>I.id!==v.stack?.primaryAssetId).map(I=>I.id)}));break}case nt.SET_STACK_PRIMARY_ASSET:{Ce(t.timelineManager,v.stack.assets.map(I=>It(I))),pe(t.timelineManager,{stack:v.stack,toDeleteIds:v.stack.assets.filter(I=>I.id!==v.stack.primaryAssetId).map(I=>I.id)});break}}},O=async v=>{if(t.timelineManager.upsertAssets(v),v.length===0)return;const I=v[0],L=await fs({...Vt.params,id:I.id});ye.setAsset(L),await ge({targetRoute:"current",assetId:I.id})},it=v=>{v.id===e(E).current.id&&Y(v)};se(()=>{const v=[Ft.on("on_upload_success",I=>it(I)),Ft.on("on_asset_update",I=>it(I))];return()=>{for(const I of v)I()}}),ze(()=>{xe.invalidate()});var w=kt(),P=yt(w);vi(P,()=>pi(()=>import("./BEfn6cqG.js").then(v=>v.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96])),null,(v,I)=>{var L=M(()=>{var{default:ct}=e(I);return{AssetViewer:ct}}),U=M(()=>e(L).AssetViewer),lt=kt(),wt=yt(lt);Bs(wt,()=>e(U),(ct,ut)=>{ut(ct,{get withStacked(){return m()},get cursor(){return e(E)},get isShared(){return x()},get album(){return t.album},get person(){return t.person},onAssetChange:B=>{t.timelineManager?.upsertAssets([It(B)])},preAction:K,onAction:B=>{j(B),xe.invalidate()},onUndoDelete:O,onRandom:tt,onClose:R})}),C(v,lt)}),C(l,w),_t(),u()}const as=new yi,ho=()=>{const l=document.activeElement;if(l&&l.dataset.thumbnailFocusContainer!==void 0)return l},fo=()=>ys(l=>l.dataset.thumbnailFocusContainer!==void 0,"next"),mo=()=>ys(l=>l.dataset.thumbnailFocusContainer!==void 0,"previous"),go=l=>document.querySelector(l),je=l=>{go(`[data-thumbnail-focus-container][data-asset="${l}"]`)?.focus()},po=(l,t)=>{l(t)&&je(t.id)},vo=async(l,t,s,i)=>{if(as.isActive())return;const o=ho();if(!o)return s==="earlier"?fo():mo();const a=as.startInvocation(),u=o.dataset.asset;if(!o||!u){a.endInvocation();return}const p=s==="earlier"?await t.getEarlierAsset({id:u},i):await t.getLaterAsset({id:u},i);if(!a.isStillValid())return;if(!p){a.endInvocation();return}if(l(p)){if(await cs(),!a.isStillValid())return;je(p.id)}a.endInvocation()};var yo=N('<label class="immich-form-label" for="datetime"> </label>'),wo=N("<!> <!>",1);function bo(l,t){Dt(t,!0);const s=()=>ft(Ye,"$t",i),[i,o]=Ut(),a=oe.now();let u=y(Bt(a.toFormat("yyyy-MM-dd'T'HH:mm:ss.SSS")));const p=M(()=>fi(e(u)));let S=M(()=>di(a,void 0,e(p)));const n=async()=>{if(!e(m).isValid||!e(S)){t.onClose();return}const x=hi(e(u),e(S)),k=await t.timelineManager.getClosestAssetToDate(x.toObject());t.onClose(k)},m=M(()=>oe.fromISO(e(u),{zone:e(S)?.value,setZone:!0}));{let x=M(()=>s()("navigate_to_time")),k=M(()=>s()("confirm")),G=M(()=>!e(m).isValid||!e(S));Ai(l,{get title(){return e(x)},get icon(){return Rs},onClose:()=>t.onClose(),onSubmit:n,get submitText(){return e(k)},get disabled(){return e(G)},size:"medium",children:(A,E)=>{Si(A,{fullWidth:!0,children:(Y,tt)=>{var R=wo(),K=yt(R);is(K,{fullWidth:!0,children:(O,it)=>{var w=yo(),P=z(w,!0);V(w),$(v=>xt(P,v),[()=>s()("date_and_time")]),C(O,w)},$$slots:{default:!0}});var j=J(K,2);is(j,{fullWidth:!0,children:(O,it)=>{bi(O,{class:"immich-form-input text-gray-700 w-full",id:"datetime",type:"datetime-local",get value(){return e(u)},set value(w){f(u,w,!0)}})},$$slots:{default:!0}}),C(Y,R)},$$slots:{default:!0}})},$$slots:{default:!0}})}_t(),o()}function Ao(l,t){Dt(t,!0);const s=()=>ft(ti,"$showDeleteModal",o),i=()=>ft(u,"$showAssetViewer",o),[o,a]=Ut(),{isViewing:u}=ye,p=async w=>{const P=w||!wi.value.trash,v=t.assetInteraction.selectedAssets;s()&&P&&!await Ee.show(mi,{size:v.length})||(await gi(P,I=>{t.timelineManager.removeAssets(I),Be.emit("AssetsDelete",I)},v,P?void 0:I=>t.timelineManager.upsertAssets(I)),t.assetInteraction.clearMultiselect())},S=()=>{const w=t.assetInteraction.selectedAssets.some(P=>P.isTrashed);ms(p(w))},n=async()=>{const w=await Zs(t.assetInteraction.selectedAssets);pe(t.timelineManager,w),t.onEscape?.()},m=async()=>{const w=t.assetInteraction.isAllArchived?ts.Timeline:ts.Archive,P=await $s(t.assetInteraction.selectedAssets,w);t.timelineManager.update(P,v=>v.visibility=w),Be.emit("AssetsArchive",P),k()};let x=y(!1);const k=()=>{Js(t.assetInteraction)},G=w=>{He.isSearchEnabled||w.key==="Shift"&&(w.preventDefault(),f(x,!0))},A=w=>{He.isSearchEnabled||w.key==="Shift"&&(w.preventDefault(),f(x,!1))},E=w=>{t.assetInteraction.selectionActive&&e(x)&&w.preventDefault()},Y=M(()=>t.timelineManager.isInitialized&&t.timelineManager.months.length===0);let tt=!1;const R=async()=>{tt||(tt=!0,await Ee.show(Mi,{}),tt=!1)};vt(()=>{e(Y)&&t.assetInteraction.clearMultiselect()});const K=vo.bind(void 0,t.scrollToAsset,t.timelineManager),j=po.bind(void 0,t.scrollToAsset),O=async()=>{const w=await Ee.show(bo,{timelineManager:t.timelineManager});w&&j(w)},it=M(()=>{if(He.isSearchEnabled||i()||Ti())return[];const w=[{shortcut:{key:"?",shift:!0},onShortcut:R},{shortcut:{key:"/"},onShortcut:()=>Vs(Gi.explore())},{shortcut:{key:"A",ctrl:!0},onShortcut:()=>Qs(t.timelineManager,t.assetInteraction)},{shortcut:{key:"ArrowRight"},onShortcut:()=>K("earlier","asset")},{shortcut:{key:"ArrowLeft"},onShortcut:()=>K("later","asset")},{shortcut:{key:"D"},onShortcut:()=>K("earlier","day")},{shortcut:{key:"D",shift:!0},onShortcut:()=>K("later","day")},{shortcut:{key:"M"},onShortcut:()=>K("earlier","month")},{shortcut:{key:"M",shift:!0},onShortcut:()=>K("later","month")},{shortcut:{key:"Y"},onShortcut:()=>K("earlier","year")},{shortcut:{key:"Y",shift:!0},onShortcut:()=>K("later","year")},{shortcut:{key:"G"},onShortcut:O}];return t.onEscape&&w.push({shortcut:{key:"Escape"},onShortcut:t.onEscape}),t.assetInteraction.selectionActive&&w.push({shortcut:{key:"Delete"},onShortcut:S},{shortcut:{key:"Delete",shift:!0},onShortcut:()=>p(!0)},{shortcut:{key:"D",ctrl:!0},onShortcut:()=>k()},{shortcut:{key:"s"},onShortcut:()=>n()},{shortcut:{key:"a",shift:!0},onShortcut:m}),w});at("keydown",Wt,G),at("keyup",Wt,A),at("selectstart",Wt,E),us(Wt,(w,P)=>Di?.(w,P),()=>e(it)),_t(),a()}function So(l,t){Dt(t,!0);const s=[];se(()=>{}),ze(()=>{for(const i of s)i()}),_t()}var To=N('<div class="flex pt-7 pb-5 max-md:pt-5 max-md:pb-3 h-6 place-items-center text-xs font-medium text-immich-fg dark:text-immich-dark-fg md:text-sm"> </div>'),Mo=N('<div><!> <div class="animate-pulse h-full w-full svelte-1h33p3s" data-skeleton="true"></div></div>');function Io(l,t){let s=W(t,"height",3,0),i=W(t,"invisible",3,!1);var o=Mo();let a;var u=z(o);{var p=S=>{var n=To(),m=z(n,!0);V(n),$(()=>xt(m,t.title)),C(S,n)};st(u,S=>{t.title&&S(p)})}ks(2),V(o),$(()=>{Ht(o,1,Se(["overflow-clip",{invisible:i()}]),"svelte-1h33p3s"),a=Z(o,"",a,{height:s()+"px"})}),C(l,o)}var Go=N("<div><!></div>"),Do=N('<div class="month-group svelte-bi949n"><!></div>'),_o=N('<!> <!> <!> <section id="asset-grid" tabindex="-1"><section id="virtual-timeline"><section><!> <!></section> <!> <div></div></section></section> <!>',1);function yr(l,t){Dt(t,!0);const s=()=>ft(j,"$gridScrollTarget",a),i=()=>ft(R,"$showAssetViewer",a),o=()=>ft(K,"$viewingAsset",a),[a,u]=Ut();let p=W(t,"isSelectionMode",3,!1),S=W(t,"singleSelect",3,!1),n=W(t,"timelineManager",15),m=W(t,"assetInteraction",7),x=W(t,"removeAction",3,null),k=W(t,"withStacked",3,!1),G=W(t,"showArchiveIcon",3,!1),A=W(t,"isShared",3,!1),E=W(t,"albumUsers",19,()=>[]),Y=W(t,"onSelect",3,()=>{}),tt=W(t,"onEscape",3,()=>{});n(new be),ze(()=>n().destroy()),vt(()=>t.options&&void n().updateOptions(t.options));let{isViewing:R,asset:K,gridScrollTarget:j}=ye,O=y(void 0),it=y(void 0),w=y(!0),P=y(0),v=y(void 0),I=y(0),L=y(0);const U=M(()=>n().isInitialized&&n().months.length===0),lt=M(()=>Fe.maxMd),wt=M(()=>Fe.pointerCoarse);vt(()=>{const r=e(lt)?{rowHeight:100,headerHeight:32}:{rowHeight:235,headerHeight:48};n().setLayoutOptions(r)}),vt(()=>{n(n().scrollableElement=e(O),!0)});const ct=(r,c)=>c.findAssetAbsolutePosition(r),ut=(r,c)=>{const d=ct(r,c);if(!d)return;n().updateSlidingWindow();const g=d.top,b=d.top+d.height,T=n().visibleWindow.top,D=n().visibleWindow.bottom;if(Ke(g,b,T,D))return;const H=e(O)?.scrollTop||0,_=D-T,F=g,X=Math.abs(F-H),Q=b-_,ot=Math.abs(Q-H),Tt=X<ot?F:Q;n().scrollTo(Tt)},B=async r=>{try{n(n().isScrollingOnLoad=!0,!0);const c=await n().findMonthGroupForAsset({id:r});return c?(ut(r,c),!0):!1}finally{n(n().isScrollingOnLoad=!1,!0)}},zt=r=>{const c=n().getMonthGroupByAssetId(r.id);return c?(ut(r.id,c),!0):!1},ht=async()=>{if(n().viewportHeight===0||n().viewportWidth===0){const d=e(O)?.getBoundingClientRect();d&&(n(n().viewportHeight=d.height,!0),n(n().viewportWidth=d.width,!0))}const r=s()?.at;let c=!1;r&&(c=await B(r)),c?r&&(await cs(),je(r)):n().scrollTo(0),f(w,!1)};Us(({from:r,to:c})=>{n(n().suspendTransitions=!0,!0),ke(c),ke(r)}),zs(({complete:r})=>{r.finally(()=>{ke(Ze),ht()})});const Nt=()=>n(n().scrolling=!0,!0),Te=({height:r})=>n(n().topSectionHeight=r,!0);se(()=>{t.enableRouting||f(w,!1)});const mt=(r,c,d)=>{const g=r,b=n().maxScrollPercent,T=c*d,D=(g+T)*b;n().scrollTo(D)},q=r=>{const{scrubberMonth:c,overallScrollPercent:d,scrubberMonthScrollPercent:g}=r,b=c==="lead-in",T=c==="lead-out";if(!c||n().limitedScroll){const _=n().maxScrollPercent*d*n().totalViewerHeight;n().scrollTo(_)}else if(b)mt(0,n().topSectionHeight,g);else if(T)mt(n().topSectionHeight+n().bodySectionHeight,n().bottomSectionHeight,g);else{const H=n().months.find(({yearMonth:{year:_,month:F}})=>_===c.year&&F===c.month);if(!H)return;mt(H.top,H.height,g)}},Yt=()=>{if(e(O))if(n().limitedScroll){const r=n().maxScroll;f(I,Math.min(1,e(O).scrollTop/r),!0),f(v,void 0),f(P,0)}else{f(I,0);let r=e(O).scrollTop,c=n().maxScrollPercent;const d=n().months.length;for(let g=-1;g<d+1;g++){let b,T=0;g===-1?(b="lead-in",T=n().topSectionHeight):g===d?(b="lead-out",T=n().bottomSectionHeight):(b=n().months[g].yearMonth,T=n().months[g].height);let D=r-T*c;if(D<-1&&b){f(v,b,!0),f(P,Math.max(0,r/(T*c)),!0),e(P)>.9999&&g+1<d-1&&(f(v,n().months[g+1].yearMonth,!0),f(P,0));break}r=D}}},Ct=r=>{n().albumAssets.has(r.id)||m().selectAsset(r)};let gt=y(null),rt=y(!1);const Kt=r=>{r.key==="Shift"&&(r.preventDefault(),f(rt,!0))},Me=r=>{r.key==="Shift"&&(r.preventDefault(),f(rt,!1))},At=r=>{r&&qt(r),f(gt,r,!0)},re=(r,c)=>{const d=r.groupTitle;if(m().selectedGroup.has(d)){m().removeGroupFromMultiselectGroup(d);for(const g of c)m().removeAssetFromMultiselectGroup(g.id)}else{m().addGroupToMultiselectGroup(d);for(const g of c)Ct(g)}m().selectAll=n().assetCount===m().selectedAssets.length},jt=async r=>{if(!r)return;if(Y()(r),S()){n().scrollTo(0);return}const c=m().assetSelectionCandidates.length>0,d=m().hasSelectedAsset(r.id);if(d){for(const g of m().assetSelectionCandidates)m().removeAssetFromMultiselectGroup(g.id);m().removeAssetFromMultiselectGroup(r.id)}else{for(const g of m().assetSelectionCandidates)Ct(g);Ct(r)}if(m().clearAssetSelectionCandidates(),m().assetSelectionStart&&c){const g=n().getMonthGroupByAssetId(m().assetSelectionStart.id),b=n().getMonthGroupByAssetId(r.id);if(!g||!b)return;const T=n().months,D=T.indexOf(g),H=T.indexOf(b);if(D===-1||H===-1)return;const _=Math.min(D,H),F=Math.max(D,H);for(let X=_+1;X<F;X++){const Q=T[X];await n().loadMonthGroup(Q.yearMonth);for(const ot of Q.assetsIterator())d?m().removeAssetFromMultiselectGroup(ot.id):Ct(ot)}for(let X=_;X<=F;X++){const Q=T[X];for(const ot of Q.dayGroups){const Tt=ot.groupTitle;ot.getAssets().every(Ot=>m().hasSelectedAsset(Ot.id))?m().addGroupToMultiselectGroup(Tt):m().removeGroupFromMultiselectGroup(Tt)}}}m().setAssetSelectionStart(d?null:r)},qt=async r=>{if(!e(rt))return;const c=m().assetSelectionStart;if(!c)return;const d=Ue(await n().retrieveRange(c,r));m().setAssetSelectionCandidates(d)};vt(()=>{e(gt)||m().clearAssetSelectionCandidates()}),vt(()=>{e(rt)||m().clearAssetSelectionCandidates()}),vt(()=>{e(rt)&&e(gt)&&qt(e(gt))}),vt(()=>{if(i()){const{localDateTime:r}=ps(o().fileCreatedAt,oe.local().offset/60);n().loadMonthGroup({year:r.year,month:r.month})}});const Xt=(r,c,d,g)=>{jt(c),d.filter(({id:T})=>m().hasSelectedAsset(T)).length===d.length?m().addGroupToMultiselectGroup(g):m().removeGroupFromMultiselectGroup(g),m().selectAll=r.assetCount===m().selectedAssets.length},Et=(r,c,d,g)=>{if(p()||m().selectionActive){Xt(r,g,c,d);return}ge({targetRoute:"current",assetId:g.id})};var Ie={scrollAfterNavigate:ht},ne=_o();at("keydown",Wt,Kt),at("keyup",Wt,Me);var ae=yt(ne);So(ae,{onAfterUpdate:()=>{const r=Ze.url.searchParams.get("at");r&&hs(j,{at:r}),ht()},onBeforeUpdate:r=>{r.updates.some(d=>d.path.endsWith("Timeline.svelte"))&&n().destroy()}});var le=J(ae,2);Ao(le,{scrollToAsset:r=>zt(r)??!1,get timelineManager(){return n()},get assetInteraction(){return m()},get onEscape(){return tt()}});var ce=J(le,2);{var Ge=r=>{co(r,{get timelineManager(){return n()},get height(){return n().viewportHeight},get timelineTopOffset(){return n().topSectionHeight},get timelineBottomOffset(){return n().bottomSectionHeight},get timelineScrollPercent(){return e(I)},get viewportTopMonthScrollPercent(){return e(P)},get viewportTopMonth(){return e(v)},onScrub:q,onScrubKeyDown:c=>{c.preventDefault();let d=50;e(rt)&&(d=500),c.key==="ArrowUp"?(d=-d,e(rt)&&e(O)?.scrollBy({top:d,behavior:"smooth"})):c.key==="ArrowDown"&&e(O)?.scrollBy({top:d,behavior:"smooth"})},get scrubberWidth(){return e(L)},set scrubberWidth(c){f(L,c,!0)}})};st(ce,r=>{n().months.length>0&&r(Ge)})}var dt=J(ce,2);let et;var St=z(dt);let Qt,ue;var bt=z(St);let he;Z(bt,"",{},{position:"absolute",left:"0",right:"0"});var Jt=z(bt);ie(Jt,()=>t.children??Le);var De=J(Jt,2);{var Zt=r=>{var c=kt(),d=yt(c);ie(d,()=>t.empty??Le),C(r,c)};st(De,r=>{e(U)&&r(Zt)})}V(bt),us(bt,(r,c)=>Ns?.(r,c),()=>Te);var $t=J(bt,2);Ae($t,17,()=>n().months,r=>r.viewId,(r,c)=>{const d=M(()=>e(c).intersecting),g=M(()=>e(c).top);var b=kt(),T=yt(b);{var D=_=>{var F=Go();let X;var Q=z(F);Io(Q,{get invisible(){return e(w)},get height(){return e(c).height},get title(){return e(c).monthGroupTitle}}),V(F),$(()=>X=Z(F,"",X,{height:e(c).height+"px",position:"absolute",transform:`translate3d(0,${e(g)}px,0)`,width:"100%"})),C(_,F)},H=_=>{var F=Do();let X;var Q=z(F);Zi(Q,{get assetInteraction(){return m()},get customThumbnailLayout(){return t.customThumbnailLayout},get singleSelect(){return S()},get monthGroup(){return e(c)},get manager(){return n()},onDayGroupSelect:re,thumbnail:(Tt,Ot)=>{let Mt=()=>Ot?.().asset,qe=()=>Ot?.().position,ee=()=>Ot?.().dayGroup,Ms=()=>Ot?.().groupIndex;const Is=M(()=>m().hasSelectionCandidate(Mt().id)),Gs=M(()=>m().hasSelectedAsset(Mt().id)||n().albumAssets.has(Mt().id)),Ds=M(()=>n().albumAssets.has(Mt().id));Ys(Tt,{get showStackedIcon(){return k()},get showArchiveIcon(){return G()},get asset(){return Mt()},get albumUsers(){return E()},get groupIndex(){return Ms()},onClick:Xe=>{typeof t.onThumbnailClick=="function"?t.onThumbnailClick(Xe,n(),ee(),Et):Et(n(),ee().getAssets(),ee().groupTitle,Xe)},onSelect:()=>{if(p()||m().selectionActive){Xt(n(),Mt(),ee().getAssets(),ee().groupTitle);return}jt(Mt())},onMouseEvent:()=>At(Mt()),get selected(){return e(Gs)},get selectionCandidate(){return e(Is)},get disabled(){return e(Ds)},get thumbnailWidth(){return qe().width},get thumbnailHeight(){return qe().height}})},$$slots:{thumbnail:!0}}),V(F),$(()=>X=Z(F,"",X,{height:e(c).height+"px",position:"absolute",transform:`translate3d(0,${e(g)}px,0)`,width:"100%"})),C(_,F)};st(T,_=>{e(c).isLoaded?e(d)&&_(H,1):_(D)})}C(r,b)});var de=J($t,2);let te;V(St),We(St,r=>f(it,r),()=>e(it)),V(dt),We(dt,r=>f(O,r),()=>e(O));var fe=J(dt,2);ui(fe,{target:"body",children:(r,c)=>{var d=kt(),g=yt(d);{var b=T=>{uo(T,{get timelineManager(){return n()},get removeAction(){return x()},get withStacked(){return k()},get isShared(){return A()},get album(){return t.album},get person(){return t.person},get invisible(){return e(w)},set invisible(D){f(w,D,!0)}})};st(g,T=>{i()&&T(b)})}C(r,d)},$$slots:{default:!0}}),$(()=>{Ht(dt,1,Se(["scrollbar-hidden h-full overflow-y-auto outline-none",{"m-0":e(U)},{"ms-0":!e(U)}]),"svelte-bi949n"),et=Z(dt,"",et,{"margin-right":(e(wt)?0:e(L))+"px"}),Qt=Ht(St,1,"",null,Qt,{invisible:e(w)}),ue=Z(St,"",ue,{height:n().totalViewerHeight+"px"}),he=Ht(bt,1,"",null,he,{invisible:e(w)}),te=Z(de,"",te,{height:n().bottomSectionHeight+"px",position:"absolute",left:"0",right:"0",transform:`translate3d(0,${n().topSectionHeight+n().bodySectionHeight}px,0)`})}),at("scroll",dt,()=>(Yt(),n().updateSlidingWindow(),Nt())),Je(dt,"clientHeight",r=>n(n().viewportHeight=r,!0)),Je(dt,"clientWidth",r=>n(n().viewportWidth=r,!0)),C(l,ne);var h=_t(Ie);return u(),h}export{yr as T};

import"./DsnmJJEf.js";import{s as D,d as we,e as Ae,a as Ue}from"./BufZg4h2.js";import{d as Re,p as fe,f as Y,c as o,r as l,s as E,t as P,a as pe,g as e,h as Z,u as W,P as Be,j as U,i as ye,e as je,n as oe,aS as Se}from"./BOqQhZBJ.js";import{i as $}from"./QS5y7wlf.js";import{e as Me,i as Ce}from"./D4fmOnVC.js";import{f as A,a as c,c as Ee,t as ie}from"./CnteGC4G.js";import{a as ce}from"./4T_x9N89.js";import{u as ue,q as Ie,s as re,a as de,aM as Le,ae as Qe,r as Ve,B as We,cp as $e,T as xe}from"./LrV5ZTyj.js";import{b as Ge}from"./eLOR7anR.js";import{a as me,s as ke,p as le}from"./B227BkWK.js";import{i as qe}from"./DFvk55M8.js";import{i as Fe}from"./DsCc9Mx1.js";import{n as ve}from"./CS-10t6W.js";import{$ as be}from"./DdY9CyNE.js";import{t as Ke,y as Xe}from"./Jagi0WJL.js";import{X as He,I as Je}from"./DeYUhNiz.js";import{m as Ye}from"./BihPMor6.js";import{M as Ze,a as et,b as tt}from"./C20f7eOz.js";const Pe={block:"center",behavior:"smooth"};var X=(b=>(b.SECTION="section",b.MESSAGE="message",b.NEW_ALBUM="newAlbum",b.ALBUM_ITEM="albumItem",b))(X||{});const at=b=>b==="newAlbum"||b==="albumItem",se=Re(be);class st{shared;sortBy;orderBy;constructor(a,x,u){this.shared=a,this.sortBy=x,this.orderBy=u}toModalRows(a,x,u,S,I){const m=!this.shared&&a.length===0?x:[],_=[{type:"newAlbum",selected:S===0}],h=Fe(a.length>0&&u.length>0?u.filter(v=>ve(v.albumName).includes(ve(a))):u,{sortBy:this.sortBy,orderBy:this.orderBy});if(h.length>0){if(m.length>0){_.push({type:"section",text:se("recent").toUpperCase()});const r=1;for(const[d,g]of x.entries())_.push({type:"albumItem",selected:S===d+r,multiSelected:I.includes(g.id),album:g})}this.shared||_.push({type:"section",text:(a.length===0?se("all_albums"):se("albums")).toUpperCase()});const v=1+m.length;for(const[r,d]of h.entries())_.push({type:"albumItem",selected:S===r+v,multiSelected:I.includes(d.id),album:d})}else u.length>0?_.push({type:"message",text:se("no_albums_with_name_yet")}):_.push({type:"message",text:se("no_albums_yet")});return _}}var rt=A("<span> </span>"),lt=A("<span> </span> <!>",1);function nt(b,a){fe(a,!0);const x=()=>me(be,"$t",u),[u,S]=ke();var I=lt(),m=Y(I),_=o(m,!0);l(m);var h=E(m,2);{var v=r=>{var d=rt(),g=o(d);l(d),P(R=>D(g,`â€¢ ${R??""}`),[()=>x()("shared")]),c(r,d)};$(h,r=>{a.album.shared&&r(v)})}P(r=>D(_,r),[()=>x()("items_count",{values:{count:a.album.assetCount}})]),c(b,I),pe(),S()}var ot=A('<img data-testid="album-image" draggable="false"/>'),it=A('<div class="rounded-full"><!></div>'),ut=A('<button type="button" class="absolute right-0 top-4 p-3 focus:outline-none hover:cursor-pointer" role="checkbox"><!></button>'),ct=A('<div role="group"><button type="button"><span class="h-16 w-16 shrink-0 rounded-xl bg-slate-300"><!></span> <span class="flex h-full flex-col items-start justify-center overflow-hidden"><span class="w-full shrink overflow-hidden text-ellipsis whitespace-nowrap"> <b> </b> </span> <span class="flex gap-1 text-sm"><!></span></span></button> <!></div>');function dt(b,a){fe(a,!0);let x=le(a,"searchQuery",3,""),u=le(a,"selected",3,!1),S=le(a,"multiSelected",3,!1);const I=t=>{Be(()=>{u()&&t.scrollIntoView(Pe)})},m=W(()=>{let{albumName:t}=a.album,n=ve(t).indexOf(ve(x())),C=x().length;return[t.slice(0,n),t.slice(n,n+C),t.slice(n+C)]}),_=t=>{t?.stopPropagation(),t?.preventDefault(),a.onMultiSelect()};let h=W(()=>Ye.pointerCoarse),v=Z(!1);const r=()=>{e(h)||U(v,!0)},d=()=>{U(v,!1)};let g=null;const R=t=>t.preventDefault(),O=[],G=()=>{if(g){clearTimeout(g),g=null;for(const t of O)t();O.length=0}};function M(t,{onLongPress:n}){let C=!1;const j=()=>{C=!1,g=setTimeout(()=>{n(),t.addEventListener("contextmenu",R,{once:!0}),O.push(()=>t.removeEventListener("contextmenu",R)),C=!0},350)},f=p=>{C&&(p.stopPropagation(),p.preventDefault())};return t.addEventListener("click",f),t.addEventListener("pointerdown",j,!0),t.addEventListener("pointerup",G,{capture:!0,passive:!0}),{destroy:()=>{t.removeEventListener("click",f),t.removeEventListener("pointerdown",j,!0),t.removeEventListener("pointerup",G,!0)}}}var N=ct(),L=o(N);L.__click=function(...t){a.onAlbumClick?.apply(this,t)};let ee;var te=o(L),_e=o(te);{var s=t=>{var n=ot();ue(n,1,Ie(["h-full w-full rounded-xl object-cover transition-all duration-300 hover:shadow-lg"])),P(C=>{re(n,"src",C),re(n,"alt",a.album.albumName)},[()=>Ke({id:a.album.albumThumbnailAssetId})]),c(t,n)};$(_e,t=>{a.album.albumThumbnailAssetId&&t(s)})}l(te);var y=E(te,2),q=o(y),F=o(q,!0),H=E(F),he=o(H,!0);l(H);var ae=E(H,1,!0);l(q);var ne=E(q,2),Q=o(ne);nt(Q,{get album(){return a.album}}),l(ne),l(y),l(L),ce(L,t=>I?.(t)),ce(L,(t,n)=>M?.(t,n),()=>({onLongPress:()=>_()}));var V=E(L,2);{var K=t=>{var n=ut();n.__click=_,re(n,"tabindex",-1);var C=o(n);{var j=p=>{var w=it(),k=o(w);de(k,{get icon(){return Le},size:"24",class:"text-primary"}),l(w),c(p,w)},f=p=>{de(p,{get icon(){return Le},size:"24",class:"text-gray-300 hover:text-primary/75"})};$(C,p=>{S()?p(j):p(f,!1)})}l(n),P(()=>re(n,"aria-checked",u())),c(t,n)};$(V,t=>{(e(v)||S())&&t(K)})}l(N),P(()=>{ue(N,1,Ie(["relative flex w-full text-start justify-between transition-colors hover:bg-gray-200 dark:hover:bg-gray-700 rounded-xl my-2 hover:cursor-pointer",{"bg-primary/10 hover:bg-primary/10":S()}])),ee=ue(L,1,"flex w-full gap-4 px-2 py-2 text-start",null,ee,{"bg-gray-200":u(),"dark:bg-gray-700":u()}),D(F,e(m)[0]),D(he,e(m)[1]),D(ae,e(m)[2])}),Ae("mouseenter",N,r),Ae("mouseleave",N,d),c(b,N),pe()}we(["click"]);var mt=A("<b> </b>"),vt=A('<button type="button"><div class="flex h-12 w-12 items-center justify-center"><!></div> <p> <!></p></button>');function ft(b,a){fe(a,!0);const x=()=>me(be,"$t",u),[u,S]=ke();let I=le(a,"searchQuery",3,""),m=le(a,"selected",3,!1);const _=M=>{Be(()=>{m()&&M.scrollIntoView(Pe)})};var h=vt();h.__click=()=>a.onNewAlbum(I());let v;var r=o(h),d=o(r);de(d,{get icon(){return Qe},size:"30"}),l(r);var g=E(r,2),R=o(g),O=E(R);{var G=M=>{var N=mt(),L=o(N,!0);l(N),P(()=>D(L,I())),c(M,N)};$(O,M=>{I().length>0&&M(G)})}l(g),l(h),ce(h,M=>_?.(M)),P(M=>{v=ue(h,1,"flex w-full items-center gap-4 px-6 py-2 transition-colors hover:bg-gray-200 dark:hover:bg-gray-700 rounded-xl",null,v,{"bg-gray-200":m(),"dark:bg-gray-700":m()}),D(R,`${M??""} `)},[()=>x()("new_album")]),c(b,h),pe(),S()}we(["click"]);var pt=A('<div class="flex animate-pulse gap-4 px-6 py-2"><div class="h-12 w-12 rounded-xl bg-slate-200"></div> <div class="flex flex-col items-start justify-center gap-2"><span class="h-4 w-36 animate-pulse bg-slate-200"></span> <div class="flex animate-pulse gap-1"><span class="h-3 w-8 bg-slate-200"></span> <span class="h-3 w-20 bg-slate-200"></span></div></div></div>'),bt=A('<p class="px-5 py-3 text-xs"> </p>'),_t=A('<p class="px-5 py-1 text-sm"> </p>'),ht=A('<input class="border-b-4 border-immich-bg px-6 py-2 text-2xl focus:border-immich-primary dark:border-immich-dark-gray dark:focus:border-immich-dark-primary"/> <div class="immich-scrollbar overflow-y-auto"></div>',1),gt=A('<div class="mb-2 flex max-h-100 flex-col"><!></div> <!>',1),yt=A('<div class="flex justify-around w-full"><div class="flex gap-4"><div class="flex gap-1 place-items-center"><span class="bg-gray-300 dark:bg-gray-500 rounded p-1"><!></span> <!></div> <div class="flex gap-1 place-items-center"><span class="bg-gray-300 dark:bg-gray-500 rounded p-1"><!></span> <!></div></div></div>'),xt=A("<!> <!>",1);function jt(b,a){fe(a,!0);const x=()=>me(Xe,"$albumViewSettings",S),u=()=>me(be,"$t",S),[S,I]=ke();let m=Z(ye([])),_=Z(ye([])),h=Z(!0),v=Z(""),r=Z(-1);Ue(async()=>{U(m,await He({shared:a.shared||void 0}),!0),U(_,e(m).sort((s,y)=>new Date(s.updatedAt)>new Date(y.updatedAt)?-1:1).slice(0,3),!0),U(h,!1)});const d=ye([]),g=W(()=>d.length>0),R=new st(a.shared,x().sortBy,x().sortOrder),O=W(()=>R.toModalRows(e(v),e(_),e(m),e(r),d)),G=W(()=>e(O).filter(s=>at(s.type)).length),M=async s=>{const y=await Je({createAlbumDto:{albumName:s}});a.onClose([y])},N=s=>{if(e(g)){L(s);return}if(s){a.onClose([s]);return}a.onClose()},L=s=>{const y=s??e(O).find(({selected:F})=>F)?.album;if(!y)return;const q=d.indexOf(y.id);if(q===-1){d.push(y.id);return}d.splice(q,1)},ee=()=>{const s=new Set(e(m).filter(({id:y})=>d.includes(y)));s.size>0?a.onClose([...s]):a.onClose()},te=async()=>{const s=e(O).find(({selected:y})=>y);if(s){switch(s.type){case X.NEW_ALBUM:{await M(e(v));break}case X.ALBUM_ITEM:{if(e(g)){ee();break}s.album&&a.onClose([s.album]);break}}U(r,-1)}},_e=async s=>{switch(s.key){case"ArrowUp":{s.preventDefault(),e(r)>0?Se(r,-1):U(r,e(G)-1);break}case"ArrowDown":{s.preventDefault(),e(r)<e(G)-1?Se(r):U(r,0);break}case"Enter":{s.preventDefault(),await te();break}case"Control":{s.preventDefault(),L();break}default:U(r,-1)}};{let s=W(()=>a.shared?u()("add_to_shared_album"):u()("add_to_album"));Ze(b,{get title(){return e(s)},get onClose(){return a.onClose},size:"small",children:(y,q)=>{var F=xt(),H=Y(F);et(H,{children:(ae,ne)=>{var Q=gt(),V=Y(Q),K=o(V);{var t=f=>{var p=Ee(),w=Y(p);Me(w,16,()=>({length:3}),Ce,(k,B)=>{var i=pt();c(k,i)}),c(f,p)},n=f=>{var p=ht(),w=Y(p);Ve(w),w.__keydown=_e,je(()=>Ge(w,()=>e(v),B=>U(v,B))),ce(w,B=>qe?.(B));var k=E(w,2);Me(k,21,()=>e(O),Ce,(B,i)=>{var J=Ee(),Ne=Y(J);{var Te=T=>{{let z=W(()=>e(i).selected||!1);ft(T,{get selected(){return e(z)},onNewAlbum:M,get searchQuery(){return e(v)}})}},De=T=>{var z=bt(),ge=o(z,!0);l(z),P(()=>D(ge,e(i).text)),c(T,z)},ze=T=>{var z=_t(),ge=o(z,!0);l(z),P(()=>D(ge,e(i).text)),c(T,z)},Oe=T=>{{let z=W(()=>e(i).selected||!1);dt(T,{get album(){return e(i).album},get selected(){return e(z)},get multiSelected(){return e(i).multiSelected},get searchQuery(){return e(v)},onAlbumClick:()=>N(e(i).album),onMultiSelect:()=>L(e(i).album)})}};$(Ne,T=>{e(i).type===X.NEW_ALBUM?T(Te):e(i).type===X.SECTION?T(De,1):e(i).type===X.MESSAGE?T(ze,2):e(i).type===X.ALBUM_ITEM&&e(i).album&&T(Oe,3)})}c(B,J)}),l(k),P(B=>re(w,"placeholder",B),[()=>u()("search")]),c(f,p)};$(K,f=>{e(h)?f(t):f(n,!1)})}l(V);var C=E(V,2);{var j=f=>{We(f,{size:"small",shape:"round",fullWidth:!0,onclick:ee,children:(p,w)=>{oe();var k=ie();P(B=>D(k,B),[()=>u()("add_to_albums_count",{values:{count:d.length}})]),c(p,k)},$$slots:{default:!0}})};$(C,f=>{e(g)&&f(j)})}c(ae,Q)},$$slots:{default:!0}});var he=E(H,2);tt(he,{children:(ae,ne)=>{var Q=yt(),V=o(Q),K=o(V),t=o(K),n=o(t);de(n,{get icon(){return $e},size:"1rem"}),l(t);var C=E(t,2);xe(C,{size:"tiny",children:(k,B)=>{oe();var i=ie();P(J=>D(i,J),[()=>u()("to_select")]),c(k,i)},$$slots:{default:!0}}),l(K);var j=E(K,2),f=o(j),p=o(f);xe(p,{size:"tiny",children:(k,B)=>{oe();var i=ie("CTRL");c(k,i)},$$slots:{default:!0}}),l(f);var w=E(f,2);xe(w,{size:"tiny",children:(k,B)=>{oe();var i=ie();P(J=>D(i,J),[()=>u()("to_multi_select")]),c(k,i)},$$slots:{default:!0}}),l(j),l(V),l(Q),c(ae,Q)},$$slots:{default:!0}}),c(y,F)},$$slots:{default:!0}})}pe(),I()}we(["keydown"]);export{jt as A,nt as a};

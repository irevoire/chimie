import"./DsnmJJEf.js";import{e as ue,s as xe,d as At,a as Lt}from"./BufZg4h2.js";import{p as tt,h as se,i as Tt,P as Et,j as B,g as s,f as qe,s as x,c as o,r as l,a as at,t as z,u as A}from"./BOqQhZBJ.js";import{s as Ie}from"./BHgwLGQu.js";import{i as p}from"./QS5y7wlf.js";import{f as _,a as v,c as Ct,t as Ae}from"./CnteGC4G.js";import{cq as Mt,cr as Ot,u as G,s as le,a as V,w as Pt,bt as St,aa as we,q as J,ag as Ht,av as zt,cs as Dt,ct as Ut,cu as jt,bf as Ft,be as Ge,G as Le,ab as Te,aM as Ee}from"./LrV5ZTyj.js";import{a as Ke}from"./4T_x9N89.js";import{p as u,c as st,s as Nt,a as Ce}from"./B227BkWK.js";import{a2 as Vt,t as Ye,a0 as Bt,l as Rt,a3 as Xe,a4 as qt}from"./Jagi0WJL.js";import{P as Gt}from"./BNLYq5HQ.js";import{a as Qe,h as We}from"./C2I_EQjW.js";import{m as Kt}from"./BihPMor6.js";import{m as Yt,t as Xt}from"./De1sTUmb.js";import{g as Qt}from"./BIB7ntQe.js";import{A as Wt,B as Je}from"./DeYUhNiz.js";import{I as Ze}from"./izWpGtDw.js";import{b as Me}from"./Cx5lmlld.js";function Jt(d){let{PI:t,min:g,max:m,cos:E,round:D}=Math,U=d[0]|d[1]<<8|d[2]<<16,K=d[3]|d[4]<<8,de=(U&63)/63,R=(U>>6&63)/31.5-1,re=(U>>12&63)/31.5-1,b=(U>>18&31)/31,k=U>>23,j=(K>>3&63)/63,he=(K>>9&63)/63,ne=K>>15,Z=m(3,ne?k?5:7:K&7),X=m(3,ne?K&7:k?5:7),ce=k?(d[5]&15)/15:1,ve=(d[5]>>4)/15,ie=k?6:5,Y=0,Q=(S,N,$)=>{let ee=[];for(let W=0;W<N;W++)for(let te=W?0:1;te*N<S*(N-W);te++)ee.push(((d[ie+(Y>>1)]>>((Y++&1)<<2)&15)/7.5-1)*$);return ee},me=Q(Z,X,b),be=Q(3,3,j*1.25),y=Q(3,3,he*1.25),h=k&&Q(5,5,ve),C=Zt(d),f=D(C>1?32:32*C),P=D(C>1?32/C:32),F=new Uint8Array(f*P*4),i=[],w=[];for(let S=0,N=0;S<P;S++)for(let $=0;$<f;$++,N+=4){let ee=de,W=R,te=re,oe=ce;for(let n=0,L=m(Z,k?5:3);n<L;n++)i[n]=E(t/f*($+.5)*n);for(let n=0,L=m(X,k?5:3);n<L;n++)w[n]=E(t/P*(S+.5)*n);for(let n=0,L=0;n<X;n++)for(let H=n?0:1,ae=w[n]*2;H*X<Z*(X-n);H++,L++)ee+=me[L]*i[H]*ae;for(let n=0,L=0;n<3;n++)for(let H=n?0:1,ae=w[n]*2;H<3-n;H++,L++){let T=i[H]*ae;W+=be[L]*T,te+=y[L]*T}if(k)for(let n=0,L=0;n<5;n++)for(let H=n?0:1,ae=w[n]*2;H<5-n;H++,L++)oe+=h[L]*i[H]*ae;let _e=ee-2/3*W,fe=(3*ee-_e+te)/2,q=fe-te;F[N]=m(0,255*g(1,fe)),F[N+1]=m(0,255*g(1,q)),F[N+2]=m(0,255*g(1,_e)),F[N+3]=m(0,255*g(1,oe))}return{w:f,h:P,rgba:F}}function Zt(d){let t=d[3],g=d[2]&128,m=d[4]&128,E=m?g?5:7:t&7,D=m?t&7:g?5:7;return E/D}function $t(d,t){return $e(d,t),{update(g){$e(d,g)}}}const $e=(d,t)=>{const g=d.getContext("2d");if(!g)return;const{w:m,h:E,rgba:D}=Jt(Vt(t.base64ThumbHash)),U=g.createImageData(m,E);d.width=m,d.height=E,U.data.set(D),g.putImageData(U,0,0)};var ea=_('<video autoplay="" loop=""></video>',2),ta=_('<span class="pt-2"><!></span>'),aa=_('<!> <div class="absolute end-0 top-0 flex place-items-center gap-1 text-xs font-medium text-white text-shadow-[1px_1px_6px_rgb(0_0_0)]"><!> <span class="pe-2 pt-2 drop-shadow-[1px_1px_6px_rgb(0_0_0)]"><!></span></div>',1);function et(d,t){tt(t,!0);let g=u(t,"durationInSeconds",3,0),m=u(t,"enablePlayback",15,!1),E=u(t,"playbackOnIconHover",3,!1),D=u(t,"showTime",3,!0),U=u(t,"curve",3,!1),K=u(t,"playIcon",3,Mt),de=u(t,"pauseIcon",3,Ot),R=se(Tt(g())),re=se(!0),b=se(!1),k=se(void 0);Et(()=>{m()||(B(R,g()),s(k)&&(s(k).src=""))});const j=()=>{E()&&m(!0)},he=()=>{E()&&m(!1)};var ne=aa(),Z=qe(ne);{var X=y=>{var h=ea();let C;h.muted=!0,st(h,f=>B(k,f),()=>s(k)),z(()=>{C=G(h,1,"h-full w-full object-cover",null,C,{"rounded-xl":U()}),le(h,"src",t.url)}),ue("play",h,()=>{B(re,!1),B(b,!1)}),ue("error",h,()=>{s(k)?.src&&(B(b,!0),B(re,!1))}),ue("timeupdate",h,({currentTarget:f})=>{const P=f.duration-f.currentTime;B(R,Math.min(Math.ceil(Number.isNaN(P)?Number.POSITIVE_INFINITY:P),g()),!0)}),v(y,h)};p(Z,y=>{m()&&y(X)})}var ce=x(Z,2),ve=o(ce);{var ie=y=>{var h=ta(),C=o(h);{var f=i=>{var w=Ae();z(S=>xe(w,S),[()=>Me.fromObject({seconds:s(R)}).toFormat("m:ss")]),v(i,w)},P=i=>{var w=Ae();z(S=>xe(w,S),[()=>Me.fromObject({seconds:s(R)}).toFormat("mm:ss")]),v(i,w)},F=i=>{var w=Ae();z(S=>xe(w,S),[()=>Me.fromObject({seconds:s(R)}).toFormat("h:mm:ss")]),v(i,w)};p(C,i=>{s(R)<60?i(f):s(R)<3600?i(P,1):i(F,!1)})}l(h),v(y,h)};p(ve,y=>{D()&&y(ie)})}var Y=x(ve,2),Q=o(Y);{var me=y=>{var h=Ct(),C=qe(h);{var f=i=>{Pt(i,{})},P=i=>{V(i,{get icon(){return St},size:"24",class:"text-red-600"})},F=i=>{V(i,{get icon(){return de()},size:"24"})};p(C,i=>{s(re)?i(f):s(b)?i(P,1):i(F,!1)})}v(y,h)},be=y=>{V(y,{get icon(){return K()},size:"24"})};p(Q,y=>{m()?y(me):y(be,!1)})}l(Y),l(ce),ue("mouseenter",Y,j),ue("mouseleave",Y,he),v(d,ne),at()}var sa=_("<div></div>"),ra=_('<div id="a"></div>'),na=_('<div class="absolute bottom-2 start-2"><!></div>'),ia=_('<div class="absolute bottom-1 end-2 max-w-[50%]"><p class="text-xs font-medium text-white drop-shadow-lg max-w-[100%] truncate"> </p></div>'),oa=_("<div><!></div>"),la=_('<div class="absolute end-0 top-0 flex place-items-center gap-1 text-xs font-medium text-white"><span class="pe-2 pt-2"><!></span></div>'),ua=_('<div class="absolute end-0 top-0 flex place-items-center gap-1 text-xs font-medium text-white"><span class="pe-2 pt-2"><!></span></div>'),da=_('<div><span class="pe-2 pt-2 flex place-items-center gap-1"><p> </p> <!></span></div>'),ca=_('<a class="absolute w-full top-0 bottom-0" aria-label="Thumbnail URL"></a>'),va=_('<div class="absolute top-0 h-full w-full pointer-events-none"><!></div>'),ma=_('<div class="absolute top-0 h-full w-full pointer-events-none"><!></div>'),fa=_('<div class="absolute top-0 h-full w-full pointer-events-none"><div class="absolute h-full w-full bg-linear-to-b from-black/25 via-[transparent_25%]"></div> <!> <div class="absolute end-0 top-0 flex place-items-center gap-1 text-xs font-medium text-white"><span class="pe-2 pt-2"><!></span></div></div>'),ha=_('<canvas data-testid="thumbhash" draggable="false"></canvas>'),ba=_('<div class="absolute top-0 h-full w-full bg-immich-primary opacity-40"></div>'),_a=_('<div class="rounded-full bg-[#D9DCEF] dark:bg-[#232932]"><!></div>'),ga=_('<button type="button" role="checkbox"><!></button>'),xa=_('<div data-thumbnail-focus-container="" role="link"><div data-outline=""></div> <div><div><div><!> <!> <!> <!> <!> <!> <!> <!></div> <!> <!> <!> <!></div> <!> <!></div></div>');function ja(d,t){tt(t,!0);const g=()=>Ce(Rt,"$locale",D),m=()=>Ce(Qt,"$getAltText",D),E=()=>Ce(qt,"$playVideoThumbnailOnHover",D),[D,U]=Nt();let K=u(t,"groupIndex",3,0),de=u(t,"thumbnailSize",3,void 0),R=u(t,"thumbnailWidth",3,void 0),re=u(t,"thumbnailHeight",3,void 0),b=u(t,"selected",3,!1),k=u(t,"selectionCandidate",3,!1),j=u(t,"disabled",3,!1),he=u(t,"disableLinkMouseOver",3,!1),ne=u(t,"readonly",3,!1),Z=u(t,"showArchiveIcon",3,!1),X=u(t,"showStackedIcon",3,!0),ce=u(t,"albumUsers",19,()=>[]),ve=u(t,"onClick",3,void 0),ie=u(t,"onSelect",3,void 0),Y=u(t,"onMouseEvent",3,void 0),Q=u(t,"imageClass",3,""),me=u(t,"brokenAssetClass",3,""),be=u(t,"dimmed",3,!1),{IMAGE_THUMBNAIL:{THUMBHASH_FADE_DURATION:y}}=Bt,h=A(()=>Kt.pointerCoarse),C=se(void 0),f=se(!1),P=se(!1),F=se(!1),i=A(()=>de()||R()||235),w=A(()=>de()||re()||235),S=A(()=>ce()?.find(e=>e.id===t.asset.ownerId)??null);const N=e=>{e?.stopPropagation(),e?.preventDefault(),j()||ie()?.(Ie(t.asset))},$=()=>{if(b()){N();return}ve()?.(Ie(t.asset))},ee=e=>{if(e.ctrlKey||e.metaKey){window.open(We(t.asset.id),"_blank");return}e.stopPropagation(),e.preventDefault(),$()},W=()=>{s(h)||(B(f,!0),Y()?.({isMouseOver:!0,selectedGroupIndex:K()}))},te=()=>{B(f,!1),Y()?.({isMouseOver:!1,selectedGroupIndex:K()})};let oe=null;const _e=e=>e.preventDefault(),fe=[],q=()=>{if(oe){clearTimeout(oe),oe=null;for(const e of fe)e();fe.length=0}};let n=0,L=0;function H(e,{onLongPress:a}){let r=!1;const c=I=>{n=I.clientX,L=I.clientY,r=!1,oe=setTimeout(()=>{a(),e.addEventListener("contextmenu",_e,{once:!0}),fe.push(()=>e.removeEventListener("contextmenu",_e)),r=!0},350)},M=I=>{r&&(I.stopPropagation(),I.preventDefault())};return e.addEventListener("click",M),e.addEventListener("pointerdown",c,!0),e.addEventListener("pointerup",q,{capture:!0,passive:!0}),{destroy:()=>{e.removeEventListener("click",M),e.removeEventListener("pointerdown",c,!0),e.removeEventListener("pointerup",q,!0)}}}function ae(e){(Math.abs(n-e.clientX)>=10||Math.abs(L-e.clientY)>=10)&&q()}Lt(()=>(document.addEventListener("scroll",q,{capture:!0,passive:!0}),document.addEventListener("wheel",q,{capture:!0,passive:!0}),document.addEventListener("contextmenu",q,{capture:!0,passive:!0}),document.addEventListener("pointermove",ae,{capture:!0,passive:!0}),()=>{document.removeEventListener("scroll",q,!0),document.removeEventListener("wheel",q,!0),document.removeEventListener("contextmenu",q,!0),document.removeEventListener("pointermove",ae,!0)}));var T=xa();T.__keydown=e=>{e.key==="Enter"&&$(),e.key==="x"&&ie()?.(t.asset),document.activeElement===s(C)&&e.key==="Escape"&&Yt(a=>a.dataset.thumbnailFocusContainer===void 0,"next")},T.__click=ee,le(T,"tabindex",0);let Oe;var Pe=o(T),pe=x(Pe,2);we(pe,"",{},{width:"inherit",height:"inherit"});var ye=o(pe),ke=o(ye),Se=o(ke);{var rt=e=>{var a=sa();z(()=>G(a,1,J(["absolute h-full w-full bg-linear-to-b from-black/25 via-[transparent_25%] opacity-0 transition-opacity group-hover:opacity-100",{"rounded-xl":b()}]))),v(e,a)};p(Se,e=>{!s(h)&&!j()&&e(rt)})}var He=x(Se,2);{var nt=e=>{var a=ra();z(()=>G(a,1,J(["absolute h-full w-full bg-gray-700/40",{"rounded-xl":b()}]))),v(e,a)};p(He,e=>{be()&&!s(f)&&e(nt)})}var ze=x(He,2);{var it=e=>{var a=na(),r=o(a);V(r,{"data-icon-favorite":!0,get icon(){return Ht},size:"24",class:"text-white"}),l(a),v(e,a)};p(ze,e=>{!Qe.isSharedLink&&t.asset.isFavorite&&e(it)})}var De=x(ze,2);{var ot=e=>{var a=ia(),r=o(a),c=o(r,!0);l(r),l(a),z(()=>xe(c,s(S).name)),v(e,a)};p(De,e=>{s(S)&&e(ot)})}var Ue=x(De,2);{var lt=e=>{var a=oa(),r=o(a);V(r,{"data-icon-archive":!0,get icon(){return zt},size:"24",class:"text-white"}),l(a),z(()=>G(a,1,J(["absolute start-2",t.asset.isFavorite?"bottom-10":"bottom-2"]))),v(e,a)};p(Ue,e=>{!Qe.isSharedLink&&Z()&&t.asset.visibility===Wt.Archive&&e(lt)})}var je=x(Ue,2);{var ut=e=>{var a=la(),r=o(a),c=o(r);V(c,{"data-icon-equirectangular":!0,get icon(){return Dt},size:"24"}),l(r),l(a),v(e,a)};p(je,e=>{t.asset.isImage&&t.asset.projectionType===Gt.EQUIRECTANGULAR&&e(ut)})}var Fe=x(je,2);{var dt=e=>{var a=ua(),r=o(a),c=o(r);V(c,{"data-icon-playable":!0,get icon(){return Ut},size:"24"}),l(r),l(a),v(e,a)},ct=A(()=>t.asset.isImage&&t.asset.duration&&!t.asset.duration.includes("0:00:00.000"));p(Fe,e=>{s(ct)&&e(dt)})}var vt=x(Fe,2);{var mt=e=>{var a=da(),r=o(a),c=o(r),M=o(c,!0);l(c);var I=x(c,2);V(I,{"data-icon-stack":!0,get icon(){return jt},size:"24"}),l(r),l(a),z(O=>{G(a,1,J(["absolute flex place-items-center gap-1 text-xs font-medium text-white",t.asset.isImage&&!t.asset.livePhotoVideoId?"top-0 end-0":"top-7 end-1"])),xe(M,O)},[()=>t.asset.stack.assetCount.toLocaleString(g())]),v(e,a)};p(vt,e=>{t.asset.stack&&X()&&e(mt)})}l(ke);var Ne=x(ke,2);{var ft=e=>{var a=ca();a.__click=r=>r.preventDefault(),le(a,"tabindex",-1),we(a,"",{},{cursor:"unset"}),z(r=>le(a,"href",r),[()=>We(t.asset.id)]),v(e,a)};p(Ne,e=>{!s(h)&&s(f)&&!he()&&e(ft)})}var Ve=x(Ne,2);{let e=A(()=>Ye({id:t.asset.id,size:Je.Thumbnail,cacheKey:t.asset.thumbhash})),a=A(()=>m()(t.asset));Ze(Ve,{get class(){return Q()},get brokenAssetClass(){return me()},get url(){return s(e)},get altText(){return s(a)},get widthStyle(){return`${s(i)??""}px`},get heightStyle(){return`${s(w)??""}px`},get curve(){return b()},onComplete:r=>(B(P,!0),B(F,r,!0))})}var Be=x(Ve,2);{var ht=e=>{var a=va(),r=o(a);{let c=A(()=>Xe({id:t.asset.id,cacheKey:t.asset.thumbhash})),M=A(()=>s(f)&&E()),I=A(()=>t.asset.duration?Xt(t.asset.duration):0),O=A(()=>!E());et(r,{get url(){return s(c)},get enablePlayback(){return s(M)},get curve(){return b()},get durationInSeconds(){return s(I)},get playbackOnIconHover(){return s(O)}})}l(a),v(e,a)},bt=e=>{var a=ma(),r=o(a);{let c=A(()=>Xe({id:t.asset.livePhotoVideoId,cacheKey:t.asset.thumbhash})),M=A(()=>s(f)&&E()),I=A(()=>!E());et(r,{get url(){return s(c)},get enablePlayback(){return s(M)},get pauseIcon(){return Ge},get playIcon(){return Ft},showTime:!1,get curve(){return b()},get playbackOnIconHover(){return s(I)}})}l(a),v(e,a)},_t=e=>{var a=fa(),r=x(o(a),2);{let O=A(()=>Ye({id:t.asset.id,size:Je.Original,cacheKey:t.asset.thumbhash})),ge=A(()=>m()(t.asset));Ze(r,{get class(){return Q()},get brokenAssetClass(){return me()},get url(){return s(O)},get altText(){return s(ge)},get widthStyle(){return`${s(i)??""}px`},get heightStyle(){return`${s(w)??""}px`},get curve(){return b()}})}var c=x(r,2),M=o(c),I=o(M);V(I,{"data-icon-playable-pause":!0,get icon(){return Ge},size:"24"}),l(M),l(c),l(a),v(e,a)},gt=A(()=>t.asset.isImage&&t.asset.duration&&!t.asset.duration.includes("0:00:00.000")&&s(f));p(Be,e=>{t.asset.isVideo?e(ht):t.asset.isImage&&t.asset.livePhotoVideoId?e(bt,1):s(gt)&&e(_t,2)})}var xt=x(Be,2);{var pt=e=>{var a=ha();let r,c;Ke(a,(M,I)=>$t?.(M,I),()=>({base64ThumbHash:t.asset.thumbhash})),z(()=>{r=G(a,1,"absolute top-0 object-cover",null,r,{"rounded-xl":b()}),c=we(a,"",c,{width:`${s(i)??""}px`,height:`${s(w)??""}px`})}),Le(2,a,()=>Te,()=>({duration:y})),v(e,a)};p(xt,e=>{(!s(P)||s(F))&&t.asset.thumbhash&&e(pt)})}l(ye);var Re=x(ye,2);{var yt=e=>{var a=ba();Le(1,a,()=>Te,()=>({duration:100})),Le(2,a,()=>Te,()=>({duration:100})),v(e,a)};p(Re,e=>{k()&&e(yt)})}var wt=x(Re,2);{var kt=e=>{var a=ga();a.__click=N,le(a,"tabindex",-1);var r=o(a);{var c=O=>{V(O,{"data-icon-select":!0,get icon(){return Ee},size:"24",class:"text-zinc-800"})},M=O=>{var ge=_a(),It=o(ge);V(It,{"data-icon-select":!0,get icon(){return Ee},size:"24",class:"text-primary"}),l(ge),v(O,ge)},I=O=>{V(O,{"data-icon-select":!0,get icon(){return Ee},size:"24",class:"text-white/80 hover:text-white"})};p(r,O=>{j()?O(c):b()?O(M,1):O(I,!1)})}l(a),z(()=>{G(a,1,J(["absolute p-2 focus:outline-none",{"cursor-not-allowed":j()}])),le(a,"aria-checked",b()),a.disabled=j()}),v(e,a)};p(wt,e=>{!ne()&&(s(f)||b()||k())&&e(kt)})}l(pe),l(T),Ke(T,(e,a)=>H?.(e,a),()=>({onLongPress:()=>ie()?.(Ie(t.asset))})),st(T,e=>B(C,e),()=>s(C)),z(()=>{G(T,1,J(["focus-visible:outline-none flex overflow-hidden",j()?"bg-gray-300":"dark:bg-neutral-700 bg-neutral-200"]),"svelte-upau3b"),le(T,"data-asset",t.asset.id),Oe=we(T,"",Oe,{width:`${s(i)??""}px`,height:`${s(w)??""}px`}),G(Pe,1,J(["pointer-events-none absolute z-1 size-full outline-hidden outline-4 -outline-offset-4 outline-immich-primary",{"rounded-xl":b()}]),"svelte-upau3b"),G(pe,1,J(["group absolute top-0 bottom-0",{"cursor-not-allowed":j(),"cursor-pointer":!j()}])),G(ye,1,J(["absolute h-full w-full select-none bg-transparent transition-transform",{"scale-[0.85]":b()},{"rounded-xl":b()}]))}),ue("mouseenter",T,W),ue("mouseleave",T,te),v(d,T),at(),U()}At(["keydown","click"]);export{ja as T};

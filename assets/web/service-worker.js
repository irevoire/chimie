const o=new Map,c=e=>e instanceof URL?e.href:e.url,l="Request canceled by application",u=300*1e3,d=e=>{const t=c(e),s=o.get(t);if(s)return s.promise.then(n=>n.clone());const i={controller:new AbortController,promise:void 0,cleanupTimeout:void 0};return o.set(t,i),i.promise=fetch(e,{signal:i.controller.signal}).catch(n=>{const r=n instanceof Error?n:new Error(String(n));if(r.name==="AbortError"||r.message===l)return new Response(void 0,{status:204});throw r}).finally(()=>{const n=setTimeout(()=>{o.delete(t)},u);i.cleanupTimeout=n}),i.promise.then(n=>n.clone())},p=e=>{const t=c(e),s=o.get(t);s&&(s.controller.abort(l),s.cleanupTimeout&&clearTimeout(s.cleanupTimeout),o.delete(t))},h=globalThis,g=()=>{h.addEventListener("message",e=>{if(e.data?.type)switch(e.data.type){case"cancel":{const t=e.data.url?new URL(e.data.url,self.location.origin):void 0;if(!t||!e.source)return;p(t);break}}})},E=/^\/api\/assets\/[a-f0-9-]+\/(original|thumbnail)/,a=globalThis,f=e=>{e.waitUntil(a.clients.claim())},m=e=>{e.waitUntil(a.skipWaiting())},T=e=>{if(e.request.method!=="GET")return;const t=new URL(e.request.url);if(t.origin===self.location.origin&&E.test(t.pathname)){e.respondWith(d(e.request));return}};a.addEventListener("install",m,{passive:!0});a.addEventListener("activate",f,{passive:!0});a.addEventListener("fetch",T,{passive:!0});g();
